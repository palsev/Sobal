import{_ as Q}from"./BalModal-3bc137a6.js";import{aR as W,aT as P,av as O,au as X,aq as Y,ao as aa,aw as ta}from"./BalBtn-a3a093af.js";import{A as ea,_ as oa}from"./BalActionSteps.vue_vue_type_script_setup_true_lang-1ae0de8c.js";import{_ as na}from"./BalAssetSet-ca8ea95f.js";import{_ as sa}from"./BalStack.vue_vue_type_script_lang-b46da6b4.js";import{_ as ia}from"./BalCircle-ccce1514.js";import{_ as la,a as ca,b as ra}from"./BalDataListRow.vue_vue_type_script_setup_true_lang-8d6041f8.js";import{x as M,N as I}from"./index-c7e2fe85.js";import{_ as ua}from"./BalTooltip.vue_vue_type_style_index_0_lang-b52dcfa5.js";import{d as Z,b as _,c as g,l as s,h as n,E as G,A as r,y as h,D as t,r as w,q,p as E,am as ma,f as C,o as da,T as fa}from"./runtime-core.esm-bundler-24a2b16f.js";import{u as ka,A as pa}from"./useTokenApprovalActions-7a65b699.js";import{t as _a}from"./useTransactions-19512b92.js";import{u as H}from"./pool-staking.provider-7a0c7e0f.js";import{o as U,Z as j,aq as ga}from"./connector-d867b6ec.js";const ha={class:"lowercase"},va={class:"capitalize"},Aa={class:"capitalize"},wa=Z({__name:"StakeSummary",props:{action:null,fiatValue:null,sharePercentage:null},setup(a){const{fNum:u}=W();return(e,m)=>{const l=ua,i=la,c=ca;return _(),g(c,{title:e.$t("summary")},{default:s(()=>[n(i,null,{label:s(()=>[G(r(e.$t("totalValueTo"))+" Â  ",1),h("span",ha,r(a.action==="stake"?e.$t("stake"):e.$t("unstake"))+": ",1)]),value:s(()=>[h("span",va,r(t(u)(a.fiatValue,t(P).fiat)),1),n(l,{text:a.action==="stake"?e.$t("staking.stakeValueTooltip"):e.$t("staking.unstakeValueTooltip"),width:"40",textAlign:"center",class:"ml-2"},null,8,["text"])]),_:1}),n(i,{label:e.$t("staking.newTotalShare")},{value:s(()=>[h("span",Aa,r(t(u)(a.sharePercentage,t(P).percent)),1),n(l,{text:e.$t("staking.totalShareTooltip"),width:"40",textAlign:"center",class:"ml-2"},null,8,["text"])]),_:1},8,["label"])]),_:1},8,["title"])}}});function ya(a,u){const e=w(!1),m=w(!1),l=w(),i=w([]),{balanceFor:c,refetchBalances:k}=O(),{fNum:y}=W(),{t:o}=X(),{addTransaction:V}=_a(),{getTokenApprovalActions:L}=ka(),{stake:N,unstake:x,stakedShares:$,refetchAllPoolStakingData:F,preferentialGaugeAddress:d}=H(),f=a.action==="stake"?c(U(a.pool.address)):$.value,b={label:o("stake"),loadingLabel:o("staking.staking"),confirmingLabel:o("confirming"),action:()=>S(N,"stake"),stepTooltip:o("staking.stakeTooltip")},T={label:o("unstake"),loadingLabel:o("staking.unstaking"),confirmingLabel:o("confirming"),action:()=>S(x,"unstake"),stepTooltip:a.action==="restake"?o("staking.restakeTooltip"):o("staking.unstakeTooltip")},p=q(()=>a.action==="stake"&&(f==="0"||f==="")),R=w(j(j($.value).plus(c(U(a.pool.address)))).div(a.pool.totalShares).toString()),z=q(()=>[{address:a.pool.address,amount:f}]);async function S(A,D){try{const B=await A();return V({id:B.hash,type:"tx",action:D,summary:o(`transactionSummary.${D}`,{pool:a.pool.symbol,amount:y(M(a.pool,f),P.fiat)}),details:{total:y(M(a.pool,f),P.fiat),pool:a.pool}}),B}catch(B){throw new Error(`Failed create ${D} transaction`,{cause:B})}}async function v(){const A=await ga(async()=>{if(d.value)return await L({amountsToApprove:z.value,spender:d.value,actionType:pa.Staking})},e);A&&i.value.unshift(...A)}async function J(A){m.value=!0,l.value=A,await Promise.all([k(),F()]),u("success")}function K(){m.value=!1,l.value=void 0,u("close")}return E(()=>a.action,()=>{a.action==="stake"&&(i.value=[b]),a.action==="unstake"&&(i.value=[T]),a.action==="restake"&&(i.value=[T,b])},{immediate:!0}),E(d,async()=>{a.action!=="unstake"&&await v()}),ma(async()=>{a.action!=="unstake"&&await v()}),{isActionConfirmed:m,confirmationReceipt:l,isLoadingApprovalsForGauge:e,currentShares:f,stakeActions:i,totalUserPoolSharePct:R,handleSuccess:J,handleClose:K,isStakeAndZero:p}}const Sa={class:"py-2 px-4 rounded-lg border dark:border-gray-700 divide-y dark:divide-gray-700"},$a={class:"text-secondary"},ba=Z({__name:"StakePreview",props:{pool:null,action:null},emits:["close","success"],setup(a,{emit:u}){const e=a,{getToken:m}=O(),{fNum:l}=W(),{isMismatchedNetwork:i}=Y(),{isActionConfirmed:c,confirmationReceipt:k,isLoadingApprovalsForGauge:y,currentShares:o,stakeActions:V,totalUserPoolSharePct:L,handleSuccess:N,handleClose:x,isStakeAndZero:$}=ya(e,u),F=q(()=>I(e.pool).length*32/1.5);return(d,f)=>{const b=aa,T=ia,p=sa,R=na,z=oa,S=ta;return _(),g(p,{vertical:""},{default:s(()=>[n(p,{horizontal:"",spacing:"sm",align:"center"},{default:s(()=>[t(c)?(_(),g(T,{key:0,size:"8",color:"green",class:"text-white"},{default:s(()=>[n(b,{name:"check"})]),_:1})):C("",!0),h("h4",null,r(d.$t(`${a.action}`))+" "+r(d.$t("lpTokens")),1)]),_:1}),h("div",Sa,[n(p,{horizontal:"",justify:"between",align:"center"},{default:s(()=>[n(p,{vertical:"",spacing:"none"},{default:s(()=>{var v;return[h("h5",null,r(t(l)(t(o)))+" "+r(d.$t("lpTokens")),1),h("span",$a,r((v=t(m)(a.pool.address))==null?void 0:v.symbol),1)]}),_:1}),n(R,{addresses:t(I)(a.pool),width:t(F),size:32},null,8,["addresses","width"])]),_:1})]),n(wa,{action:a.action,fiatValue:t(M)(a.pool,t(o)),sharePercentage:t(L)},null,8,["action","fiatValue","sharePercentage"]),t(c)?C("",!0):(_(),g(z,{key:0,actions:t(V),primaryActionType:a.action,isLoading:t(y),disabled:t($)||t(i),onSuccess:t(N)},null,8,["actions","primaryActionType","isLoading","disabled","onSuccess"])),t(c)&&t(k)?(_(),g(p,{key:1,vertical:""},{default:s(()=>[n(ra,{txReceipt:t(k)},null,8,["txReceipt"]),n(ea,{isVisible:t(c)},{default:s(()=>[a.action==="stake"?(_(),g(S,{key:0,color:"gradient",block:"",class:"mb-2",onClick:f[0]||(f[0]=v=>d.$router.push({name:"claim"}))},{default:s(()=>[G(r(d.$t("viewClaims")),1)]),_:1})):C("",!0),n(S,{color:"gray",outline:"",block:"",onClick:t(x)},{default:s(()=>[G(r(d.$t("close")),1)]),_:1},8,["onClick"])]),_:1},8,["isVisible"])]),_:1})):C("",!0)]),_:1})}}}),qa=Z({__name:"StakePreviewModal",props:{isVisible:{type:Boolean},pool:null,action:null},emits:["close","success"],setup(a,{emit:u}){const e=a,m=w(!1),{setCurrentPool:l}=H();function i(){m.value=!1,u("close")}function c(){m.value=!0,u("success")}return da(()=>{l(e.pool.id)}),E(()=>e.pool,k=>{l(k.id)}),(k,y)=>{const o=Q;return _(),g(fa,{to:"#modal"},[n(o,{show:a.isVisible,fireworks:t(m),onClose:i},{default:s(()=>[n(ba,{pool:a.pool,action:a.action,onClose:i,onSuccess:c},null,8,["pool","action"])]),_:1},8,["show","fireworks"])])}}});export{qa as _};
//# sourceMappingURL=StakePreviewModal.vue_vue_type_script_setup_true_lang-6f08d9d6.js.map
