var ze=Object.defineProperty;var De=(t,s,a)=>s in t?ze(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a;var W=(t,s,a)=>(De(t,typeof s!="symbol"?s+"":s,a),a);import{d as Ue,q as m,b as $,x as j,y as $e,B as J,e as je,E as Je,A as He,f as Ze,v as Ke,r as X,ai as Qe}from"./runtime-core.esm-bundler-24a2b16f.js";import{at as Ge,b2 as H,b0 as Ye,aS as Xe,aM as et,aJ as tt,av as nt,aq as st}from"./BalBtn-a3a093af.js";import{_ as ot}from"./_plugin-vue_export-helper-c27b6911.js";import{ad as ee,B as I,a8 as te,c as T,b as Z,U as P,Z as h,S as K,i as at,Q as rt,ae as it,o as lt}from"./connector-d867b6ec.js";import{u as ut}from"./usePoolsQuery-a683b142.js";import{w as dt,t as ct}from"./useTransactions-19512b92.js";import{d as C,p as pt,F as ne,w as ft}from"./index-c7e2fe85.js";import{r as yt}from"./index-9df68fbf.js";const mt=Ue({name:"BalRadio",props:{checked:{type:Boolean,default:!1},name:{type:String,required:!0},value:{type:[String,Number],required:!0},modelValue:{type:[String,Number],default:""},label:{type:String,default:""},disabled:{type:Boolean,default:!1},size:{type:String,default:"md",validator:t=>["sm","md","lg"].includes(t)},color:{type:String,default:"blue",validator:t=>["blue"].includes(t)}},emits:["update:modelValue"],setup(t,{emit:s}){function a(y){t.disabled||s("update:modelValue",y)}const i=m(()=>{switch(t.size){case"sm":return"w-3 h-3";case"lg":return"w-6 h-6";default:return"w-4 h-4"}}),r=m(()=>{switch(t.size){case"sm":return"leading-none text-sm";case"lg":return"leading-none text-lg";default:return"leading-none text-base"}}),u=m(()=>t.disabled?"text-gray-500":`text-${t.color}-500`),d=m(()=>t.disabled?"cursor-not-allowed":"cursor-pointer"),f=m(()=>({[i.value]:!0,[u.value]:!0,[d.value]:!0})),c=m(()=>({[r.value]:!0,[d.value]:!0}));return{onChange:a,inputClasses:f,labelClasses:c}}});const gt={class:"inline-flex items-start"},vt=["value","checked","name","disabled"],ht=["for"];function kt(t,s,a,i,r,u){return $(),j("div",gt,[$e("input",{type:"radio",autofocus:"",value:t.value,checked:t.modelValue===t.value||t.checked,name:t.name,class:J(["bal-radio-input",t.inputClasses]),disabled:t.disabled,onClick:s[0]||(s[0]=d=>t.onChange(t.value))},null,10,vt),t.$slots.label||t.label?($(),j("label",{key:0,for:t.name,class:J(["bal-radio-label",t.labelClasses]),onClick:s[1]||(s[1]=Ge(d=>t.onChange(t.value),["prevent"]))},[je(t.$slots,"label",{},()=>[Je(He(t.label),1)])],10,ht)):Ze("",!0)])}const Ut=ot(mt,[["render",kt]]),wt=[{inputs:[{internalType:"contract IVault",name:"vault",type:"address"},{internalType:"contract IProtocolFeePercentagesProvider",name:"protocolFeeProvider",type:"address"},{internalType:"string",name:"factoryVersion",type:"string"},{internalType:"string",name:"poolVersion",type:"string"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[],name:"FactoryDisabled",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"pool",type:"address"}],name:"PoolCreated",type:"event"},{inputs:[{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"symbol",type:"string"},{internalType:"contract IERC20[]",name:"tokens",type:"address[]"},{internalType:"uint256[]",name:"normalizedWeights",type:"uint256[]"},{internalType:"contract IRateProvider[]",name:"rateProviders",type:"address[]"},{internalType:"uint256",name:"swapFeePercentage",type:"uint256"},{internalType:"address",name:"owner",type:"address"},{internalType:"bytes32",name:"salt",type:"bytes32"}],name:"create",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"disable",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"selector",type:"bytes4"}],name:"getActionId",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"getAuthorizer",outputs:[{internalType:"contract IAuthorizer",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getCreationCode",outputs:[{internalType:"bytes",name:"",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[],name:"getCreationCodeContracts",outputs:[{internalType:"address",name:"contractA",type:"address"},{internalType:"address",name:"contractB",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getPauseConfiguration",outputs:[{internalType:"uint256",name:"pauseWindowDuration",type:"uint256"},{internalType:"uint256",name:"bufferPeriodDuration",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"getPoolVersion",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"getProtocolFeePercentagesProvider",outputs:[{internalType:"contract IProtocolFeePercentagesProvider",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getVault",outputs:[{internalType:"contract IVault",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"isDisabled",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"pool",type:"address"}],name:"isPoolFromFactory",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"version",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"}];var Tt=yt();function bt(t,s,a){if(t instanceof Uint8Array)return a?new Uint8Array(t):t;if(typeof t=="string"&&t.match(/^0x([0-9a-f][0-9a-f])*$/i)){const i=new Uint8Array((t.length-2)/2);let r=2;for(let u=0;u<i.length;u++)i[u]=parseInt(t.substring(r,r+2),16),r+=2;return i}throw new Error("invalid BytesLike value")}function se(t,s){return bt(t,s,!1)}const Q="0123456789abcdef";function At(t){const s=se(t);let a="0x";for(let i=0;i<s.length;i++){const r=s[i];a+=Q[(r&240)>>4]+Q[r&15]}return a}function Pt(t,s,a){const i=se(t),r=new Uint8Array(s);return r.fill(0),a?r.set(i,s-i.length):r.set(i,0),At(r)}function St(t,s){return Pt(t,s,!1)}function Ct(t){const s=It(t);if(s.length>31)throw new Error("bytes32 string must be less than 32 bytes");return St(s,32)}function It(t,s){s!=null&&(t=t.normalize(s));const a=[];for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);if(r<128)a.push(r);else if(r<2048)a.push(r>>6|192),a.push(r&63|128);else if((r&64512)==55296){i++;const u=t.charCodeAt(i),d=65536+((r&1023)<<10)+(u&1023);a.push(d>>18|240),a.push(d>>12&63|128),a.push(d>>6&63|128),a.push(d&63|128)}else a.push(r>>12|224),a.push(r>>6&63|128),a.push(r&63|128)}return new Uint8Array(a)}function Ft(){return Ct(Bt(31))}const Bt=t=>{const s=[..."!\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"],a=s.length,i=Math.floor(65536/a)*a-1,r=2*Math.ceil(1.1*t);let u="",d=0;for(;d<t;){const f=Tt.randomBytes(r);let c=0;const y=(g,b)=>g[b]+(g[b+1]<<8);for(;c<r&&d<t;){const g=y(f,c);c+=2,!(g>i)&&(u+=s[g%a],d++)}}return u},Mt=0;class xt{async create(s,a,i,r,u,d){if(!d.length)return Promise.reject("No pool owner specified");const f=u.map(F=>F.tokenAddress),c=this.calculateTokenWeights(u),y=ee(new I(r),18),g=Array(f.length).fill(te.ZeroAddress),b=[a,i,f,c,g,y.toString(),d,Ft()];return await new H(s.getSigner()).contract.sendTransaction({contractAddress:T.network.addresses.weightedPoolFactory,abi:wt,action:"create",params:b})}async retrievePoolIdAndAddress(s,a){const i=await s.getTransactionReceipt(a);if(!i)return null;const r=C.WeightedPoolFactory__factory.createInterface(),u=i.logs.filter(y=>y.address===T.network.addresses.weightedPoolFactory).map(y=>{try{return r.parseLog(y)}catch{return null}}).find(y=>(y==null?void 0:y.name)==="PoolCreated");if(!u)return null;const d=u.args.pool;return{id:await C.WeightedPool__factory.connect(d,s).getPoolId(),address:d}}async retrievePoolDetails(s,a){if(!a)return;const i=await this.retrievePoolIdAndAddress(s,a);if(i===null)return;const r=i.address,u=T.network.addresses.vault,d=Ye(),f=new d(T.network.key,s,[...C.WeightedPool__factory.abi,...C.Vault__factory.abi]);f.call("name",r,"name"),f.call("symbol",r,"symbol"),f.call("owner",r,"getOwner"),f.call("weights",r,"getNormalizedWeights"),f.call("tokenInfo",u,"getPoolTokens",[i.id]);const c=await f.execute();return{weights:c.weights.map(g=>Xe(g,18)),name:c.name,owner:c.owner,symbol:c.symbol,tokens:c.tokenInfo.tokens}}async initJoin(s,a,i,r,u,d){const f=et.encode(["uint256","uint256[]"],[Mt,d]),c=this.value(d,u);u=this.parseTokensIn(u);const y={assets:u,maxAmountsIn:d,userData:f,fromInternalBalance:!1},g=T.network.addresses.vault;return await new H(s.getSigner()).contract.sendTransaction({contractAddress:g,abi:C.Vault__factory.abi,action:"joinPool",params:[a,i,r,y],options:{value:c}})}calculateTokenWeights(s){const a=s.map(u=>{const d=new I(u.weight).multipliedBy(new I(1e16));return Z.from(d.toString())});return pt(a).map(u=>u.toString())}value(s,a){let i="0";const r=T.network.nativeAsset;return s.forEach((u,d)=>{a[d]===r.address&&(i=u)}),Z.from(i)}parseTokensIn(s){const a=T.network.nativeAsset;return s.map(i=>P(i,a.address)?tt:i)}}class oe{constructor(){W(this,"weighted");this.weighted=new xt}}new oe;class Lt{constructor(){W(this,"pools");this.pools=new oe}}const L=new Lt,Nt="1.0",G="poolCreationState",ae={name:"",seedTokens:[],activeStep:0,initialFee:"0.003",isFeeGovManaged:!1,feeManagementType:"governance",feeType:"fixed",feeController:"self",thirdPartyFeeController:"",fee:"",tokensList:[],poolId:"",poolAddress:"",symbol:"",manuallySetToken:"",autoOptimiseBalances:!1,useNativeAsset:!1,type:ne.Weighted,needsSeeding:!1,createPoolTxHash:""},n=Ke({...ae}),Y=X([]),N=X(null);function $t(){const{balanceFor:t,priceFor:s,getToken:a,nativeAsset:i,wrappedNativeAsset:r,balancerTokenListTokens:u,dynamicDataLoading:d}=nt(),{account:f,getProvider:c}=st(),{txListener:y}=dt(),{addTransaction:g}=ct(),b=T.network.unknown,A=m(()=>[...n.tokensList].sort((e,o)=>e>o?1:-1)),F=m(()=>A.value.some(e=>e&&D(e)));function E(){var M,x;const e=A.value.filter(w=>w!==""),o={};if(d.value)return o;let l=e[0],p=h(t(e[0])).times(s(e[0]));for(const w of e){const U=h(t(w)).times(s(w));U.lt(p)&&(p=U,l=w)}let v=((M=n.seedTokens.find(w=>P(w.tokenAddress,l)))==null?void 0:M.weight)||0,k=s(l||"0");if(n.useNativeAsset&&l===r.value.address&&(l=i.address,v=((x=n.seedTokens.find(w=>P(w.tokenAddress,r.value.address)))==null?void 0:x.weight)||0,k=s(r.value.address)),!l)return o;const O=h(k).times(t(l)).div(v);return V(O)}const re=m(()=>{const e={},o=n.manuallySetToken===i.address?r.value.address:n.manuallySetToken,l=Ae(o);if(!l)return e;const p=h(s(l.tokenAddress||"0")).times(l.amount).div(l.weight);return V(p)}),ie=m(()=>K.sumBy(Object.values(E()),e=>Number(e.liquidityRequired))),le=m(()=>{let e=h(0);for(const o of A.value)e=e.plus(h(s(o)).times(t(o)));return e}),ue=m(()=>{let e=h(0);for(const o of n.seedTokens)e=e.plus(h(o.amount).times(s(o.tokenAddress)));return e}),de=m(()=>{let e=h(0);for(const o of n.seedTokens)e=e.plus(h(o.amount).times(s(o.tokenAddress)));return e}),ce=m(()=>{switch(n.type){case ne.Weighted:return"weighted";default:return""}}),pe=m(()=>A.value.filter(o=>o!=="").filter(o=>s(o)===0)),S=m(()=>{var e;return K.flatten((e=ge.value)==null?void 0:e.pages.map(o=>o.pools))}),fe=m(()=>{var o;return(o=S.value)!=null&&o.length?S.value.find(l=>{if(l.swapFee===n.initialFee){let p=!0;for(const v of l.tokens){const k=n.seedTokens.find(x=>P(x.tokenAddress,v.address)),O=Number(v.weight).toFixed(2),M=(((k==null?void 0:k.weight)||0)/100).toFixed(2);O!==M&&(p=!1)}return p}return!1}):null}),ye=m(()=>at(A.value,ft())),me=m(()=>n.feeManagementType==="governance"?te.DelegateOwner:n.feeController==="self"?f.value:n.thirdPartyFeeController),{data:ge,isLoading:ve}=ut(A,{},{isExactTokensList:!0});function he(){for(const e of Object.keys(n))n[e]=ae[e];R(!1),_()}function ke(e){n.seedTokens=e}function we(){n.seedTokens.sort((e,o)=>e.tokenAddress.toLowerCase()>o.tokenAddress.toLowerCase()?1:-1)}function Te(){!S.value.length&&n.activeStep===1?n.activeStep+=2:n.activeStep+=1,B()}function be(){if(!S.value.length&&n.activeStep===3){n.activeStep-=2;return}n.activeStep-=1,N.value&&R(!1)}function Ae(e){return n.seedTokens.find(o=>P(o.tokenAddress,e))}function Pe(e){n.feeManagementType=e}function Se(e){n.feeType=e}function Ce(e){n.activeStep=e}function Ie(e){n.feeController=e}function Fe(e){n.thirdPartyFeeController=e}function Be(e){Y.value=e}function Me(e){n.manuallySetToken=e}function xe(){for(const e of n.seedTokens)e.amount="0"}function Le(){for(const e of n.seedTokens)e.amount=t(e.tokenAddress)}function Ne(e){n.tokensList=e}function V(e){const o={};for(const l of n.seedTokens){const p=h(s(l.tokenAddress)),v=e.times(l.weight),k=v.div(p);o[l.tokenAddress]={liquidityRequired:v.toString(),balanceRequired:k.toString()}}return o}function _e(){return n.seedTokens.map(o=>o.amount)}function z(){return n.seedTokens.map(o=>{const l=a(o.tokenAddress);if(!l)return"0";const p=new I(o.amount);return ee(p,l.decimals).toFixed(0,I.ROUND_FLOOR)})}function Re(){let e=!0;const o=n.seedTokens.map(l=>{const p=Math.round(l.weight),v=a(l.tokenAddress);return v||(e=!1),v?`${Math.round(p)}${v.symbol}`:""});return e?o.join("-"):""}async function qe(){if(F.value&&!b)throw new Error("Invalid pool creation due to unlisted tokens.");const e=c(),o=await L.pools.weighted.create(e,n.name,n.symbol,n.initialFee,n.seedTokens,me.value);return n.createPoolTxHash=o.hash,B(),g({id:o.hash,type:"tx",action:"createPool",summary:n.name,details:{name:n.name}}),y(o,{onTxConfirmed:async()=>{q(o.hash)},onTxFailed:()=>{console.log("Create failed")}}),o}async function Oe(){const e=c(),o=n.seedTokens.map(p=>P(p.tokenAddress,r.value.address)&&n.useNativeAsset?i.address:p.tokenAddress),l=await L.pools.weighted.initJoin(e,n.poolId,f.value,f.value,o,z());return g({id:l.hash,type:"tx",action:"fundPool",summary:n.name}),y(l,{onTxConfirmed:async()=>{_()},onTxFailed:()=>{console.log("Seed failed")}}),l}function We(e){n.activeStep=e}function B(){rt(G,JSON.stringify(n),Nt)}function _(){it(G)}function Ee(e){for(const o of Object.keys(n))if(o!=="activeStep"){if(o==="seedTokens"){const l=e.seedTokens.filter(p=>!!p.tokenAddress);n.seedTokens=l;continue}n[o]=e[o]}}function R(e){N.value=e}async function q(e){const o=await L.pools.weighted.retrievePoolIdAndAddress(c(),e);o!==null&&(n.poolId=o.id,n.poolAddress=o.address,n.needsSeeding=!0,B())}async function Ve(e){const o=await L.pools.weighted.retrievePoolDetails(c(),e);o&&(n.seedTokens=o.tokens.map((l,p)=>({tokenAddress:lt(l),weight:Number(o.weights[p])*100,isLocked:!0,amount:"0",id:p.toString()})).filter(l=>!!l.tokenAddress),n.tokensList=o.tokens,n.createPoolTxHash=e,n.activeStep=3,N.value=!0,await q(e))}function D(e){return e!==""&&!u.value[e]}return{...Qe(n),updateTokenWeights:ke,proceed:Te,setFeeManagement:Pe,setFeeType:Se,setFeeController:Ie,setTrpController:Fe,setStep:Ce,resetPoolCreationState:he,updateTokenColors:Be,goBack:be,getPoolSymbol:Re,getAmounts:_e,getScaledAmounts:z,createPool:qe,joinPool:Oe,setActiveStep:We,updateManuallySetToken:Me,sortSeedTokens:we,clearAmounts:xe,setAmountsToMaxBalances:Le,saveState:B,resetState:_,importState:Ee,setRestoredState:R,setTokensList:Ne,retrievePoolAddress:q,retrievePoolDetails:Ve,getOptimisedLiquidity:E,currentLiquidity:ue,scaledLiquidity:re,tokensWithNoPrice:pe,similarPools:S,isLoadingSimilarPools:ve,existingPool:fe,totalLiquidity:le,maxInitialLiquidity:ie,poolLiquidity:de,poolTypeString:ce,tokenColors:Y,isWrappedNativeAssetPool:ye,hasUnlistedToken:F,hasRestoredFromSavedState:N,isUnlistedToken:D}}export{Nt as P,Ut as _,G as a,n as p,$t as u};
//# sourceMappingURL=usePoolCreation-7a9d29c4.js.map
