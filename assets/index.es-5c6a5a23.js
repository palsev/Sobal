import{e as _t}from"./events-5f626723.js";import{t as wt}from"./tslib-31d961eb.js";import{c as lt,g as $a}from"./_commonjsHelpers-87174ba5.js";import{c as ja}from"./_commonjs-dynamic-modules-302442b1.js";import{r as Ba}from"./index-9df68fbf.js";import{T as Tt}from"./connector-d867b6ec.js";import{g as bt}from"./runtime-core.esm-bundler-24a2b16f.js";var $i={},Jr={},se={},jn={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});function e(c,u){var g=c>>>16&65535,b=c&65535,x=u>>>16&65535,N=u&65535;return b*N+(g*N+b*x<<16>>>0)|0}t.mul=Math.imul||e;function r(c,u){return c+u|0}t.add=r;function i(c,u){return c-u|0}t.sub=i;function s(c,u){return c<<u|c>>>32-u}t.rotl=s;function a(c,u){return c<<32-u|c>>>u}t.rotr=a;function h(c){return typeof c=="number"&&isFinite(c)&&Math.floor(c)===c}t.isInteger=Number.isInteger||h,t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(c){return t.isInteger(c)&&c>=-t.MAX_SAFE_INTEGER&&c<=t.MAX_SAFE_INTEGER}})(jn);Object.defineProperty(se,"__esModule",{value:!0});var Bn=jn;function za(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])<<16>>16}se.readInt16BE=za;function qa(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])>>>0}se.readUint16BE=qa;function Ka(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])<<16>>16}se.readInt16LE=Ka;function Ha(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])>>>0}se.readUint16LE=Ha;function zn(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>8,e[r+1]=t>>>0,e}se.writeUint16BE=zn;se.writeInt16BE=zn;function qn(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e}se.writeUint16LE=qn;se.writeInt16LE=qn;function xi(t,e){return e===void 0&&(e=0),t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}se.readInt32BE=xi;function Ii(t,e){return e===void 0&&(e=0),(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}se.readUint32BE=Ii;function Oi(t,e){return e===void 0&&(e=0),t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}se.readInt32LE=Oi;function Ti(t,e){return e===void 0&&(e=0),(t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e])>>>0}se.readUint32LE=Ti;function qr(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>24,e[r+1]=t>>>16,e[r+2]=t>>>8,e[r+3]=t>>>0,e}se.writeUint32BE=qr;se.writeInt32BE=qr;function Kr(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24,e}se.writeUint32LE=Kr;se.writeInt32LE=Kr;function Va(t,e){e===void 0&&(e=0);var r=xi(t,e),i=xi(t,e+4);return r*4294967296+i-(i>>31)*4294967296}se.readInt64BE=Va;function ka(t,e){e===void 0&&(e=0);var r=Ii(t,e),i=Ii(t,e+4);return r*4294967296+i}se.readUint64BE=ka;function Ga(t,e){e===void 0&&(e=0);var r=Oi(t,e),i=Oi(t,e+4);return i*4294967296+r-(r>>31)*4294967296}se.readInt64LE=Ga;function Wa(t,e){e===void 0&&(e=0);var r=Ti(t,e),i=Ti(t,e+4);return i*4294967296+r}se.readUint64LE=Wa;function Kn(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),qr(t/4294967296>>>0,e,r),qr(t>>>0,e,r+4),e}se.writeUint64BE=Kn;se.writeInt64BE=Kn;function Hn(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),Kr(t>>>0,e,r),Kr(t/4294967296>>>0,e,r+4),e}se.writeUint64LE=Hn;se.writeInt64LE=Hn;function Ya(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var i=0,s=1,a=t/8+r-1;a>=r;a--)i+=e[a]*s,s*=256;return i}se.readUintBE=Ya;function Ja(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var i=0,s=1,a=r;a<r+t/8;a++)i+=e[a]*s,s*=256;return i}se.readUintLE=Ja;function Xa(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!Bn.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var s=1,a=t/8+i-1;a>=i;a--)r[a]=e/s&255,s*=256;return r}se.writeUintBE=Xa;function Qa(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!Bn.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var s=1,a=i;a<i+t/8;a++)r[a]=e/s&255,s*=256;return r}se.writeUintLE=Qa;function Za(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e)}se.readFloat32BE=Za;function ec(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e,!0)}se.readFloat32LE=ec;function tc(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e)}se.readFloat64BE=tc;function rc(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e,!0)}se.readFloat64LE=rc;function ic(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t),e}se.writeFloat32BE=ic;function sc(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t,!0),e}se.writeFloat32LE=sc;function nc(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t),e}se.writeFloat64BE=nc;function oc(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t,!0),e}se.writeFloat64LE=oc;var ft={};Object.defineProperty(ft,"__esModule",{value:!0});function ac(t){for(var e=0;e<t.length;e++)t[e]=0;return t}ft.wipe=ac;Object.defineProperty(Jr,"__esModule",{value:!0});var rt=se,Ai=ft,cc=20;function uc(t,e,r){for(var i=1634760805,s=857760878,a=2036477234,h=1797285236,c=r[3]<<24|r[2]<<16|r[1]<<8|r[0],u=r[7]<<24|r[6]<<16|r[5]<<8|r[4],g=r[11]<<24|r[10]<<16|r[9]<<8|r[8],b=r[15]<<24|r[14]<<16|r[13]<<8|r[12],x=r[19]<<24|r[18]<<16|r[17]<<8|r[16],N=r[23]<<24|r[22]<<16|r[21]<<8|r[20],S=r[27]<<24|r[26]<<16|r[25]<<8|r[24],I=r[31]<<24|r[30]<<16|r[29]<<8|r[28],C=e[3]<<24|e[2]<<16|e[1]<<8|e[0],R=e[7]<<24|e[6]<<16|e[5]<<8|e[4],q=e[11]<<24|e[10]<<16|e[9]<<8|e[8],w=e[15]<<24|e[14]<<16|e[13]<<8|e[12],D=i,p=s,_=a,f=h,n=c,l=u,P=g,F=b,K=x,k=N,X=S,v=I,A=C,G=R,j=q,L=w,$=0;$<cc;$+=2)D=D+n|0,A^=D,A=A>>>32-16|A<<16,K=K+A|0,n^=K,n=n>>>32-12|n<<12,p=p+l|0,G^=p,G=G>>>32-16|G<<16,k=k+G|0,l^=k,l=l>>>32-12|l<<12,_=_+P|0,j^=_,j=j>>>32-16|j<<16,X=X+j|0,P^=X,P=P>>>32-12|P<<12,f=f+F|0,L^=f,L=L>>>32-16|L<<16,v=v+L|0,F^=v,F=F>>>32-12|F<<12,_=_+P|0,j^=_,j=j>>>32-8|j<<8,X=X+j|0,P^=X,P=P>>>32-7|P<<7,f=f+F|0,L^=f,L=L>>>32-8|L<<8,v=v+L|0,F^=v,F=F>>>32-7|F<<7,p=p+l|0,G^=p,G=G>>>32-8|G<<8,k=k+G|0,l^=k,l=l>>>32-7|l<<7,D=D+n|0,A^=D,A=A>>>32-8|A<<8,K=K+A|0,n^=K,n=n>>>32-7|n<<7,D=D+l|0,L^=D,L=L>>>32-16|L<<16,X=X+L|0,l^=X,l=l>>>32-12|l<<12,p=p+P|0,A^=p,A=A>>>32-16|A<<16,v=v+A|0,P^=v,P=P>>>32-12|P<<12,_=_+F|0,G^=_,G=G>>>32-16|G<<16,K=K+G|0,F^=K,F=F>>>32-12|F<<12,f=f+n|0,j^=f,j=j>>>32-16|j<<16,k=k+j|0,n^=k,n=n>>>32-12|n<<12,_=_+F|0,G^=_,G=G>>>32-8|G<<8,K=K+G|0,F^=K,F=F>>>32-7|F<<7,f=f+n|0,j^=f,j=j>>>32-8|j<<8,k=k+j|0,n^=k,n=n>>>32-7|n<<7,p=p+P|0,A^=p,A=A>>>32-8|A<<8,v=v+A|0,P^=v,P=P>>>32-7|P<<7,D=D+l|0,L^=D,L=L>>>32-8|L<<8,X=X+L|0,l^=X,l=l>>>32-7|l<<7;rt.writeUint32LE(D+i|0,t,0),rt.writeUint32LE(p+s|0,t,4),rt.writeUint32LE(_+a|0,t,8),rt.writeUint32LE(f+h|0,t,12),rt.writeUint32LE(n+c|0,t,16),rt.writeUint32LE(l+u|0,t,20),rt.writeUint32LE(P+g|0,t,24),rt.writeUint32LE(F+b|0,t,28),rt.writeUint32LE(K+x|0,t,32),rt.writeUint32LE(k+N|0,t,36),rt.writeUint32LE(X+S|0,t,40),rt.writeUint32LE(v+I|0,t,44),rt.writeUint32LE(A+C|0,t,48),rt.writeUint32LE(G+R|0,t,52),rt.writeUint32LE(j+q|0,t,56),rt.writeUint32LE(L+w|0,t,60)}function Vn(t,e,r,i,s){if(s===void 0&&(s=0),t.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(i.length<r.length)throw new Error("ChaCha: destination is shorter than source");var a,h;if(s===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");a=new Uint8Array(16),h=a.length-e.length,a.set(e,h)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");a=e,h=s}for(var c=new Uint8Array(64),u=0;u<r.length;u+=64){uc(c,a,t);for(var g=u;g<u+64&&g<r.length;g++)i[g]=r[g]^c[g-u];lc(a,0,h)}return Ai.wipe(c),s===0&&Ai.wipe(a),i}Jr.streamXOR=Vn;function hc(t,e,r,i){return i===void 0&&(i=0),Ai.wipe(r),Vn(t,e,r,r,i)}Jr.stream=hc;function lc(t,e,r){for(var i=1;r--;)i=i+(t[e]&255)|0,t[e]=i&255,i>>>=8,e++;if(i>0)throw new Error("ChaCha: counter overflow")}var kn={},zt={};Object.defineProperty(zt,"__esModule",{value:!0});function fc(t,e,r){return~(t-1)&e|t-1&r}zt.select=fc;function dc(t,e){return(t|0)-(e|0)-1>>>31&1}zt.lessOrEqual=dc;function Gn(t,e){if(t.length!==e.length)return 0;for(var r=0,i=0;i<t.length;i++)r|=t[i]^e[i];return 1&r-1>>>8}zt.compare=Gn;function gc(t,e){return t.length===0||e.length===0?!1:Gn(t,e)!==0}zt.equal=gc;(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=zt,r=ft;t.DIGEST_LENGTH=16;var i=function(){function h(c){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var u=c[0]|c[1]<<8;this._r[0]=u&8191;var g=c[2]|c[3]<<8;this._r[1]=(u>>>13|g<<3)&8191;var b=c[4]|c[5]<<8;this._r[2]=(g>>>10|b<<6)&7939;var x=c[6]|c[7]<<8;this._r[3]=(b>>>7|x<<9)&8191;var N=c[8]|c[9]<<8;this._r[4]=(x>>>4|N<<12)&255,this._r[5]=N>>>1&8190;var S=c[10]|c[11]<<8;this._r[6]=(N>>>14|S<<2)&8191;var I=c[12]|c[13]<<8;this._r[7]=(S>>>11|I<<5)&8065;var C=c[14]|c[15]<<8;this._r[8]=(I>>>8|C<<8)&8191,this._r[9]=C>>>5&127,this._pad[0]=c[16]|c[17]<<8,this._pad[1]=c[18]|c[19]<<8,this._pad[2]=c[20]|c[21]<<8,this._pad[3]=c[22]|c[23]<<8,this._pad[4]=c[24]|c[25]<<8,this._pad[5]=c[26]|c[27]<<8,this._pad[6]=c[28]|c[29]<<8,this._pad[7]=c[30]|c[31]<<8}return h.prototype._blocks=function(c,u,g){for(var b=this._fin?0:2048,x=this._h[0],N=this._h[1],S=this._h[2],I=this._h[3],C=this._h[4],R=this._h[5],q=this._h[6],w=this._h[7],D=this._h[8],p=this._h[9],_=this._r[0],f=this._r[1],n=this._r[2],l=this._r[3],P=this._r[4],F=this._r[5],K=this._r[6],k=this._r[7],X=this._r[8],v=this._r[9];g>=16;){var A=c[u+0]|c[u+1]<<8;x+=A&8191;var G=c[u+2]|c[u+3]<<8;N+=(A>>>13|G<<3)&8191;var j=c[u+4]|c[u+5]<<8;S+=(G>>>10|j<<6)&8191;var L=c[u+6]|c[u+7]<<8;I+=(j>>>7|L<<9)&8191;var $=c[u+8]|c[u+9]<<8;C+=(L>>>4|$<<12)&8191,R+=$>>>1&8191;var U=c[u+10]|c[u+11]<<8;q+=($>>>14|U<<2)&8191;var B=c[u+12]|c[u+13]<<8;w+=(U>>>11|B<<5)&8191;var te=c[u+14]|c[u+15]<<8;D+=(B>>>8|te<<8)&8191,p+=te>>>5|b;var z=0,Z=z;Z+=x*_,Z+=N*(5*v),Z+=S*(5*X),Z+=I*(5*k),Z+=C*(5*K),z=Z>>>13,Z&=8191,Z+=R*(5*F),Z+=q*(5*P),Z+=w*(5*l),Z+=D*(5*n),Z+=p*(5*f),z+=Z>>>13,Z&=8191;var Y=z;Y+=x*f,Y+=N*_,Y+=S*(5*v),Y+=I*(5*X),Y+=C*(5*k),z=Y>>>13,Y&=8191,Y+=R*(5*K),Y+=q*(5*F),Y+=w*(5*P),Y+=D*(5*l),Y+=p*(5*n),z+=Y>>>13,Y&=8191;var ee=z;ee+=x*n,ee+=N*f,ee+=S*_,ee+=I*(5*v),ee+=C*(5*X),z=ee>>>13,ee&=8191,ee+=R*(5*k),ee+=q*(5*K),ee+=w*(5*F),ee+=D*(5*P),ee+=p*(5*l),z+=ee>>>13,ee&=8191;var T=z;T+=x*l,T+=N*n,T+=S*f,T+=I*_,T+=C*(5*v),z=T>>>13,T&=8191,T+=R*(5*X),T+=q*(5*k),T+=w*(5*K),T+=D*(5*F),T+=p*(5*P),z+=T>>>13,T&=8191;var O=z;O+=x*P,O+=N*l,O+=S*n,O+=I*f,O+=C*_,z=O>>>13,O&=8191,O+=R*(5*v),O+=q*(5*X),O+=w*(5*k),O+=D*(5*K),O+=p*(5*F),z+=O>>>13,O&=8191;var m=z;m+=x*F,m+=N*P,m+=S*l,m+=I*n,m+=C*f,z=m>>>13,m&=8191,m+=R*_,m+=q*(5*v),m+=w*(5*X),m+=D*(5*k),m+=p*(5*K),z+=m>>>13,m&=8191;var o=z;o+=x*K,o+=N*F,o+=S*P,o+=I*l,o+=C*n,z=o>>>13,o&=8191,o+=R*f,o+=q*_,o+=w*(5*v),o+=D*(5*X),o+=p*(5*k),z+=o>>>13,o&=8191;var y=z;y+=x*k,y+=N*K,y+=S*F,y+=I*P,y+=C*l,z=y>>>13,y&=8191,y+=R*n,y+=q*f,y+=w*_,y+=D*(5*v),y+=p*(5*X),z+=y>>>13,y&=8191;var H=z;H+=x*X,H+=N*k,H+=S*K,H+=I*F,H+=C*P,z=H>>>13,H&=8191,H+=R*l,H+=q*n,H+=w*f,H+=D*_,H+=p*(5*v),z+=H>>>13,H&=8191;var W=z;W+=x*v,W+=N*X,W+=S*k,W+=I*K,W+=C*F,z=W>>>13,W&=8191,W+=R*P,W+=q*l,W+=w*n,W+=D*f,W+=p*_,z+=W>>>13,W&=8191,z=(z<<2)+z|0,z=z+Z|0,Z=z&8191,z=z>>>13,Y+=z,x=Z,N=Y,S=ee,I=T,C=O,R=m,q=o,w=y,D=H,p=W,u+=16,g-=16}this._h[0]=x,this._h[1]=N,this._h[2]=S,this._h[3]=I,this._h[4]=C,this._h[5]=R,this._h[6]=q,this._h[7]=w,this._h[8]=D,this._h[9]=p},h.prototype.finish=function(c,u){u===void 0&&(u=0);var g=new Uint16Array(10),b,x,N,S;if(this._leftover){for(S=this._leftover,this._buffer[S++]=1;S<16;S++)this._buffer[S]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(b=this._h[1]>>>13,this._h[1]&=8191,S=2;S<10;S++)this._h[S]+=b,b=this._h[S]>>>13,this._h[S]&=8191;for(this._h[0]+=b*5,b=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=b,b=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=b,g[0]=this._h[0]+5,b=g[0]>>>13,g[0]&=8191,S=1;S<10;S++)g[S]=this._h[S]+b,b=g[S]>>>13,g[S]&=8191;for(g[9]-=1<<13,x=(b^1)-1,S=0;S<10;S++)g[S]&=x;for(x=~x,S=0;S<10;S++)this._h[S]=this._h[S]&x|g[S];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,N=this._h[0]+this._pad[0],this._h[0]=N&65535,S=1;S<8;S++)N=(this._h[S]+this._pad[S]|0)+(N>>>16)|0,this._h[S]=N&65535;return c[u+0]=this._h[0]>>>0,c[u+1]=this._h[0]>>>8,c[u+2]=this._h[1]>>>0,c[u+3]=this._h[1]>>>8,c[u+4]=this._h[2]>>>0,c[u+5]=this._h[2]>>>8,c[u+6]=this._h[3]>>>0,c[u+7]=this._h[3]>>>8,c[u+8]=this._h[4]>>>0,c[u+9]=this._h[4]>>>8,c[u+10]=this._h[5]>>>0,c[u+11]=this._h[5]>>>8,c[u+12]=this._h[6]>>>0,c[u+13]=this._h[6]>>>8,c[u+14]=this._h[7]>>>0,c[u+15]=this._h[7]>>>8,this._finished=!0,this},h.prototype.update=function(c){var u=0,g=c.length,b;if(this._leftover){b=16-this._leftover,b>g&&(b=g);for(var x=0;x<b;x++)this._buffer[this._leftover+x]=c[u+x];if(g-=b,u+=b,this._leftover+=b,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(g>=16&&(b=g-g%16,this._blocks(c,u,b),u+=b,g-=b),g){for(var x=0;x<g;x++)this._buffer[this._leftover+x]=c[u+x];this._leftover+=g}return this},h.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var c=new Uint8Array(16);return this.finish(c),c},h.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},h}();t.Poly1305=i;function s(h,c){var u=new i(h);u.update(c);var g=u.digest();return u.clean(),g}t.oneTimeAuth=s;function a(h,c){return h.length!==t.DIGEST_LENGTH||c.length!==t.DIGEST_LENGTH?!1:e.equal(h,c)}t.equal=a})(kn);(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Jr,r=kn,i=ft,s=se,a=zt;t.KEY_LENGTH=32,t.NONCE_LENGTH=12,t.TAG_LENGTH=16;var h=new Uint8Array(16),c=function(){function u(g){if(this.nonceLength=t.NONCE_LENGTH,this.tagLength=t.TAG_LENGTH,g.length!==t.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(g)}return u.prototype.seal=function(g,b,x,N){if(g.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var S=new Uint8Array(16);S.set(g,S.length-g.length);var I=new Uint8Array(32);e.stream(this._key,S,I,4);var C=b.length+this.tagLength,R;if(N){if(N.length!==C)throw new Error("ChaCha20Poly1305: incorrect destination length");R=N}else R=new Uint8Array(C);return e.streamXOR(this._key,S,b,R,4),this._authenticate(R.subarray(R.length-this.tagLength,R.length),I,R.subarray(0,R.length-this.tagLength),x),i.wipe(S),R},u.prototype.open=function(g,b,x,N){if(g.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(b.length<this.tagLength)return null;var S=new Uint8Array(16);S.set(g,S.length-g.length);var I=new Uint8Array(32);e.stream(this._key,S,I,4);var C=new Uint8Array(this.tagLength);if(this._authenticate(C,I,b.subarray(0,b.length-this.tagLength),x),!a.equal(C,b.subarray(b.length-this.tagLength,b.length)))return null;var R=b.length-this.tagLength,q;if(N){if(N.length!==R)throw new Error("ChaCha20Poly1305: incorrect destination length");q=N}else q=new Uint8Array(R);return e.streamXOR(this._key,S,b.subarray(0,b.length-this.tagLength),q,4),i.wipe(S),q},u.prototype.clean=function(){return i.wipe(this._key),this},u.prototype._authenticate=function(g,b,x,N){var S=new r.Poly1305(b);N&&(S.update(N),N.length%16>0&&S.update(h.subarray(N.length%16))),S.update(x),x.length%16>0&&S.update(h.subarray(x.length%16));var I=new Uint8Array(8);N&&s.writeUint64LE(N.length,I),S.update(I),s.writeUint64LE(x.length,I),S.update(I);for(var C=S.digest(),R=0;R<C.length;R++)g[R]=C[R];S.clean(),i.wipe(C),i.wipe(I)},u}();t.ChaCha20Poly1305=c})($i);var Wn={},Ir={},ji={};Object.defineProperty(ji,"__esModule",{value:!0});function pc(t){return typeof t.saveState<"u"&&typeof t.restoreState<"u"&&typeof t.cleanSavedState<"u"}ji.isSerializableHash=pc;Object.defineProperty(Ir,"__esModule",{value:!0});var xt=ji,yc=zt,bc=ft,Yn=function(){function t(e,r){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(i).clean():i.set(r);for(var s=0;s<i.length;s++)i[s]^=54;this._inner.update(i);for(var s=0;s<i.length;s++)i[s]^=106;this._outer.update(i),xt.isSerializableHash(this._inner)&&xt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),bc.wipe(i)}return t.prototype.reset=function(){if(!xt.isSerializableHash(this._inner)||!xt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.clean=function(){xt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),xt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},t.prototype.update=function(e){return this._inner.update(e),this},t.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype.saveState=function(){if(!xt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},t.prototype.restoreState=function(e){if(!xt.isSerializableHash(this._inner)||!xt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.cleanSavedState=function(e){if(!xt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},t}();Ir.HMAC=Yn;function _c(t,e,r){var i=new Yn(t,e);i.update(r);var s=i.digest();return i.clean(),s}Ir.hmac=_c;Ir.equal=yc.equal;Object.defineProperty(Wn,"__esModule",{value:!0});var ys=Ir,bs=ft,wc=function(){function t(e,r,i,s){i===void 0&&(i=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=s;var a=ys.hmac(this._hash,i,r);this._hmac=new ys.HMAC(e,a),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return t.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},t.prototype.expand=function(e){for(var r=new Uint8Array(e),i=0;i<r.length;i++)this._bufpos===this._buffer.length&&this._fillBuffer(),r[i]=this._buffer[this._bufpos++];return r},t.prototype.clean=function(){this._hmac.clean(),bs.wipe(this._buffer),bs.wipe(this._counter),this._bufpos=0},t}(),mc=Wn.HKDF=wc,nr={},Xr={},Qr={};Object.defineProperty(Qr,"__esModule",{value:!0});Qr.BrowserRandomSource=void 0;const _s=65536;class Ec{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const r=new Uint8Array(e);for(let i=0;i<r.length;i+=_s)this._crypto.getRandomValues(r.subarray(i,i+Math.min(r.length-i,_s)));return r}}Qr.BrowserRandomSource=Ec;var Zr={};Object.defineProperty(Zr,"__esModule",{value:!0});Zr.NodeRandomSource=void 0;const vc=ft;class Dc{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof ja<"u"){const e=Ba();e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let r=this._crypto.randomBytes(e);if(r.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const i=new Uint8Array(e);for(let s=0;s<i.length;s++)i[s]=r[s];return(0,vc.wipe)(r),i}}Zr.NodeRandomSource=Dc;Object.defineProperty(Xr,"__esModule",{value:!0});Xr.SystemRandomSource=void 0;const Sc=Qr,xc=Zr;class Ic{constructor(){if(this.isAvailable=!1,this.name="",this._source=new Sc.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new xc.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}Xr.SystemRandomSource=Ic;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.randomStringForEntropy=t.randomString=t.randomUint32=t.randomBytes=t.defaultRandomSource=void 0;const e=Xr,r=se,i=ft;t.defaultRandomSource=new e.SystemRandomSource;function s(g,b=t.defaultRandomSource){return b.randomBytes(g)}t.randomBytes=s;function a(g=t.defaultRandomSource){const b=s(4,g),x=(0,r.readUint32LE)(b);return(0,i.wipe)(b),x}t.randomUint32=a;const h="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function c(g,b=h,x=t.defaultRandomSource){if(b.length<2)throw new Error("randomString charset is too short");if(b.length>256)throw new Error("randomString charset is too long");let N="";const S=b.length,I=256-256%S;for(;g>0;){const C=s(Math.ceil(g*256/I),x);for(let R=0;R<C.length&&g>0;R++){const q=C[R];q<I&&(N+=b.charAt(q%S),g--)}(0,i.wipe)(C)}return N}t.randomString=c;function u(g,b=h,x=t.defaultRandomSource){const N=Math.ceil(g/(Math.log(b.length)/Math.LN2));return c(N,b,x)}t.randomStringForEntropy=u})(nr);var ei={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=se,r=ft;t.DIGEST_LENGTH=32,t.BLOCK_SIZE=64;var i=function(){function c(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},c.prototype.update=function(u,g){if(g===void 0&&(g=u.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var b=0;if(this._bytesHashed+=g,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&g>0;)this._buffer[this._bufferLength++]=u[b++],g--;this._bufferLength===this.blockSize&&(a(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(g>=this.blockSize&&(b=a(this._temp,this._state,u,b,g),g%=this.blockSize);g>0;)this._buffer[this._bufferLength++]=u[b++],g--;return this},c.prototype.finish=function(u){if(!this._finished){var g=this._bytesHashed,b=this._bufferLength,x=g/536870912|0,N=g<<3,S=g%64<56?64:128;this._buffer[b]=128;for(var I=b+1;I<S-8;I++)this._buffer[I]=0;e.writeUint32BE(x,this._buffer,S-8),e.writeUint32BE(N,this._buffer,S-4),a(this._temp,this._state,this._buffer,0,S),this._finished=!0}for(var I=0;I<this.digestLength/4;I++)e.writeUint32BE(this._state[I],u,I*4);return this},c.prototype.digest=function(){var u=new Uint8Array(this.digestLength);return this.finish(u),u},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(u){return this._state.set(u.state),this._bufferLength=u.bufferLength,u.buffer&&this._buffer.set(u.buffer),this._bytesHashed=u.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(u){r.wipe(u.state),u.buffer&&r.wipe(u.buffer),u.bufferLength=0,u.bytesHashed=0},c}();t.SHA256=i;var s=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function a(c,u,g,b,x){for(;x>=64;){for(var N=u[0],S=u[1],I=u[2],C=u[3],R=u[4],q=u[5],w=u[6],D=u[7],p=0;p<16;p++){var _=b+p*4;c[p]=e.readUint32BE(g,_)}for(var p=16;p<64;p++){var f=c[p-2],n=(f>>>17|f<<32-17)^(f>>>19|f<<32-19)^f>>>10;f=c[p-15];var l=(f>>>7|f<<32-7)^(f>>>18|f<<32-18)^f>>>3;c[p]=(n+c[p-7]|0)+(l+c[p-16]|0)}for(var p=0;p<64;p++){var n=(((R>>>6|R<<26)^(R>>>11|R<<21)^(R>>>25|R<<7))+(R&q^~R&w)|0)+(D+(s[p]+c[p]|0)|0)|0,l=((N>>>2|N<<32-2)^(N>>>13|N<<32-13)^(N>>>22|N<<32-22))+(N&S^N&I^S&I)|0;D=w,w=q,q=R,R=C+n|0,C=I,I=S,S=N,N=n+l|0}u[0]+=N,u[1]+=S,u[2]+=I,u[3]+=C,u[4]+=R,u[5]+=q,u[6]+=w,u[7]+=D,b+=64,x-=64}return b}function h(c){var u=new i;u.update(c);var g=u.digest();return u.clean(),g}t.hash=h})(ei);var Bi={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.scalarMultBase=t.scalarMult=t.SHARED_KEY_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=void 0;const e=nr,r=ft;t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;function i(p){const _=new Float64Array(16);if(p)for(let f=0;f<p.length;f++)_[f]=p[f];return _}const s=new Uint8Array(32);s[0]=9;const a=i([56129,1]);function h(p){let _=1;for(let f=0;f<16;f++){let n=p[f]+_+65535;_=Math.floor(n/65536),p[f]=n-_*65536}p[0]+=_-1+37*(_-1)}function c(p,_,f){const n=~(f-1);for(let l=0;l<16;l++){const P=n&(p[l]^_[l]);p[l]^=P,_[l]^=P}}function u(p,_){const f=i(),n=i();for(let l=0;l<16;l++)n[l]=_[l];h(n),h(n),h(n);for(let l=0;l<2;l++){f[0]=n[0]-65517;for(let F=1;F<15;F++)f[F]=n[F]-65535-(f[F-1]>>16&1),f[F-1]&=65535;f[15]=n[15]-32767-(f[14]>>16&1);const P=f[15]>>16&1;f[14]&=65535,c(n,f,1-P)}for(let l=0;l<16;l++)p[2*l]=n[l]&255,p[2*l+1]=n[l]>>8}function g(p,_){for(let f=0;f<16;f++)p[f]=_[2*f]+(_[2*f+1]<<8);p[15]&=32767}function b(p,_,f){for(let n=0;n<16;n++)p[n]=_[n]+f[n]}function x(p,_,f){for(let n=0;n<16;n++)p[n]=_[n]-f[n]}function N(p,_,f){let n,l,P=0,F=0,K=0,k=0,X=0,v=0,A=0,G=0,j=0,L=0,$=0,U=0,B=0,te=0,z=0,Z=0,Y=0,ee=0,T=0,O=0,m=0,o=0,y=0,H=0,W=0,le=0,be=0,de=0,Ee=0,Fe=0,Ae=0,ye=f[0],ge=f[1],fe=f[2],ue=f[3],ce=f[4],ae=f[5],oe=f[6],re=f[7],he=f[8],pe=f[9],ie=f[10],_e=f[11],me=f[12],De=f[13],Se=f[14],ve=f[15];n=_[0],P+=n*ye,F+=n*ge,K+=n*fe,k+=n*ue,X+=n*ce,v+=n*ae,A+=n*oe,G+=n*re,j+=n*he,L+=n*pe,$+=n*ie,U+=n*_e,B+=n*me,te+=n*De,z+=n*Se,Z+=n*ve,n=_[1],F+=n*ye,K+=n*ge,k+=n*fe,X+=n*ue,v+=n*ce,A+=n*ae,G+=n*oe,j+=n*re,L+=n*he,$+=n*pe,U+=n*ie,B+=n*_e,te+=n*me,z+=n*De,Z+=n*Se,Y+=n*ve,n=_[2],K+=n*ye,k+=n*ge,X+=n*fe,v+=n*ue,A+=n*ce,G+=n*ae,j+=n*oe,L+=n*re,$+=n*he,U+=n*pe,B+=n*ie,te+=n*_e,z+=n*me,Z+=n*De,Y+=n*Se,ee+=n*ve,n=_[3],k+=n*ye,X+=n*ge,v+=n*fe,A+=n*ue,G+=n*ce,j+=n*ae,L+=n*oe,$+=n*re,U+=n*he,B+=n*pe,te+=n*ie,z+=n*_e,Z+=n*me,Y+=n*De,ee+=n*Se,T+=n*ve,n=_[4],X+=n*ye,v+=n*ge,A+=n*fe,G+=n*ue,j+=n*ce,L+=n*ae,$+=n*oe,U+=n*re,B+=n*he,te+=n*pe,z+=n*ie,Z+=n*_e,Y+=n*me,ee+=n*De,T+=n*Se,O+=n*ve,n=_[5],v+=n*ye,A+=n*ge,G+=n*fe,j+=n*ue,L+=n*ce,$+=n*ae,U+=n*oe,B+=n*re,te+=n*he,z+=n*pe,Z+=n*ie,Y+=n*_e,ee+=n*me,T+=n*De,O+=n*Se,m+=n*ve,n=_[6],A+=n*ye,G+=n*ge,j+=n*fe,L+=n*ue,$+=n*ce,U+=n*ae,B+=n*oe,te+=n*re,z+=n*he,Z+=n*pe,Y+=n*ie,ee+=n*_e,T+=n*me,O+=n*De,m+=n*Se,o+=n*ve,n=_[7],G+=n*ye,j+=n*ge,L+=n*fe,$+=n*ue,U+=n*ce,B+=n*ae,te+=n*oe,z+=n*re,Z+=n*he,Y+=n*pe,ee+=n*ie,T+=n*_e,O+=n*me,m+=n*De,o+=n*Se,y+=n*ve,n=_[8],j+=n*ye,L+=n*ge,$+=n*fe,U+=n*ue,B+=n*ce,te+=n*ae,z+=n*oe,Z+=n*re,Y+=n*he,ee+=n*pe,T+=n*ie,O+=n*_e,m+=n*me,o+=n*De,y+=n*Se,H+=n*ve,n=_[9],L+=n*ye,$+=n*ge,U+=n*fe,B+=n*ue,te+=n*ce,z+=n*ae,Z+=n*oe,Y+=n*re,ee+=n*he,T+=n*pe,O+=n*ie,m+=n*_e,o+=n*me,y+=n*De,H+=n*Se,W+=n*ve,n=_[10],$+=n*ye,U+=n*ge,B+=n*fe,te+=n*ue,z+=n*ce,Z+=n*ae,Y+=n*oe,ee+=n*re,T+=n*he,O+=n*pe,m+=n*ie,o+=n*_e,y+=n*me,H+=n*De,W+=n*Se,le+=n*ve,n=_[11],U+=n*ye,B+=n*ge,te+=n*fe,z+=n*ue,Z+=n*ce,Y+=n*ae,ee+=n*oe,T+=n*re,O+=n*he,m+=n*pe,o+=n*ie,y+=n*_e,H+=n*me,W+=n*De,le+=n*Se,be+=n*ve,n=_[12],B+=n*ye,te+=n*ge,z+=n*fe,Z+=n*ue,Y+=n*ce,ee+=n*ae,T+=n*oe,O+=n*re,m+=n*he,o+=n*pe,y+=n*ie,H+=n*_e,W+=n*me,le+=n*De,be+=n*Se,de+=n*ve,n=_[13],te+=n*ye,z+=n*ge,Z+=n*fe,Y+=n*ue,ee+=n*ce,T+=n*ae,O+=n*oe,m+=n*re,o+=n*he,y+=n*pe,H+=n*ie,W+=n*_e,le+=n*me,be+=n*De,de+=n*Se,Ee+=n*ve,n=_[14],z+=n*ye,Z+=n*ge,Y+=n*fe,ee+=n*ue,T+=n*ce,O+=n*ae,m+=n*oe,o+=n*re,y+=n*he,H+=n*pe,W+=n*ie,le+=n*_e,be+=n*me,de+=n*De,Ee+=n*Se,Fe+=n*ve,n=_[15],Z+=n*ye,Y+=n*ge,ee+=n*fe,T+=n*ue,O+=n*ce,m+=n*ae,o+=n*oe,y+=n*re,H+=n*he,W+=n*pe,le+=n*ie,be+=n*_e,de+=n*me,Ee+=n*De,Fe+=n*Se,Ae+=n*ve,P+=38*Y,F+=38*ee,K+=38*T,k+=38*O,X+=38*m,v+=38*o,A+=38*y,G+=38*H,j+=38*W,L+=38*le,$+=38*be,U+=38*de,B+=38*Ee,te+=38*Fe,z+=38*Ae,l=1,n=P+l+65535,l=Math.floor(n/65536),P=n-l*65536,n=F+l+65535,l=Math.floor(n/65536),F=n-l*65536,n=K+l+65535,l=Math.floor(n/65536),K=n-l*65536,n=k+l+65535,l=Math.floor(n/65536),k=n-l*65536,n=X+l+65535,l=Math.floor(n/65536),X=n-l*65536,n=v+l+65535,l=Math.floor(n/65536),v=n-l*65536,n=A+l+65535,l=Math.floor(n/65536),A=n-l*65536,n=G+l+65535,l=Math.floor(n/65536),G=n-l*65536,n=j+l+65535,l=Math.floor(n/65536),j=n-l*65536,n=L+l+65535,l=Math.floor(n/65536),L=n-l*65536,n=$+l+65535,l=Math.floor(n/65536),$=n-l*65536,n=U+l+65535,l=Math.floor(n/65536),U=n-l*65536,n=B+l+65535,l=Math.floor(n/65536),B=n-l*65536,n=te+l+65535,l=Math.floor(n/65536),te=n-l*65536,n=z+l+65535,l=Math.floor(n/65536),z=n-l*65536,n=Z+l+65535,l=Math.floor(n/65536),Z=n-l*65536,P+=l-1+37*(l-1),l=1,n=P+l+65535,l=Math.floor(n/65536),P=n-l*65536,n=F+l+65535,l=Math.floor(n/65536),F=n-l*65536,n=K+l+65535,l=Math.floor(n/65536),K=n-l*65536,n=k+l+65535,l=Math.floor(n/65536),k=n-l*65536,n=X+l+65535,l=Math.floor(n/65536),X=n-l*65536,n=v+l+65535,l=Math.floor(n/65536),v=n-l*65536,n=A+l+65535,l=Math.floor(n/65536),A=n-l*65536,n=G+l+65535,l=Math.floor(n/65536),G=n-l*65536,n=j+l+65535,l=Math.floor(n/65536),j=n-l*65536,n=L+l+65535,l=Math.floor(n/65536),L=n-l*65536,n=$+l+65535,l=Math.floor(n/65536),$=n-l*65536,n=U+l+65535,l=Math.floor(n/65536),U=n-l*65536,n=B+l+65535,l=Math.floor(n/65536),B=n-l*65536,n=te+l+65535,l=Math.floor(n/65536),te=n-l*65536,n=z+l+65535,l=Math.floor(n/65536),z=n-l*65536,n=Z+l+65535,l=Math.floor(n/65536),Z=n-l*65536,P+=l-1+37*(l-1),p[0]=P,p[1]=F,p[2]=K,p[3]=k,p[4]=X,p[5]=v,p[6]=A,p[7]=G,p[8]=j,p[9]=L,p[10]=$,p[11]=U,p[12]=B,p[13]=te,p[14]=z,p[15]=Z}function S(p,_){N(p,_,_)}function I(p,_){const f=i();for(let n=0;n<16;n++)f[n]=_[n];for(let n=253;n>=0;n--)S(f,f),n!==2&&n!==4&&N(f,f,_);for(let n=0;n<16;n++)p[n]=f[n]}function C(p,_){const f=new Uint8Array(32),n=new Float64Array(80),l=i(),P=i(),F=i(),K=i(),k=i(),X=i();for(let j=0;j<31;j++)f[j]=p[j];f[31]=p[31]&127|64,f[0]&=248,g(n,_);for(let j=0;j<16;j++)P[j]=n[j];l[0]=K[0]=1;for(let j=254;j>=0;--j){const L=f[j>>>3]>>>(j&7)&1;c(l,P,L),c(F,K,L),b(k,l,F),x(l,l,F),b(F,P,K),x(P,P,K),S(K,k),S(X,l),N(l,F,l),N(F,P,k),b(k,l,F),x(l,l,F),S(P,l),x(F,K,X),N(l,F,a),b(l,l,K),N(F,F,l),N(l,K,X),N(K,P,n),S(P,k),c(l,P,L),c(F,K,L)}for(let j=0;j<16;j++)n[j+16]=l[j],n[j+32]=F[j],n[j+48]=P[j],n[j+64]=K[j];const v=n.subarray(32),A=n.subarray(16);I(v,v),N(A,A,v);const G=new Uint8Array(32);return u(G,A),G}t.scalarMult=C;function R(p){return C(p,s)}t.scalarMultBase=R;function q(p){if(p.length!==t.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${t.SECRET_KEY_LENGTH} bytes`);const _=new Uint8Array(p);return{publicKey:R(_),secretKey:_}}t.generateKeyPairFromSeed=q;function w(p){const _=(0,e.randomBytes)(32,p),f=q(_);return(0,r.wipe)(_),f}t.generateKeyPair=w;function D(p,_,f=!1){if(p.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(_.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const n=C(p,_);if(f){let l=0;for(let P=0;P<n.length;P++)l|=n[P];if(l===0)throw new Error("X25519: invalid shared key")}return n}t.sharedKey=D})(Bi);function zi(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Jn(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?zi(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Ni(t,e){e||(e=t.reduce((s,a)=>s+a.length,0));const r=Jn(e);let i=0;for(const s of t)r.set(s,i),i+=s.length;return zi(r)}function Oc(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var a=t.charAt(s),h=a.charCodeAt(0);if(r[h]!==255)throw new TypeError(a+" is ambiguous");r[h]=s}var c=t.length,u=t.charAt(0),g=Math.log(c)/Math.log(256),b=Math.log(256)/Math.log(c);function x(I){if(I instanceof Uint8Array||(ArrayBuffer.isView(I)?I=new Uint8Array(I.buffer,I.byteOffset,I.byteLength):Array.isArray(I)&&(I=Uint8Array.from(I))),!(I instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(I.length===0)return"";for(var C=0,R=0,q=0,w=I.length;q!==w&&I[q]===0;)q++,C++;for(var D=(w-q)*b+1>>>0,p=new Uint8Array(D);q!==w;){for(var _=I[q],f=0,n=D-1;(_!==0||f<R)&&n!==-1;n--,f++)_+=256*p[n]>>>0,p[n]=_%c>>>0,_=_/c>>>0;if(_!==0)throw new Error("Non-zero carry");R=f,q++}for(var l=D-R;l!==D&&p[l]===0;)l++;for(var P=u.repeat(C);l<D;++l)P+=t.charAt(p[l]);return P}function N(I){if(typeof I!="string")throw new TypeError("Expected String");if(I.length===0)return new Uint8Array;var C=0;if(I[C]!==" "){for(var R=0,q=0;I[C]===u;)R++,C++;for(var w=(I.length-C)*g+1>>>0,D=new Uint8Array(w);I[C];){var p=r[I.charCodeAt(C)];if(p===255)return;for(var _=0,f=w-1;(p!==0||_<q)&&f!==-1;f--,_++)p+=c*D[f]>>>0,D[f]=p%256>>>0,p=p/256>>>0;if(p!==0)throw new Error("Non-zero carry");q=_,C++}if(I[C]!==" "){for(var n=w-q;n!==w&&D[n]===0;)n++;for(var l=new Uint8Array(R+(w-n)),P=R;n!==w;)l[P++]=D[n++];return l}}}function S(I){var C=N(I);if(C)return C;throw new Error(`Non-${e} character`)}return{encode:x,decodeUnsafe:N,decode:S}}var Tc=Oc,Ac=Tc;const Nc=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Cc=t=>new TextEncoder().encode(t),Rc=t=>new TextDecoder().decode(t);class Pc{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Fc{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Xn(this,e)}}class Uc{constructor(e){this.decoders=e}or(e){return Xn(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Xn=(t,e)=>new Uc({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Lc{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new Pc(e,r,i),this.decoder=new Fc(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ti=({name:t,prefix:e,encode:r,decode:i})=>new Lc(t,e,r,i),Or=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=Ac(r,e);return ti({prefix:t,name:e,encode:i,decode:a=>Nc(s(a))})},Mc=(t,e,r,i)=>{const s={};for(let b=0;b<e.length;++b)s[e[b]]=b;let a=t.length;for(;t[a-1]==="=";)--a;const h=new Uint8Array(a*r/8|0);let c=0,u=0,g=0;for(let b=0;b<a;++b){const x=s[t[b]];if(x===void 0)throw new SyntaxError(`Non-${i} character`);u=u<<r|x,c+=r,c>=8&&(c-=8,h[g++]=255&u>>c)}if(c>=r||255&u<<8-c)throw new SyntaxError("Unexpected end of data");return h},$c=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let a="",h=0,c=0;for(let u=0;u<t.length;++u)for(c=c<<8|t[u],h+=8;h>r;)h-=r,a+=e[s&c>>h];if(h&&(a+=e[s&c<<r-h]),i)for(;a.length*r&7;)a+="=";return a},Ze=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>ti({prefix:e,name:t,encode(s){return $c(s,i,r)},decode(s){return Mc(s,i,r,t)}}),jc=ti({prefix:"\0",name:"identity",encode:t=>Rc(t),decode:t=>Cc(t)}),Bc=Object.freeze(Object.defineProperty({__proto__:null,identity:jc},Symbol.toStringTag,{value:"Module"})),zc=Ze({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),qc=Object.freeze(Object.defineProperty({__proto__:null,base2:zc},Symbol.toStringTag,{value:"Module"})),Kc=Ze({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Hc=Object.freeze(Object.defineProperty({__proto__:null,base8:Kc},Symbol.toStringTag,{value:"Module"})),Vc=Or({prefix:"9",name:"base10",alphabet:"0123456789"}),kc=Object.freeze(Object.defineProperty({__proto__:null,base10:Vc},Symbol.toStringTag,{value:"Module"})),Gc=Ze({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Wc=Ze({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Yc=Object.freeze(Object.defineProperty({__proto__:null,base16:Gc,base16upper:Wc},Symbol.toStringTag,{value:"Module"})),Jc=Ze({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Xc=Ze({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Qc=Ze({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Zc=Ze({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),eu=Ze({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),tu=Ze({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ru=Ze({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),iu=Ze({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),su=Ze({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),nu=Object.freeze(Object.defineProperty({__proto__:null,base32:Jc,base32hex:eu,base32hexpad:ru,base32hexpadupper:iu,base32hexupper:tu,base32pad:Qc,base32padupper:Zc,base32upper:Xc,base32z:su},Symbol.toStringTag,{value:"Module"})),ou=Or({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),au=Or({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),cu=Object.freeze(Object.defineProperty({__proto__:null,base36:ou,base36upper:au},Symbol.toStringTag,{value:"Module"})),uu=Or({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),hu=Or({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),lu=Object.freeze(Object.defineProperty({__proto__:null,base58btc:uu,base58flickr:hu},Symbol.toStringTag,{value:"Module"})),fu=Ze({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),du=Ze({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),gu=Ze({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),pu=Ze({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),yu=Object.freeze(Object.defineProperty({__proto__:null,base64:fu,base64pad:du,base64url:gu,base64urlpad:pu},Symbol.toStringTag,{value:"Module"})),Qn=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),bu=Qn.reduce((t,e,r)=>(t[r]=e,t),[]),_u=Qn.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function wu(t){return t.reduce((e,r)=>(e+=bu[r],e),"")}function mu(t){const e=[];for(const r of t){const i=_u[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Eu=ti({prefix:"🚀",name:"base256emoji",encode:wu,decode:mu}),vu=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Eu},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const ws={...Bc,...qc,...Hc,...kc,...Yc,...nu,...cu,...lu,...yu,...vu};function Zn(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const ms=Zn("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),ci=Zn("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Jn(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),eo={utf8:ms,"utf-8":ms,hex:ws.base16,latin1:ci,ascii:ci,binary:ci,...ws};function ct(t,e="utf8"){const r=eo[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?zi(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function ot(t,e="utf8"){const r=eo[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}var Es=globalThis&&globalThis.__spreadArray||function(t,e,r){if(r||arguments.length===2)for(var i=0,s=e.length,a;i<s;i++)(a||!(i in e))&&(a||(a=Array.prototype.slice.call(e,0,i)),a[i]=e[i]);return t.concat(a||Array.prototype.slice.call(e))},Du=function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t}(),Su=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=Tt.platform}return t}(),xu=function(){function t(e,r,i,s){this.name=e,this.version=r,this.os=i,this.bot=s,this.type="bot-device"}return t}(),Iu=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),Ou=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),Tu=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Au=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,vs=3,Nu=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Tu]],Ds=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Cu(t){return t?Ss(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Ou:typeof navigator<"u"?Ss(navigator.userAgent):Fu()}function Ru(t){return t!==""&&Nu.reduce(function(e,r){var i=r[0],s=r[1];if(e)return e;var a=s.exec(t);return!!a&&[i,a]},!1)}function Ss(t){var e=Ru(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new Iu;var s=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);s?s.length<vs&&(s=Es(Es([],s,!0),Uu(vs-s.length),!0)):s=[];var a=s.join("."),h=Pu(t),c=Au.exec(t);return c&&c[1]?new xu(r,a,h,c[1]):new Du(r,a,h)}function Pu(t){for(var e=0,r=Ds.length;e<r;e++){var i=Ds[e],s=i[0],a=i[1],h=a.exec(t);if(h)return s}return null}function Fu(){var t=typeof Tt<"u"&&Tt.version;return t?new Su(Tt.version.slice(1)):null}function Uu(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var Q={},ui={},fr={},xs;function Lu(){if(xs)return fr;xs=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return fr.delay=t,fr}var kt={},hi={},Gt={},Is;function Mu(){return Is||(Is=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.ONE_THOUSAND=Gt.ONE_HUNDRED=void 0,Gt.ONE_HUNDRED=100,Gt.ONE_THOUSAND=1e3),Gt}var li={},Os;function $u(){return Os||(Os=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(li)),li}var Ts;function to(){return Ts||(Ts=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=wt;e.__exportStar(Mu(),t),e.__exportStar($u(),t)}(hi)),hi}var As;function ju(){if(As)return kt;As=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.fromMiliseconds=kt.toMiliseconds=void 0;const t=to();function e(i){return i*t.ONE_THOUSAND}kt.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return kt.fromMiliseconds=r,kt}var Ns;function Bu(){return Ns||(Ns=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=wt;e.__exportStar(Lu(),t),e.__exportStar(ju(),t)}(ui)),ui}var tr={},Cs;function zu(){if(Cs)return tr;Cs=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const s=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:s})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return tr.Watch=t,tr.default=t,tr}var fi={},dr={},Rs;function qu(){if(Rs)return dr;Rs=1,Object.defineProperty(dr,"__esModule",{value:!0}),dr.IWatch=void 0;class t{}return dr.IWatch=t,dr}var Ps;function Ku(){return Ps||(Ps=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),wt.__exportStar(qu(),t)}(fi)),fi}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=wt;e.__exportStar(Bu(),t),e.__exportStar(zu(),t),e.__exportStar(Ku(),t),e.__exportStar(to(),t)})(Q);var xe={};Object.defineProperty(xe,"__esModule",{value:!0});xe.getLocalStorage=xe.getLocalStorageOrThrow=xe.getCrypto=xe.getCryptoOrThrow=io=xe.getLocation=xe.getLocationOrThrow=qi=xe.getNavigator=xe.getNavigatorOrThrow=ro=xe.getDocument=xe.getDocumentOrThrow=xe.getFromWindowOrThrow=xe.getFromWindow=void 0;function Xt(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}xe.getFromWindow=Xt;function or(t){const e=Xt(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}xe.getFromWindowOrThrow=or;function Hu(){return or("document")}xe.getDocumentOrThrow=Hu;function Vu(){return Xt("document")}var ro=xe.getDocument=Vu;function ku(){return or("navigator")}xe.getNavigatorOrThrow=ku;function Gu(){return Xt("navigator")}var qi=xe.getNavigator=Gu;function Wu(){return or("location")}xe.getLocationOrThrow=Wu;function Yu(){return Xt("location")}var io=xe.getLocation=Yu;function Ju(){return or("crypto")}xe.getCryptoOrThrow=Ju;function Xu(){return Xt("crypto")}xe.getCrypto=Xu;function Qu(){return or("localStorage")}xe.getLocalStorageOrThrow=Qu;function Zu(){return Xt("localStorage")}xe.getLocalStorage=Zu;var Ki={};Object.defineProperty(Ki,"__esModule",{value:!0});var so=Ki.getWindowMetadata=void 0;const Fs=xe;function eh(){let t,e;try{t=Fs.getDocumentOrThrow(),e=Fs.getLocationOrThrow()}catch{return null}function r(){const x=t.getElementsByTagName("link"),N=[];for(let S=0;S<x.length;S++){const I=x[S],C=I.getAttribute("rel");if(C&&C.toLowerCase().indexOf("icon")>-1){const R=I.getAttribute("href");if(R)if(R.toLowerCase().indexOf("https:")===-1&&R.toLowerCase().indexOf("http:")===-1&&R.indexOf("//")!==0){let q=e.protocol+"//"+e.host;if(R.indexOf("/")===0)q+=R;else{const w=e.pathname.split("/");w.pop();const D=w.join("/");q+=D+"/"+R}N.push(q)}else if(R.indexOf("//")===0){const q=e.protocol+R;N.push(q)}else N.push(R)}}return N}function i(...x){const N=t.getElementsByTagName("meta");for(let S=0;S<N.length;S++){const I=N[S],C=["itemprop","property","name"].map(R=>I.getAttribute(R)).filter(R=>R?x.includes(R):!1);if(C.length&&C){const R=I.getAttribute("content");if(R)return R}}return""}function s(){let x=i("name","og:site_name","og:title","twitter:title");return x||(x=t.title),x}function a(){return i("description","og:description","twitter:description","keywords")}const h=s(),c=a(),u=e.origin,g=r();return{description:c,url:u,icons:g,name:h}}so=Ki.getWindowMetadata=eh;var xr={},th=t=>encodeURIComponent(t).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),no="%[a-f0-9]{2}",Us=new RegExp("("+no+")|([^%]+?)","gi"),Ls=new RegExp("("+no+")+","gi");function Ci(t,e){try{return[decodeURIComponent(t.join(""))]}catch{}if(t.length===1)return t;e=e||1;var r=t.slice(0,e),i=t.slice(e);return Array.prototype.concat.call([],Ci(r),Ci(i))}function rh(t){try{return decodeURIComponent(t)}catch{for(var e=t.match(Us)||[],r=1;r<e.length;r++)t=Ci(e,r).join(""),e=t.match(Us)||[];return t}}function ih(t){for(var e={"%FE%FF":"��","%FF%FE":"��"},r=Ls.exec(t);r;){try{e[r[0]]=decodeURIComponent(r[0])}catch{var i=rh(r[0]);i!==r[0]&&(e[r[0]]=i)}r=Ls.exec(t)}e["%C2"]="�";for(var s=Object.keys(e),a=0;a<s.length;a++){var h=s[a];t=t.replace(new RegExp(h,"g"),e[h])}return t}var sh=function(t){if(typeof t!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return t=t.replace(/\+/g," "),decodeURIComponent(t)}catch{return ih(t)}},nh=(t,e)=>{if(!(typeof t=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e==="")return[t];const r=t.indexOf(e);return r===-1?[t]:[t.slice(0,r),t.slice(r+e.length)]},oh=function(t,e){for(var r={},i=Object.keys(t),s=Array.isArray(e),a=0;a<i.length;a++){var h=i[a],c=t[h];(s?e.indexOf(h)!==-1:e(h,c,t))&&(r[h]=c)}return r};(function(t){const e=th,r=sh,i=nh,s=oh,a=w=>w==null,h=Symbol("encodeFragmentIdentifier");function c(w){switch(w.arrayFormat){case"index":return D=>(p,_)=>{const f=p.length;return _===void 0||w.skipNull&&_===null||w.skipEmptyString&&_===""?p:_===null?[...p,[b(D,w),"[",f,"]"].join("")]:[...p,[b(D,w),"[",b(f,w),"]=",b(_,w)].join("")]};case"bracket":return D=>(p,_)=>_===void 0||w.skipNull&&_===null||w.skipEmptyString&&_===""?p:_===null?[...p,[b(D,w),"[]"].join("")]:[...p,[b(D,w),"[]=",b(_,w)].join("")];case"colon-list-separator":return D=>(p,_)=>_===void 0||w.skipNull&&_===null||w.skipEmptyString&&_===""?p:_===null?[...p,[b(D,w),":list="].join("")]:[...p,[b(D,w),":list=",b(_,w)].join("")];case"comma":case"separator":case"bracket-separator":{const D=w.arrayFormat==="bracket-separator"?"[]=":"=";return p=>(_,f)=>f===void 0||w.skipNull&&f===null||w.skipEmptyString&&f===""?_:(f=f===null?"":f,_.length===0?[[b(p,w),D,b(f,w)].join("")]:[[_,b(f,w)].join(w.arrayFormatSeparator)])}default:return D=>(p,_)=>_===void 0||w.skipNull&&_===null||w.skipEmptyString&&_===""?p:_===null?[...p,b(D,w)]:[...p,[b(D,w),"=",b(_,w)].join("")]}}function u(w){let D;switch(w.arrayFormat){case"index":return(p,_,f)=>{if(D=/\[(\d*)\]$/.exec(p),p=p.replace(/\[\d*\]$/,""),!D){f[p]=_;return}f[p]===void 0&&(f[p]={}),f[p][D[1]]=_};case"bracket":return(p,_,f)=>{if(D=/(\[\])$/.exec(p),p=p.replace(/\[\]$/,""),!D){f[p]=_;return}if(f[p]===void 0){f[p]=[_];return}f[p]=[].concat(f[p],_)};case"colon-list-separator":return(p,_,f)=>{if(D=/(:list)$/.exec(p),p=p.replace(/:list$/,""),!D){f[p]=_;return}if(f[p]===void 0){f[p]=[_];return}f[p]=[].concat(f[p],_)};case"comma":case"separator":return(p,_,f)=>{const n=typeof _=="string"&&_.includes(w.arrayFormatSeparator),l=typeof _=="string"&&!n&&x(_,w).includes(w.arrayFormatSeparator);_=l?x(_,w):_;const P=n||l?_.split(w.arrayFormatSeparator).map(F=>x(F,w)):_===null?_:x(_,w);f[p]=P};case"bracket-separator":return(p,_,f)=>{const n=/(\[\])$/.test(p);if(p=p.replace(/\[\]$/,""),!n){f[p]=_&&x(_,w);return}const l=_===null?[]:_.split(w.arrayFormatSeparator).map(P=>x(P,w));if(f[p]===void 0){f[p]=l;return}f[p]=[].concat(f[p],l)};default:return(p,_,f)=>{if(f[p]===void 0){f[p]=_;return}f[p]=[].concat(f[p],_)}}}function g(w){if(typeof w!="string"||w.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function b(w,D){return D.encode?D.strict?e(w):encodeURIComponent(w):w}function x(w,D){return D.decode?r(w):w}function N(w){return Array.isArray(w)?w.sort():typeof w=="object"?N(Object.keys(w)).sort((D,p)=>Number(D)-Number(p)).map(D=>w[D]):w}function S(w){const D=w.indexOf("#");return D!==-1&&(w=w.slice(0,D)),w}function I(w){let D="";const p=w.indexOf("#");return p!==-1&&(D=w.slice(p)),D}function C(w){w=S(w);const D=w.indexOf("?");return D===-1?"":w.slice(D+1)}function R(w,D){return D.parseNumbers&&!Number.isNaN(Number(w))&&typeof w=="string"&&w.trim()!==""?w=Number(w):D.parseBooleans&&w!==null&&(w.toLowerCase()==="true"||w.toLowerCase()==="false")&&(w=w.toLowerCase()==="true"),w}function q(w,D){D=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},D),g(D.arrayFormatSeparator);const p=u(D),_=Object.create(null);if(typeof w!="string"||(w=w.trim().replace(/^[?#&]/,""),!w))return _;for(const f of w.split("&")){if(f==="")continue;let[n,l]=i(D.decode?f.replace(/\+/g," "):f,"=");l=l===void 0?null:["comma","separator","bracket-separator"].includes(D.arrayFormat)?l:x(l,D),p(x(n,D),l,_)}for(const f of Object.keys(_)){const n=_[f];if(typeof n=="object"&&n!==null)for(const l of Object.keys(n))n[l]=R(n[l],D);else _[f]=R(n,D)}return D.sort===!1?_:(D.sort===!0?Object.keys(_).sort():Object.keys(_).sort(D.sort)).reduce((f,n)=>{const l=_[n];return Boolean(l)&&typeof l=="object"&&!Array.isArray(l)?f[n]=N(l):f[n]=l,f},Object.create(null))}t.extract=C,t.parse=q,t.stringify=(w,D)=>{if(!w)return"";D=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},D),g(D.arrayFormatSeparator);const p=l=>D.skipNull&&a(w[l])||D.skipEmptyString&&w[l]==="",_=c(D),f={};for(const l of Object.keys(w))p(l)||(f[l]=w[l]);const n=Object.keys(f);return D.sort!==!1&&n.sort(D.sort),n.map(l=>{const P=w[l];return P===void 0?"":P===null?b(l,D):Array.isArray(P)?P.length===0&&D.arrayFormat==="bracket-separator"?b(l,D)+"[]":P.reduce(_(l),[]).join("&"):b(l,D)+"="+b(P,D)}).filter(l=>l.length>0).join("&")},t.parseUrl=(w,D)=>{D=Object.assign({decode:!0},D);const[p,_]=i(w,"#");return Object.assign({url:p.split("?")[0]||"",query:q(C(w),D)},D&&D.parseFragmentIdentifier&&_?{fragmentIdentifier:x(_,D)}:{})},t.stringifyUrl=(w,D)=>{D=Object.assign({encode:!0,strict:!0,[h]:!0},D);const p=S(w.url).split("?")[0]||"",_=t.extract(w.url),f=t.parse(_,{sort:!1}),n=Object.assign(f,w.query);let l=t.stringify(n,D);l&&(l=`?${l}`);let P=I(w.url);return w.fragmentIdentifier&&(P=`#${D[h]?b(w.fragmentIdentifier,D):w.fragmentIdentifier}`),`${p}${l}${P}`},t.pick=(w,D,p)=>{p=Object.assign({parseFragmentIdentifier:!0,[h]:!1},p);const{url:_,query:f,fragmentIdentifier:n}=t.parseUrl(w,p);return t.stringifyUrl({url:_,query:s(f,D),fragmentIdentifier:n},p)},t.exclude=(w,D,p)=>{const _=Array.isArray(D)?f=>!D.includes(f):(f,n)=>!D(f,n);return t.pick(w,_,p)}})(xr);const ah={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}},ch=":";function Ip(t){const[e,r,i]=t.split(ch);return{namespace:e,reference:r,address:i}}function Op(t,e=[]){const r=[];return Object.keys(t).forEach(i=>{if(e.length&&!e.includes(i))return;const s=t[i];r.push(...s.accounts)}),r}function oo(t,e){return t.includes(":")?[t]:e.chains||[]}const ao="base10",nt="base16",Ri="base64pad",Hi="utf8",co=0,Qt=1,uh=0,Ms=1,Pi=12,Vi=32;function hh(){const t=Bi.generateKeyPair();return{privateKey:ot(t.secretKey,nt),publicKey:ot(t.publicKey,nt)}}function Fi(){const t=nr.randomBytes(Vi);return ot(t,nt)}function lh(t,e){const r=Bi.sharedKey(ct(t,nt),ct(e,nt)),i=new mc(ei.SHA256,r).expand(Vi);return ot(i,nt)}function fh(t){const e=ei.hash(ct(t,nt));return ot(e,nt)}function sr(t){const e=ei.hash(ct(t,Hi));return ot(e,nt)}function dh(t){return ct(`${t}`,ao)}function Tr(t){return Number(ot(t,ao))}function gh(t){const e=dh(typeof t.type<"u"?t.type:co);if(Tr(e)===Qt&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?ct(t.senderPublicKey,nt):void 0,i=typeof t.iv<"u"?ct(t.iv,nt):nr.randomBytes(Pi),s=new $i.ChaCha20Poly1305(ct(t.symKey,nt)).seal(i,ct(t.message,Hi));return yh({type:e,sealed:s,iv:i,senderPublicKey:r})}function ph(t){const e=new $i.ChaCha20Poly1305(ct(t.symKey,nt)),{sealed:r,iv:i}=Hr(t.encoded),s=e.open(i,r);if(s===null)throw new Error("Failed to decrypt");return ot(s,Hi)}function yh(t){if(Tr(t.type)===Qt){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return ot(Ni([t.type,t.senderPublicKey,t.iv,t.sealed]),Ri)}return ot(Ni([t.type,t.iv,t.sealed]),Ri)}function Hr(t){const e=ct(t,Ri),r=e.slice(uh,Ms),i=Ms;if(Tr(r)===Qt){const c=i+Vi,u=c+Pi,g=e.slice(i,c),b=e.slice(c,u),x=e.slice(u);return{type:r,sealed:x,iv:b,senderPublicKey:g}}const s=i+Pi,a=e.slice(i,s),h=e.slice(s);return{type:r,sealed:h,iv:a}}function bh(t,e){const r=Hr(t);return uo({type:Tr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?ot(r.senderPublicKey,nt):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function uo(t){const e=(t==null?void 0:t.type)||co;if(e===Qt){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function $s(t){return t.type===Qt&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}var _h=Object.defineProperty,js=Object.getOwnPropertySymbols,wh=Object.prototype.hasOwnProperty,mh=Object.prototype.propertyIsEnumerable,Bs=(t,e,r)=>e in t?_h(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zs=(t,e)=>{for(var r in e||(e={}))wh.call(e,r)&&Bs(t,r,e[r]);if(js)for(var r of js(e))mh.call(e,r)&&Bs(t,r,e[r]);return t};const Eh="ReactNative",jt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},vh="js";function ki(){return typeof Tt<"u"&&typeof Tt.versions<"u"&&typeof Tt.versions.node<"u"}function ho(){return!ro()&&!!qi()&&navigator.product===Eh}function Gi(){return!ki()&&!!qi()}function Wi(){return ho()?jt.reactNative:ki()?jt.node:Gi()?jt.browser:jt.unknown}function Dh(t,e){let r=xr.parse(t);return r=zs(zs({},r),e),t=xr.stringify(r),t}function Sh(){return so()||{name:"",description:"",url:"",icons:[""]}}function xh(){if(Wi()===jt.reactNative&&typeof bt<"u"&&typeof(bt==null?void 0:bt.Platform)<"u"){const{OS:r,Version:i}=bt.Platform;return[r,i].join("-")}const t=Cu();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function Ih(){var t;const e=Wi();return e===jt.browser?[e,((t=io())==null?void 0:t.host)||"unknown"].join(":"):e}function Oh(t,e,r){const i=xh(),s=Ih();return[[t,e].join("-"),[vh,r].join("-"),i,s].join("/")}function Th({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:s,projectId:a,useOnCloseEvent:h}){const c=r.split("?"),u=Oh(t,e,i),g={auth:s,ua:u,projectId:a,useOnCloseEvent:h||void 0},b=Dh(c[1]||"",g);return c[0]+"?"+b}function Jt(t,e){return t.filter(r=>e.includes(r)).length===t.length}function lo(t){return Object.fromEntries(t.entries())}function fo(t){return new Map(Object.entries(t))}function rr(t=Q.FIVE_MINUTES,e){const r=Q.toMiliseconds(t||Q.FIVE_MINUTES);let i,s,a;return{resolve:h=>{a&&i&&(clearTimeout(a),i(h))},reject:h=>{a&&s&&(clearTimeout(a),s(h))},done:()=>new Promise((h,c)=>{a=setTimeout(()=>{c(new Error(e))},r),i=h,s=c})}}function Vr(t,e,r){return new Promise(async(i,s)=>{const a=setTimeout(()=>s(new Error(r)),e);try{const h=await t;i(h)}catch(h){s(h)}clearTimeout(a)})}function go(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function Ah(t){return go("topic",t)}function Nh(t){return go("id",t)}function po(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function vt(t,e){return Q.fromMiliseconds((e||Date.now())+Q.toMiliseconds(t))}function $t(t){return Date.now()>=Q.toMiliseconds(t)}function Be(t,e){return`${t}${e?`:${e}`:""}`}function Tp(t=[],e=[]){return[...new Set([...t,...e])]}async function Ch({id:t,topic:e,wcDeepLink:r}){try{if(!r)return;const i=typeof r=="string"?JSON.parse(r):r;let s=i==null?void 0:i.href;if(typeof s!="string")return;s.endsWith("/")&&(s=s.slice(0,-1));const a=`${s}/wc?requestId=${t}&sessionTopic=${e}`,h=Wi();h===jt.browser?a.startsWith("https://")?window.open(a,"_blank","noreferrer noopener"):window.open(a,"_self","noreferrer noopener"):h===jt.reactNative&&typeof(bt==null?void 0:bt.Linking)<"u"&&await bt.Linking.openURL(a)}catch(i){console.error(i)}}const Rh="irn";function Ui(t){return(t==null?void 0:t.relay)||{protocol:Rh}}function Br(t){const e=ah[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var Ph=Object.defineProperty,qs=Object.getOwnPropertySymbols,Fh=Object.prototype.hasOwnProperty,Uh=Object.prototype.propertyIsEnumerable,Ks=(t,e,r)=>e in t?Ph(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Lh=(t,e)=>{for(var r in e||(e={}))Fh.call(e,r)&&Ks(t,r,e[r]);if(qs)for(var r of qs(e))Uh.call(e,r)&&Ks(t,r,e[r]);return t};function Mh(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(s=>{if(s.startsWith(i)){const a=s.replace(i,""),h=t[s];r[a]=h}}),r}function $h(t){const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),s=t.substring(e+1,r).split("@"),a=typeof r<"u"?t.substring(r):"",h=xr.parse(a);return{protocol:i,topic:jh(s[0]),version:parseInt(s[1],10),symKey:h.symKey,relay:Mh(h)}}function jh(t){return t.startsWith("//")?t.substring(2):t}function Bh(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(s=>{const a=r+e+s;t[s]&&(i[a]=t[s])}),i}function zh(t){return`${t.protocol}:${t.topic}@${t.version}?`+xr.stringify(Lh({symKey:t.symKey},Bh(t.relay)))}function ar(t){const e=[];return t.forEach(r=>{const[i,s]=r.split(":");e.push(`${i}:${s}`)}),e}function qh(t){const e=[];return Object.values(t).forEach(r=>{e.push(...ar(r.accounts))}),e}function Kh(t,e){const r=[];return Object.values(t).forEach(i=>{ar(i.accounts).includes(e)&&r.push(...i.methods)}),r}function Hh(t,e){const r=[];return Object.values(t).forEach(i=>{ar(i.accounts).includes(e)&&r.push(...i.events)}),r}function Vh(t,e){const r=zr(t,e);if(r)throw new Error(r.message);const i={};for(const[s,a]of Object.entries(t))i[s]={methods:a.methods,events:a.events,chains:a.accounts.map(h=>`${h.split(":")[0]}:${h.split(":")[1]}`)};return i}function kh(t){return t.includes(":")}function Ap(t){return kh(t)?t.split(":")[0]:t}const Gh={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Wh={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function V(t,e){const{message:r,code:i}=Wh[t];return{message:e?`${r} ${e}`:r,code:i}}function Je(t,e){const{message:r,code:i}=Gh[t];return{message:e?`${r} ${e}`:r,code:i}}function Ar(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Dr(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function st(t){return typeof t>"u"}function Xe(t,e){return e&&st(t)?!0:typeof t=="string"&&!!t.trim().length}function Yi(t,e){return e&&st(t)?!0:typeof t=="number"&&!isNaN(t)}function Yh(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),s=Object.keys(r);let a=!0;return Jt(s,i)?(i.forEach(h=>{const{accounts:c,methods:u,events:g}=t.namespaces[h],b=ar(c),x=r[h];(!Jt(oo(h,x),b)||!Jt(x.methods,u)||!Jt(x.events,g))&&(a=!1)}),a):!1}function kr(t){return Xe(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function Jh(t){if(Xe(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&kr(r)}}return!1}function Xh(t){if(Xe(t,!1))try{return typeof new URL(t)<"u"}catch{return!1}return!1}function Qh(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function Zh(t){return t==null?void 0:t.topic}function el(t,e){let r=null;return Xe(t==null?void 0:t.publicKey,!1)||(r=V("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function Hs(t){let e=!0;return Ar(t)?t.length&&(e=t.every(r=>Xe(r,!1))):e=!1,e}function tl(t,e,r){let i=null;return Ar(e)&&e.length?e.forEach(s=>{i||kr(s)||(i=Je("UNSUPPORTED_CHAINS",`${r}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):kr(t)||(i=Je("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function rl(t,e,r){let i=null;return Object.entries(t).forEach(([s,a])=>{if(i)return;const h=tl(s,oo(s,a),`${e} ${r}`);h&&(i=h)}),i}function il(t,e){let r=null;return Ar(t)?t.forEach(i=>{r||Jh(i)||(r=Je("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=Je("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function sl(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=il(i==null?void 0:i.accounts,`${e} namespace`);s&&(r=s)}),r}function nl(t,e){let r=null;return Hs(t==null?void 0:t.methods)?Hs(t==null?void 0:t.events)||(r=Je("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=Je("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function yo(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=nl(i,`${e}, namespace`);s&&(r=s)}),r}function ol(t,e,r){let i=null;if(t&&Dr(t)){const s=yo(t,e);s&&(i=s);const a=rl(t,e,r);a&&(i=a)}else i=V("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return i}function zr(t,e){let r=null;if(t&&Dr(t)){const i=yo(t,e);i&&(r=i);const s=sl(t,e);s&&(r=s)}else r=V("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function bo(t){return Xe(t.protocol,!0)}function al(t,e){let r=!1;return e&&!t?r=!0:t&&Ar(t)&&t.length&&t.forEach(i=>{r=bo(i)}),r}function cl(t){return typeof t=="number"}function at(t){return typeof t<"u"&&typeof t!==null}function ul(t){return!(!t||typeof t!="object"||!t.code||!Yi(t.code,!1)||!t.message||!Xe(t.message,!1))}function hl(t){return!(st(t)||!Xe(t.method,!1))}function ll(t){return!(st(t)||st(t.result)&&st(t.error)||!Yi(t.id,!1)||!Xe(t.jsonrpc,!1))}function fl(t){return!(st(t)||!Xe(t.name,!1))}function Vs(t,e){return!(!kr(e)||!qh(t).includes(e))}function dl(t,e,r){return Xe(r,!1)?Kh(t,e).includes(r):!1}function gl(t,e,r){return Xe(r,!1)?Hh(t,e).includes(r):!1}function ks(t,e,r){let i=null;const s=pl(t),a=yl(e),h=Object.keys(s),c=Object.keys(a),u=Gs(Object.keys(t)),g=Gs(Object.keys(e)),b=u.filter(x=>!g.includes(x));return b.length&&(i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${b.toString()}
      Received: ${Object.keys(e).toString()}`)),Jt(h,c)||(i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${h.toString()}
      Approved: ${c.toString()}`)),Object.keys(e).forEach(x=>{if(!x.includes(":")||i)return;const N=ar(e[x].accounts);N.includes(x)||(i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${x}
        Required: ${x}
        Approved: ${N.toString()}`))}),h.forEach(x=>{i||(Jt(s[x].methods,a[x].methods)?Jt(s[x].events,a[x].events)||(i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${x}`)):i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${x}`))}),i}function pl(t){const e={};return Object.keys(t).forEach(r=>{var i;r.includes(":")?e[r]=t[r]:(i=t[r].chains)==null||i.forEach(s=>{e[s]={methods:t[r].methods,events:t[r].events}})}),e}function Gs(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function yl(t){const e={};return Object.keys(t).forEach(r=>{if(r.includes(":"))e[r]=t[r];else{const i=ar(t[r].accounts);i==null||i.forEach(s=>{e[s]={accounts:t[r].accounts.filter(a=>a.includes(`${s}:`)),methods:t[r].methods,events:t[r].events}})}}),e}function bl(t,e){return Yi(t,!1)&&t<=e.max&&t>=e.min}var ri={},Nr={};Object.defineProperty(Nr,"__esModule",{value:!0});function _l(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return JSON.parse(t)}catch{return t}}Nr.safeJsonParse=_l;function wl(t){return typeof t=="string"?t:JSON.stringify(t,(e,r)=>typeof r>"u"?null:r)}Nr.safeJsonStringify=wl;var Gr={},di={get exports(){return Gr},set exports(t){Gr=t}},Ws;function ml(){return Ws||(Ws=1,function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof lt<"u"&&lt.localStorage?di.exports=lt.localStorage:typeof window<"u"&&window.localStorage?di.exports=window.localStorage:di.exports=new e}()),Gr}var gi={},gr={},Ys;function El(){if(Ys)return gr;Ys=1,Object.defineProperty(gr,"__esModule",{value:!0}),gr.IKeyValueStorage=void 0;class t{}return gr.IKeyValueStorage=t,gr}var pr={},Js;function vl(){if(Js)return pr;Js=1,Object.defineProperty(pr,"__esModule",{value:!0}),pr.parseEntry=void 0;const t=Nr;function e(r){var i;return[r[0],t.safeJsonParse((i=r[1])!==null&&i!==void 0?i:"")]}return pr.parseEntry=e,pr}var Xs;function Dl(){return Xs||(Xs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=wt;e.__exportStar(El(),t),e.__exportStar(vl(),t)}(gi)),gi}Object.defineProperty(ri,"__esModule",{value:!0});ri.KeyValueStorage=void 0;const ir=wt,Qs=Nr,Sl=ir.__importDefault(ml()),xl=Dl();class _o{constructor(){this.localStorage=Sl.default}getKeys(){return ir.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return ir.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(xl.parseEntry)})}getItem(e){return ir.__awaiter(this,void 0,void 0,function*(){const r=this.localStorage.getItem(e);if(r!==null)return Qs.safeJsonParse(r)})}setItem(e,r){return ir.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,Qs.safeJsonStringify(r))})}removeItem(e){return ir.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}ri.KeyValueStorage=_o;var Il=ri.default=_o,cr={},yr={},pi={},br={};let Zt=class{};const Ol=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Zt},Symbol.toStringTag,{value:"Module"})),Tl=$a(Ol);var Zs;function Al(){if(Zs)return br;Zs=1,Object.defineProperty(br,"__esModule",{value:!0}),br.IHeartBeat=void 0;const t=Tl;class e extends t.IEvents{constructor(i){super()}}return br.IHeartBeat=e,br}var en;function wo(){return en||(en=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),wt.__exportStar(Al(),t)}(pi)),pi}var yi={},Wt={},tn;function Nl(){if(tn)return Wt;tn=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.HEARTBEAT_EVENTS=Wt.HEARTBEAT_INTERVAL=void 0;const t=Q;return Wt.HEARTBEAT_INTERVAL=t.FIVE_SECONDS,Wt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Wt}var rn;function mo(){return rn||(rn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),wt.__exportStar(Nl(),t)}(yi)),yi}var sn;function Cl(){if(sn)return yr;sn=1,Object.defineProperty(yr,"__esModule",{value:!0}),yr.HeartBeat=void 0;const t=wt,e=_t,r=Q,i=wo(),s=mo();class a extends i.IHeartBeat{constructor(c){super(c),this.events=new e.EventEmitter,this.interval=s.HEARTBEAT_INTERVAL,this.interval=(c==null?void 0:c.interval)||s.HEARTBEAT_INTERVAL}static init(c){return t.__awaiter(this,void 0,void 0,function*(){const u=new a(c);return yield u.init(),u})}init(){return t.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(c,u){this.events.on(c,u)}once(c,u){this.events.once(c,u)}off(c,u){this.events.off(c,u)}removeListener(c,u){this.events.removeListener(c,u)}initialize(){return t.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(s.HEARTBEAT_EVENTS.pulse)}}return yr.HeartBeat=a,yr}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=wt;e.__exportStar(Cl(),t),e.__exportStar(wo(),t),e.__exportStar(mo(),t)})(cr);var we={},bi,nn;function Rl(){if(nn)return bi;nn=1;function t(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}bi=e;function e(r,i,s){var a=s&&s.stringify||t,h=1;if(typeof r=="object"&&r!==null){var c=i.length+h;if(c===1)return r;var u=new Array(c);u[0]=a(r);for(var g=1;g<c;g++)u[g]=a(i[g]);return u.join(" ")}if(typeof r!="string")return r;var b=i.length;if(b===0)return r;for(var x="",N=1-h,S=-1,I=r&&r.length||0,C=0;C<I;){if(r.charCodeAt(C)===37&&C+1<I){switch(S=S>-1?S:0,r.charCodeAt(C+1)){case 100:case 102:if(N>=b||i[N]==null)break;S<C&&(x+=r.slice(S,C)),x+=Number(i[N]),S=C+2,C++;break;case 105:if(N>=b||i[N]==null)break;S<C&&(x+=r.slice(S,C)),x+=Math.floor(Number(i[N])),S=C+2,C++;break;case 79:case 111:case 106:if(N>=b||i[N]===void 0)break;S<C&&(x+=r.slice(S,C));var R=typeof i[N];if(R==="string"){x+="'"+i[N]+"'",S=C+2,C++;break}if(R==="function"){x+=i[N].name||"<anonymous>",S=C+2,C++;break}x+=a(i[N]),S=C+2,C++;break;case 115:if(N>=b)break;S<C&&(x+=r.slice(S,C)),x+=String(i[N]),S=C+2,C++;break;case 37:S<C&&(x+=r.slice(S,C)),x+="%",S=C+2,C++,N--;break}++N}++C}return S===-1?r:(S<I&&(x+=r.slice(S)),x)}return bi}var _i,on;function Pl(){if(on)return _i;on=1;const t=Rl();_i=s;const e=_().console||{},r={mapHttpRequest:I,mapHttpResponse:I,wrapRequestSerializer:C,wrapResponseSerializer:C,wrapErrorSerializer:C,req:I,res:I,err:N};function i(f,n){return Array.isArray(f)?f.filter(function(P){return P!=="!stdSerializers.err"}):f===!0?Object.keys(n):!1}function s(f){f=f||{},f.browser=f.browser||{};const n=f.browser.transmit;if(n&&typeof n.send!="function")throw Error("pino: transmit option must have a send function");const l=f.browser.write||e;f.browser.write&&(f.browser.asObject=!0);const P=f.serializers||{},F=i(f.browser.serialize,P);let K=f.browser.serialize;Array.isArray(f.browser.serialize)&&f.browser.serialize.indexOf("!stdSerializers.err")>-1&&(K=!1);const k=["error","fatal","warn","info","debug","trace"];typeof l=="function"&&(l.error=l.fatal=l.warn=l.info=l.debug=l.trace=l),f.enabled===!1&&(f.level="silent");const X=f.level||"info",v=Object.create(l);v.log||(v.log=R),Object.defineProperty(v,"levelVal",{get:G}),Object.defineProperty(v,"level",{get:j,set:L});const A={transmit:n,serialize:F,asObject:f.browser.asObject,levels:k,timestamp:S(f)};v.levels=s.levels,v.level=X,v.setMaxListeners=v.getMaxListeners=v.emit=v.addListener=v.on=v.prependListener=v.once=v.prependOnceListener=v.removeListener=v.removeAllListeners=v.listeners=v.listenerCount=v.eventNames=v.write=v.flush=R,v.serializers=P,v._serialize=F,v._stdErrSerialize=K,v.child=$,n&&(v._logEvent=x());function G(){return this.level==="silent"?1/0:this.levels.values[this.level]}function j(){return this._level}function L(U){if(U!=="silent"&&!this.levels.values[U])throw Error("unknown level "+U);this._level=U,a(A,v,"error","log"),a(A,v,"fatal","error"),a(A,v,"warn","error"),a(A,v,"info","log"),a(A,v,"debug","log"),a(A,v,"trace","log")}function $(U,B){if(!U)throw new Error("missing bindings for child Pino");B=B||{},F&&U.serializers&&(B.serializers=U.serializers);const te=B.serializers;if(F&&te){var z=Object.assign({},P,te),Z=f.browser.serialize===!0?Object.keys(z):F;delete U.serializers,u([U],Z,z,this._stdErrSerialize)}function Y(ee){this._childLevel=(ee._childLevel|0)+1,this.error=g(ee,U,"error"),this.fatal=g(ee,U,"fatal"),this.warn=g(ee,U,"warn"),this.info=g(ee,U,"info"),this.debug=g(ee,U,"debug"),this.trace=g(ee,U,"trace"),z&&(this.serializers=z,this._serialize=Z),n&&(this._logEvent=x([].concat(ee._logEvent.bindings,U)))}return Y.prototype=this,new Y(this)}return v}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=r,s.stdTimeFunctions=Object.assign({},{nullTime:q,epochTime:w,unixTime:D,isoTime:p});function a(f,n,l,P){const F=Object.getPrototypeOf(n);n[l]=n.levelVal>n.levels.values[l]?R:F[l]?F[l]:e[l]||e[P]||R,h(f,n,l)}function h(f,n,l){!f.transmit&&n[l]===R||(n[l]=function(P){return function(){const K=f.timestamp(),k=new Array(arguments.length),X=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var v=0;v<k.length;v++)k[v]=arguments[v];if(f.serialize&&!f.asObject&&u(k,this._serialize,this.serializers,this._stdErrSerialize),f.asObject?P.call(X,c(this,l,k,K)):P.apply(X,k),f.transmit){const A=f.transmit.level||n.level,G=s.levels.values[A],j=s.levels.values[l];if(j<G)return;b(this,{ts:K,methodLevel:l,methodValue:j,transmitLevel:A,transmitValue:s.levels.values[f.transmit.level||n.level],send:f.transmit.send,val:n.levelVal},k)}}}(n[l]))}function c(f,n,l,P){f._serialize&&u(l,f._serialize,f.serializers,f._stdErrSerialize);const F=l.slice();let K=F[0];const k={};P&&(k.time=P),k.level=s.levels.values[n];let X=(f._childLevel|0)+1;if(X<1&&(X=1),K!==null&&typeof K=="object"){for(;X--&&typeof F[0]=="object";)Object.assign(k,F.shift());K=F.length?t(F.shift(),F):void 0}else typeof K=="string"&&(K=t(F.shift(),F));return K!==void 0&&(k.msg=K),k}function u(f,n,l,P){for(const F in f)if(P&&f[F]instanceof Error)f[F]=s.stdSerializers.err(f[F]);else if(typeof f[F]=="object"&&!Array.isArray(f[F]))for(const K in f[F])n&&n.indexOf(K)>-1&&K in l&&(f[F][K]=l[K](f[F][K]))}function g(f,n,l){return function(){const P=new Array(1+arguments.length);P[0]=n;for(var F=1;F<P.length;F++)P[F]=arguments[F-1];return f[l].apply(this,P)}}function b(f,n,l){const P=n.send,F=n.ts,K=n.methodLevel,k=n.methodValue,X=n.val,v=f._logEvent.bindings;u(l,f._serialize||Object.keys(f.serializers),f.serializers,f._stdErrSerialize===void 0?!0:f._stdErrSerialize),f._logEvent.ts=F,f._logEvent.messages=l.filter(function(A){return v.indexOf(A)===-1}),f._logEvent.level.label=K,f._logEvent.level.value=k,P(K,f._logEvent,X),f._logEvent=x(v)}function x(f){return{ts:0,messages:[],bindings:f||[],level:{label:"",value:0}}}function N(f){const n={type:f.constructor.name,msg:f.message,stack:f.stack};for(const l in f)n[l]===void 0&&(n[l]=f[l]);return n}function S(f){return typeof f.timestamp=="function"?f.timestamp:f.timestamp===!1?q:w}function I(){return{}}function C(f){return f}function R(){}function q(){return!1}function w(){return Date.now()}function D(){return Math.round(Date.now()/1e3)}function p(){return new Date(Date.now()).toISOString()}function _(){function f(n){return typeof n<"u"&&n}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return f(self)||f(window)||f(this)||{}}}return _i}var Yt={},an;function Eo(){return an||(an=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.PINO_CUSTOM_CONTEXT_KEY=Yt.PINO_LOGGER_DEFAULTS=void 0,Yt.PINO_LOGGER_DEFAULTS={level:"info"},Yt.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Yt}var it={},cn;function Fl(){if(cn)return it;cn=1,Object.defineProperty(it,"__esModule",{value:!0}),it.generateChildLogger=it.formatChildLoggerContext=it.getLoggerContext=it.setBrowserLoggerContext=it.getBrowserLoggerContext=it.getDefaultLoggerOptions=void 0;const t=Eo();function e(c){return Object.assign(Object.assign({},c),{level:(c==null?void 0:c.level)||t.PINO_LOGGER_DEFAULTS.level})}it.getDefaultLoggerOptions=e;function r(c,u=t.PINO_CUSTOM_CONTEXT_KEY){return c[u]||""}it.getBrowserLoggerContext=r;function i(c,u,g=t.PINO_CUSTOM_CONTEXT_KEY){return c[g]=u,c}it.setBrowserLoggerContext=i;function s(c,u=t.PINO_CUSTOM_CONTEXT_KEY){let g="";return typeof c.bindings>"u"?g=r(c,u):g=c.bindings().context||"",g}it.getLoggerContext=s;function a(c,u,g=t.PINO_CUSTOM_CONTEXT_KEY){const b=s(c,g);return b.trim()?`${b}/${u}`:u}it.formatChildLoggerContext=a;function h(c,u,g=t.PINO_CUSTOM_CONTEXT_KEY){const b=a(c,u,g),x=c.child({context:b});return i(x,b,g)}return it.generateChildLogger=h,it}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.pino=void 0;const e=wt,r=e.__importDefault(Pl());Object.defineProperty(t,"pino",{enumerable:!0,get:function(){return r.default}}),e.__exportStar(Eo(),t),e.__exportStar(Fl(),t)})(we);class Ul extends Zt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}class Ll extends Zt{constructor(e,r){super(),this.core=e,this.logger=r,this.records=new Map}}class Ml{constructor(e,r){this.logger=e,this.core=r}}class $l extends Zt{constructor(e,r){super(),this.relayer=e,this.logger=r}}let jl=class extends Zt{constructor(e){super()}},Bl=class{constructor(e,r,i,s){this.core=e,this.logger=r,this.name=i}};class zl extends Zt{constructor(e,r){super(),this.relayer=e,this.logger=r}}class ql extends Zt{constructor(e,r){super(),this.core=e,this.logger=r}}class Kl{constructor(e,r){this.projectId=e,this.logger=r}}class Hl{constructor(e){this.opts=e,this.protocol="wc",this.version=2}}class Vl{constructor(e){this.client=e}}const kl=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),Gl=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function vo(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return Gl(t)}catch{return t}}function Ji(t){return typeof t=="string"?t:kl(t)||""}var Xi={},Do={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=se,r=ft;t.DIGEST_LENGTH=64,t.BLOCK_SIZE=128;var i=function(){function c(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},c.prototype.update=function(u,g){if(g===void 0&&(g=u.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var b=0;if(this._bytesHashed+=g,this._bufferLength>0){for(;this._bufferLength<t.BLOCK_SIZE&&g>0;)this._buffer[this._bufferLength++]=u[b++],g--;this._bufferLength===this.blockSize&&(a(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(g>=this.blockSize&&(b=a(this._tempHi,this._tempLo,this._stateHi,this._stateLo,u,b,g),g%=this.blockSize);g>0;)this._buffer[this._bufferLength++]=u[b++],g--;return this},c.prototype.finish=function(u){if(!this._finished){var g=this._bytesHashed,b=this._bufferLength,x=g/536870912|0,N=g<<3,S=g%128<112?128:256;this._buffer[b]=128;for(var I=b+1;I<S-8;I++)this._buffer[I]=0;e.writeUint32BE(x,this._buffer,S-8),e.writeUint32BE(N,this._buffer,S-4),a(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,S),this._finished=!0}for(var I=0;I<this.digestLength/8;I++)e.writeUint32BE(this._stateHi[I],u,I*8),e.writeUint32BE(this._stateLo[I],u,I*8+4);return this},c.prototype.digest=function(){var u=new Uint8Array(this.digestLength);return this.finish(u),u},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(u){return this._stateHi.set(u.stateHi),this._stateLo.set(u.stateLo),this._bufferLength=u.bufferLength,u.buffer&&this._buffer.set(u.buffer),this._bytesHashed=u.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(u){r.wipe(u.stateHi),r.wipe(u.stateLo),u.buffer&&r.wipe(u.buffer),u.bufferLength=0,u.bytesHashed=0},c}();t.SHA512=i;var s=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function a(c,u,g,b,x,N,S){for(var I=g[0],C=g[1],R=g[2],q=g[3],w=g[4],D=g[5],p=g[6],_=g[7],f=b[0],n=b[1],l=b[2],P=b[3],F=b[4],K=b[5],k=b[6],X=b[7],v,A,G,j,L,$,U,B;S>=128;){for(var te=0;te<16;te++){var z=8*te+N;c[te]=e.readUint32BE(x,z),u[te]=e.readUint32BE(x,z+4)}for(var te=0;te<80;te++){var Z=I,Y=C,ee=R,T=q,O=w,m=D,o=p,y=_,H=f,W=n,le=l,be=P,de=F,Ee=K,Fe=k,Ae=X;if(v=_,A=X,L=A&65535,$=A>>>16,U=v&65535,B=v>>>16,v=(w>>>14|F<<32-14)^(w>>>18|F<<32-18)^(F>>>41-32|w<<32-(41-32)),A=(F>>>14|w<<32-14)^(F>>>18|w<<32-18)^(w>>>41-32|F<<32-(41-32)),L+=A&65535,$+=A>>>16,U+=v&65535,B+=v>>>16,v=w&D^~w&p,A=F&K^~F&k,L+=A&65535,$+=A>>>16,U+=v&65535,B+=v>>>16,v=s[te*2],A=s[te*2+1],L+=A&65535,$+=A>>>16,U+=v&65535,B+=v>>>16,v=c[te%16],A=u[te%16],L+=A&65535,$+=A>>>16,U+=v&65535,B+=v>>>16,$+=L>>>16,U+=$>>>16,B+=U>>>16,G=U&65535|B<<16,j=L&65535|$<<16,v=G,A=j,L=A&65535,$=A>>>16,U=v&65535,B=v>>>16,v=(I>>>28|f<<32-28)^(f>>>34-32|I<<32-(34-32))^(f>>>39-32|I<<32-(39-32)),A=(f>>>28|I<<32-28)^(I>>>34-32|f<<32-(34-32))^(I>>>39-32|f<<32-(39-32)),L+=A&65535,$+=A>>>16,U+=v&65535,B+=v>>>16,v=I&C^I&R^C&R,A=f&n^f&l^n&l,L+=A&65535,$+=A>>>16,U+=v&65535,B+=v>>>16,$+=L>>>16,U+=$>>>16,B+=U>>>16,y=U&65535|B<<16,Ae=L&65535|$<<16,v=T,A=be,L=A&65535,$=A>>>16,U=v&65535,B=v>>>16,v=G,A=j,L+=A&65535,$+=A>>>16,U+=v&65535,B+=v>>>16,$+=L>>>16,U+=$>>>16,B+=U>>>16,T=U&65535|B<<16,be=L&65535|$<<16,C=Z,R=Y,q=ee,w=T,D=O,p=m,_=o,I=y,n=H,l=W,P=le,F=be,K=de,k=Ee,X=Fe,f=Ae,te%16===15)for(var z=0;z<16;z++)v=c[z],A=u[z],L=A&65535,$=A>>>16,U=v&65535,B=v>>>16,v=c[(z+9)%16],A=u[(z+9)%16],L+=A&65535,$+=A>>>16,U+=v&65535,B+=v>>>16,G=c[(z+1)%16],j=u[(z+1)%16],v=(G>>>1|j<<32-1)^(G>>>8|j<<32-8)^G>>>7,A=(j>>>1|G<<32-1)^(j>>>8|G<<32-8)^(j>>>7|G<<32-7),L+=A&65535,$+=A>>>16,U+=v&65535,B+=v>>>16,G=c[(z+14)%16],j=u[(z+14)%16],v=(G>>>19|j<<32-19)^(j>>>61-32|G<<32-(61-32))^G>>>6,A=(j>>>19|G<<32-19)^(G>>>61-32|j<<32-(61-32))^(j>>>6|G<<32-6),L+=A&65535,$+=A>>>16,U+=v&65535,B+=v>>>16,$+=L>>>16,U+=$>>>16,B+=U>>>16,c[z]=U&65535|B<<16,u[z]=L&65535|$<<16}v=I,A=f,L=A&65535,$=A>>>16,U=v&65535,B=v>>>16,v=g[0],A=b[0],L+=A&65535,$+=A>>>16,U+=v&65535,B+=v>>>16,$+=L>>>16,U+=$>>>16,B+=U>>>16,g[0]=I=U&65535|B<<16,b[0]=f=L&65535|$<<16,v=C,A=n,L=A&65535,$=A>>>16,U=v&65535,B=v>>>16,v=g[1],A=b[1],L+=A&65535,$+=A>>>16,U+=v&65535,B+=v>>>16,$+=L>>>16,U+=$>>>16,B+=U>>>16,g[1]=C=U&65535|B<<16,b[1]=n=L&65535|$<<16,v=R,A=l,L=A&65535,$=A>>>16,U=v&65535,B=v>>>16,v=g[2],A=b[2],L+=A&65535,$+=A>>>16,U+=v&65535,B+=v>>>16,$+=L>>>16,U+=$>>>16,B+=U>>>16,g[2]=R=U&65535|B<<16,b[2]=l=L&65535|$<<16,v=q,A=P,L=A&65535,$=A>>>16,U=v&65535,B=v>>>16,v=g[3],A=b[3],L+=A&65535,$+=A>>>16,U+=v&65535,B+=v>>>16,$+=L>>>16,U+=$>>>16,B+=U>>>16,g[3]=q=U&65535|B<<16,b[3]=P=L&65535|$<<16,v=w,A=F,L=A&65535,$=A>>>16,U=v&65535,B=v>>>16,v=g[4],A=b[4],L+=A&65535,$+=A>>>16,U+=v&65535,B+=v>>>16,$+=L>>>16,U+=$>>>16,B+=U>>>16,g[4]=w=U&65535|B<<16,b[4]=F=L&65535|$<<16,v=D,A=K,L=A&65535,$=A>>>16,U=v&65535,B=v>>>16,v=g[5],A=b[5],L+=A&65535,$+=A>>>16,U+=v&65535,B+=v>>>16,$+=L>>>16,U+=$>>>16,B+=U>>>16,g[5]=D=U&65535|B<<16,b[5]=K=L&65535|$<<16,v=p,A=k,L=A&65535,$=A>>>16,U=v&65535,B=v>>>16,v=g[6],A=b[6],L+=A&65535,$+=A>>>16,U+=v&65535,B+=v>>>16,$+=L>>>16,U+=$>>>16,B+=U>>>16,g[6]=p=U&65535|B<<16,b[6]=k=L&65535|$<<16,v=_,A=X,L=A&65535,$=A>>>16,U=v&65535,B=v>>>16,v=g[7],A=b[7],L+=A&65535,$+=A>>>16,U+=v&65535,B+=v>>>16,$+=L>>>16,U+=$>>>16,B+=U>>>16,g[7]=_=U&65535|B<<16,b[7]=X=L&65535|$<<16,N+=128,S-=128}return N}function h(c){var u=new i;u.update(c);var g=u.digest();return u.clean(),g}t.hash=h})(Do);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.convertSecretKeyToX25519=t.convertPublicKeyToX25519=t.verify=t.sign=t.extractPublicKeyFromSecretKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.SEED_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=t.SIGNATURE_LENGTH=void 0;const e=nr,r=Do,i=ft;t.SIGNATURE_LENGTH=64,t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=64,t.SEED_LENGTH=32;function s(T){const O=new Float64Array(16);if(T)for(let m=0;m<T.length;m++)O[m]=T[m];return O}const a=new Uint8Array(32);a[0]=9;const h=s(),c=s([1]),u=s([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),g=s([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),b=s([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),x=s([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),N=s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function S(T,O){for(let m=0;m<16;m++)T[m]=O[m]|0}function I(T){let O=1;for(let m=0;m<16;m++){let o=T[m]+O+65535;O=Math.floor(o/65536),T[m]=o-O*65536}T[0]+=O-1+37*(O-1)}function C(T,O,m){const o=~(m-1);for(let y=0;y<16;y++){const H=o&(T[y]^O[y]);T[y]^=H,O[y]^=H}}function R(T,O){const m=s(),o=s();for(let y=0;y<16;y++)o[y]=O[y];I(o),I(o),I(o);for(let y=0;y<2;y++){m[0]=o[0]-65517;for(let W=1;W<15;W++)m[W]=o[W]-65535-(m[W-1]>>16&1),m[W-1]&=65535;m[15]=o[15]-32767-(m[14]>>16&1);const H=m[15]>>16&1;m[14]&=65535,C(o,m,1-H)}for(let y=0;y<16;y++)T[2*y]=o[y]&255,T[2*y+1]=o[y]>>8}function q(T,O){let m=0;for(let o=0;o<32;o++)m|=T[o]^O[o];return(1&m-1>>>8)-1}function w(T,O){const m=new Uint8Array(32),o=new Uint8Array(32);return R(m,T),R(o,O),q(m,o)}function D(T){const O=new Uint8Array(32);return R(O,T),O[0]&1}function p(T,O){for(let m=0;m<16;m++)T[m]=O[2*m]+(O[2*m+1]<<8);T[15]&=32767}function _(T,O,m){for(let o=0;o<16;o++)T[o]=O[o]+m[o]}function f(T,O,m){for(let o=0;o<16;o++)T[o]=O[o]-m[o]}function n(T,O,m){let o,y,H=0,W=0,le=0,be=0,de=0,Ee=0,Fe=0,Ae=0,ye=0,ge=0,fe=0,ue=0,ce=0,ae=0,oe=0,re=0,he=0,pe=0,ie=0,_e=0,me=0,De=0,Se=0,ve=0,mt=0,St=0,Ft=0,ut=0,qt=0,ur=0,Rr=0,Ue=m[0],Ne=m[1],Le=m[2],Me=m[3],$e=m[4],Ce=m[5],qe=m[6],Ke=m[7],He=m[8],Ve=m[9],ke=m[10],ze=m[11],je=m[12],Oe=m[13],Ge=m[14],We=m[15];o=O[0],H+=o*Ue,W+=o*Ne,le+=o*Le,be+=o*Me,de+=o*$e,Ee+=o*Ce,Fe+=o*qe,Ae+=o*Ke,ye+=o*He,ge+=o*Ve,fe+=o*ke,ue+=o*ze,ce+=o*je,ae+=o*Oe,oe+=o*Ge,re+=o*We,o=O[1],W+=o*Ue,le+=o*Ne,be+=o*Le,de+=o*Me,Ee+=o*$e,Fe+=o*Ce,Ae+=o*qe,ye+=o*Ke,ge+=o*He,fe+=o*Ve,ue+=o*ke,ce+=o*ze,ae+=o*je,oe+=o*Oe,re+=o*Ge,he+=o*We,o=O[2],le+=o*Ue,be+=o*Ne,de+=o*Le,Ee+=o*Me,Fe+=o*$e,Ae+=o*Ce,ye+=o*qe,ge+=o*Ke,fe+=o*He,ue+=o*Ve,ce+=o*ke,ae+=o*ze,oe+=o*je,re+=o*Oe,he+=o*Ge,pe+=o*We,o=O[3],be+=o*Ue,de+=o*Ne,Ee+=o*Le,Fe+=o*Me,Ae+=o*$e,ye+=o*Ce,ge+=o*qe,fe+=o*Ke,ue+=o*He,ce+=o*Ve,ae+=o*ke,oe+=o*ze,re+=o*je,he+=o*Oe,pe+=o*Ge,ie+=o*We,o=O[4],de+=o*Ue,Ee+=o*Ne,Fe+=o*Le,Ae+=o*Me,ye+=o*$e,ge+=o*Ce,fe+=o*qe,ue+=o*Ke,ce+=o*He,ae+=o*Ve,oe+=o*ke,re+=o*ze,he+=o*je,pe+=o*Oe,ie+=o*Ge,_e+=o*We,o=O[5],Ee+=o*Ue,Fe+=o*Ne,Ae+=o*Le,ye+=o*Me,ge+=o*$e,fe+=o*Ce,ue+=o*qe,ce+=o*Ke,ae+=o*He,oe+=o*Ve,re+=o*ke,he+=o*ze,pe+=o*je,ie+=o*Oe,_e+=o*Ge,me+=o*We,o=O[6],Fe+=o*Ue,Ae+=o*Ne,ye+=o*Le,ge+=o*Me,fe+=o*$e,ue+=o*Ce,ce+=o*qe,ae+=o*Ke,oe+=o*He,re+=o*Ve,he+=o*ke,pe+=o*ze,ie+=o*je,_e+=o*Oe,me+=o*Ge,De+=o*We,o=O[7],Ae+=o*Ue,ye+=o*Ne,ge+=o*Le,fe+=o*Me,ue+=o*$e,ce+=o*Ce,ae+=o*qe,oe+=o*Ke,re+=o*He,he+=o*Ve,pe+=o*ke,ie+=o*ze,_e+=o*je,me+=o*Oe,De+=o*Ge,Se+=o*We,o=O[8],ye+=o*Ue,ge+=o*Ne,fe+=o*Le,ue+=o*Me,ce+=o*$e,ae+=o*Ce,oe+=o*qe,re+=o*Ke,he+=o*He,pe+=o*Ve,ie+=o*ke,_e+=o*ze,me+=o*je,De+=o*Oe,Se+=o*Ge,ve+=o*We,o=O[9],ge+=o*Ue,fe+=o*Ne,ue+=o*Le,ce+=o*Me,ae+=o*$e,oe+=o*Ce,re+=o*qe,he+=o*Ke,pe+=o*He,ie+=o*Ve,_e+=o*ke,me+=o*ze,De+=o*je,Se+=o*Oe,ve+=o*Ge,mt+=o*We,o=O[10],fe+=o*Ue,ue+=o*Ne,ce+=o*Le,ae+=o*Me,oe+=o*$e,re+=o*Ce,he+=o*qe,pe+=o*Ke,ie+=o*He,_e+=o*Ve,me+=o*ke,De+=o*ze,Se+=o*je,ve+=o*Oe,mt+=o*Ge,St+=o*We,o=O[11],ue+=o*Ue,ce+=o*Ne,ae+=o*Le,oe+=o*Me,re+=o*$e,he+=o*Ce,pe+=o*qe,ie+=o*Ke,_e+=o*He,me+=o*Ve,De+=o*ke,Se+=o*ze,ve+=o*je,mt+=o*Oe,St+=o*Ge,Ft+=o*We,o=O[12],ce+=o*Ue,ae+=o*Ne,oe+=o*Le,re+=o*Me,he+=o*$e,pe+=o*Ce,ie+=o*qe,_e+=o*Ke,me+=o*He,De+=o*Ve,Se+=o*ke,ve+=o*ze,mt+=o*je,St+=o*Oe,Ft+=o*Ge,ut+=o*We,o=O[13],ae+=o*Ue,oe+=o*Ne,re+=o*Le,he+=o*Me,pe+=o*$e,ie+=o*Ce,_e+=o*qe,me+=o*Ke,De+=o*He,Se+=o*Ve,ve+=o*ke,mt+=o*ze,St+=o*je,Ft+=o*Oe,ut+=o*Ge,qt+=o*We,o=O[14],oe+=o*Ue,re+=o*Ne,he+=o*Le,pe+=o*Me,ie+=o*$e,_e+=o*Ce,me+=o*qe,De+=o*Ke,Se+=o*He,ve+=o*Ve,mt+=o*ke,St+=o*ze,Ft+=o*je,ut+=o*Oe,qt+=o*Ge,ur+=o*We,o=O[15],re+=o*Ue,he+=o*Ne,pe+=o*Le,ie+=o*Me,_e+=o*$e,me+=o*Ce,De+=o*qe,Se+=o*Ke,ve+=o*He,mt+=o*Ve,St+=o*ke,Ft+=o*ze,ut+=o*je,qt+=o*Oe,ur+=o*Ge,Rr+=o*We,H+=38*he,W+=38*pe,le+=38*ie,be+=38*_e,de+=38*me,Ee+=38*De,Fe+=38*Se,Ae+=38*ve,ye+=38*mt,ge+=38*St,fe+=38*Ft,ue+=38*ut,ce+=38*qt,ae+=38*ur,oe+=38*Rr,y=1,o=H+y+65535,y=Math.floor(o/65536),H=o-y*65536,o=W+y+65535,y=Math.floor(o/65536),W=o-y*65536,o=le+y+65535,y=Math.floor(o/65536),le=o-y*65536,o=be+y+65535,y=Math.floor(o/65536),be=o-y*65536,o=de+y+65535,y=Math.floor(o/65536),de=o-y*65536,o=Ee+y+65535,y=Math.floor(o/65536),Ee=o-y*65536,o=Fe+y+65535,y=Math.floor(o/65536),Fe=o-y*65536,o=Ae+y+65535,y=Math.floor(o/65536),Ae=o-y*65536,o=ye+y+65535,y=Math.floor(o/65536),ye=o-y*65536,o=ge+y+65535,y=Math.floor(o/65536),ge=o-y*65536,o=fe+y+65535,y=Math.floor(o/65536),fe=o-y*65536,o=ue+y+65535,y=Math.floor(o/65536),ue=o-y*65536,o=ce+y+65535,y=Math.floor(o/65536),ce=o-y*65536,o=ae+y+65535,y=Math.floor(o/65536),ae=o-y*65536,o=oe+y+65535,y=Math.floor(o/65536),oe=o-y*65536,o=re+y+65535,y=Math.floor(o/65536),re=o-y*65536,H+=y-1+37*(y-1),y=1,o=H+y+65535,y=Math.floor(o/65536),H=o-y*65536,o=W+y+65535,y=Math.floor(o/65536),W=o-y*65536,o=le+y+65535,y=Math.floor(o/65536),le=o-y*65536,o=be+y+65535,y=Math.floor(o/65536),be=o-y*65536,o=de+y+65535,y=Math.floor(o/65536),de=o-y*65536,o=Ee+y+65535,y=Math.floor(o/65536),Ee=o-y*65536,o=Fe+y+65535,y=Math.floor(o/65536),Fe=o-y*65536,o=Ae+y+65535,y=Math.floor(o/65536),Ae=o-y*65536,o=ye+y+65535,y=Math.floor(o/65536),ye=o-y*65536,o=ge+y+65535,y=Math.floor(o/65536),ge=o-y*65536,o=fe+y+65535,y=Math.floor(o/65536),fe=o-y*65536,o=ue+y+65535,y=Math.floor(o/65536),ue=o-y*65536,o=ce+y+65535,y=Math.floor(o/65536),ce=o-y*65536,o=ae+y+65535,y=Math.floor(o/65536),ae=o-y*65536,o=oe+y+65535,y=Math.floor(o/65536),oe=o-y*65536,o=re+y+65535,y=Math.floor(o/65536),re=o-y*65536,H+=y-1+37*(y-1),T[0]=H,T[1]=W,T[2]=le,T[3]=be,T[4]=de,T[5]=Ee,T[6]=Fe,T[7]=Ae,T[8]=ye,T[9]=ge,T[10]=fe,T[11]=ue,T[12]=ce,T[13]=ae,T[14]=oe,T[15]=re}function l(T,O){n(T,O,O)}function P(T,O){const m=s();let o;for(o=0;o<16;o++)m[o]=O[o];for(o=253;o>=0;o--)l(m,m),o!==2&&o!==4&&n(m,m,O);for(o=0;o<16;o++)T[o]=m[o]}function F(T,O){const m=s();let o;for(o=0;o<16;o++)m[o]=O[o];for(o=250;o>=0;o--)l(m,m),o!==1&&n(m,m,O);for(o=0;o<16;o++)T[o]=m[o]}function K(T,O){const m=s(),o=s(),y=s(),H=s(),W=s(),le=s(),be=s(),de=s(),Ee=s();f(m,T[1],T[0]),f(Ee,O[1],O[0]),n(m,m,Ee),_(o,T[0],T[1]),_(Ee,O[0],O[1]),n(o,o,Ee),n(y,T[3],O[3]),n(y,y,g),n(H,T[2],O[2]),_(H,H,H),f(W,o,m),f(le,H,y),_(be,H,y),_(de,o,m),n(T[0],W,le),n(T[1],de,be),n(T[2],be,le),n(T[3],W,de)}function k(T,O,m){for(let o=0;o<4;o++)C(T[o],O[o],m)}function X(T,O){const m=s(),o=s(),y=s();P(y,O[2]),n(m,O[0],y),n(o,O[1],y),R(T,o),T[31]^=D(m)<<7}function v(T,O,m){S(T[0],h),S(T[1],c),S(T[2],c),S(T[3],h);for(let o=255;o>=0;--o){const y=m[o/8|0]>>(o&7)&1;k(T,O,y),K(O,T),K(T,T),k(T,O,y)}}function A(T,O){const m=[s(),s(),s(),s()];S(m[0],b),S(m[1],x),S(m[2],c),n(m[3],b,x),v(T,m,O)}function G(T){if(T.length!==t.SEED_LENGTH)throw new Error(`ed25519: seed must be ${t.SEED_LENGTH} bytes`);const O=(0,r.hash)(T);O[0]&=248,O[31]&=127,O[31]|=64;const m=new Uint8Array(32),o=[s(),s(),s(),s()];A(o,O),X(m,o);const y=new Uint8Array(64);return y.set(T),y.set(m,32),{publicKey:m,secretKey:y}}t.generateKeyPairFromSeed=G;function j(T){const O=(0,e.randomBytes)(32,T),m=G(O);return(0,i.wipe)(O),m}t.generateKeyPair=j;function L(T){if(T.length!==t.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${t.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(T.subarray(32))}t.extractPublicKeyFromSecretKey=L;const $=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function U(T,O){let m,o,y,H;for(o=63;o>=32;--o){for(m=0,y=o-32,H=o-12;y<H;++y)O[y]+=m-16*O[o]*$[y-(o-32)],m=Math.floor((O[y]+128)/256),O[y]-=m*256;O[y]+=m,O[o]=0}for(m=0,y=0;y<32;y++)O[y]+=m-(O[31]>>4)*$[y],m=O[y]>>8,O[y]&=255;for(y=0;y<32;y++)O[y]-=m*$[y];for(o=0;o<32;o++)O[o+1]+=O[o]>>8,T[o]=O[o]&255}function B(T){const O=new Float64Array(64);for(let m=0;m<64;m++)O[m]=T[m];for(let m=0;m<64;m++)T[m]=0;U(T,O)}function te(T,O){const m=new Float64Array(64),o=[s(),s(),s(),s()],y=(0,r.hash)(T.subarray(0,32));y[0]&=248,y[31]&=127,y[31]|=64;const H=new Uint8Array(64);H.set(y.subarray(32),32);const W=new r.SHA512;W.update(H.subarray(32)),W.update(O);const le=W.digest();W.clean(),B(le),A(o,le),X(H,o),W.reset(),W.update(H.subarray(0,32)),W.update(T.subarray(32)),W.update(O);const be=W.digest();B(be);for(let de=0;de<32;de++)m[de]=le[de];for(let de=0;de<32;de++)for(let Ee=0;Ee<32;Ee++)m[de+Ee]+=be[de]*y[Ee];return U(H.subarray(32),m),H}t.sign=te;function z(T,O){const m=s(),o=s(),y=s(),H=s(),W=s(),le=s(),be=s();return S(T[2],c),p(T[1],O),l(y,T[1]),n(H,y,u),f(y,y,T[2]),_(H,T[2],H),l(W,H),l(le,W),n(be,le,W),n(m,be,y),n(m,m,H),F(m,m),n(m,m,y),n(m,m,H),n(m,m,H),n(T[0],m,H),l(o,T[0]),n(o,o,H),w(o,y)&&n(T[0],T[0],N),l(o,T[0]),n(o,o,H),w(o,y)?-1:(D(T[0])===O[31]>>7&&f(T[0],h,T[0]),n(T[3],T[0],T[1]),0)}function Z(T,O,m){const o=new Uint8Array(32),y=[s(),s(),s(),s()],H=[s(),s(),s(),s()];if(m.length!==t.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${t.SIGNATURE_LENGTH} bytes`);if(z(H,T))return!1;const W=new r.SHA512;W.update(m.subarray(0,32)),W.update(T),W.update(O);const le=W.digest();return B(le),v(y,H,le),A(H,m.subarray(32)),K(y,H),X(o,y),!q(m,o)}t.verify=Z;function Y(T){let O=[s(),s(),s(),s()];if(z(O,T))throw new Error("Ed25519: invalid public key");let m=s(),o=s(),y=O[1];_(m,c,y),f(o,c,y),P(o,o),n(m,m,o);let H=new Uint8Array(32);return R(H,m),H}t.convertPublicKeyToX25519=Y;function ee(T){const O=(0,r.hash)(T.subarray(0,32));O[0]&=248,O[31]&=127,O[31]|=64;const m=new Uint8Array(O.subarray(0,32));return(0,i.wipe)(O),m}t.convertSecretKeyToX25519=ee})(Xi);const Wl="EdDSA",Yl="JWT",So=".",xo="base64url",Jl="utf8",Xl="utf8",Ql=":",Zl="did",ef="key",un="base58btc",tf="z",rf="K36",sf=32;function Wr(t){return ot(ct(Ji(t),Jl),xo)}function Io(t){const e=ct(rf,un),r=tf+ot(Ni([e,t]),un);return[Zl,ef,r].join(Ql)}function nf(t){return ot(t,xo)}function of(t){return ct([Wr(t.header),Wr(t.payload)].join(So),Xl)}function af(t){return[Wr(t.header),Wr(t.payload),nf(t.signature)].join(So)}function hn(t=nr.randomBytes(sf)){return Xi.generateKeyPairFromSeed(t)}async function cf(t,e,r,i,s=Q.fromMiliseconds(Date.now())){const a={alg:Wl,typ:Yl},h=Io(i.publicKey),c=s+r,u={iss:h,sub:t,aud:e,iat:s,exp:c},g=of({header:a,payload:u}),b=Xi.sign(i.secretKey,g);return af({header:a,payload:u,signature:b})}const uf="PARSE_ERROR",hf="INVALID_REQUEST",lf="METHOD_NOT_FOUND",ff="INVALID_PARAMS",Oo="INTERNAL_ERROR",Qi="SERVER_ERROR",df=[-32700,-32600,-32601,-32602,-32603],Sr={[uf]:{code:-32700,message:"Parse error"},[hf]:{code:-32600,message:"Invalid Request"},[lf]:{code:-32601,message:"Method not found"},[ff]:{code:-32602,message:"Invalid params"},[Oo]:{code:-32603,message:"Internal error"},[Qi]:{code:-32e3,message:"Server error"}},To=Qi;function gf(t){return df.includes(t)}function ln(t){return Object.keys(Sr).includes(t)?Sr[t]:Sr[To]}function pf(t){const e=Object.values(Sr).find(r=>r.code===t);return e||Sr[To]}function yf(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var Ao={},Ct={},fn;function bf(){if(fn)return Ct;fn=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.isBrowserCryptoAvailable=Ct.getSubtleCrypto=Ct.getBrowerCrypto=void 0;function t(){return(lt===null||lt===void 0?void 0:lt.crypto)||(lt===null||lt===void 0?void 0:lt.msCrypto)||{}}Ct.getBrowerCrypto=t;function e(){const i=t();return i.subtle||i.webkitSubtle}Ct.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return Ct.isBrowserCryptoAvailable=r,Ct}var Rt={},dn;function _f(){if(dn)return Rt;dn=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.isBrowser=Rt.isNode=Rt.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Rt.isReactNative=t;function e(){return typeof Tt<"u"&&typeof Tt.versions<"u"&&typeof Tt.versions.node<"u"}Rt.isNode=e;function r(){return!t()&&!e()}return Rt.isBrowser=r,Rt}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=wt;e.__exportStar(bf(),t),e.__exportStar(_f(),t)})(Ao);function No(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function Zi(t=6){return BigInt(No(t))}function ii(t,e,r){return{id:r||No(),jsonrpc:"2.0",method:t,params:e}}function es(t,e){return{id:t,jsonrpc:"2.0",result:e}}function ts(t,e,r){return{id:t,jsonrpc:"2.0",error:wf(e,r)}}function wf(t,e){return typeof t>"u"?ln(Oo):(typeof t=="string"&&(t=Object.assign(Object.assign({},ln(Qi)),{message:t})),typeof e<"u"&&(t.data=e),gf(t.code)&&(t=pf(t.code)),t)}class mf{}class Ef extends mf{constructor(){super()}}class vf extends Ef{constructor(e){super()}}const Df="^https?:",Sf="^wss?:";function xf(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function Co(t,e){const r=xf(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function Pp(t){return Co(t,Df)}function gn(t){return Co(t,Sf)}function If(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function Ro(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function rs(t){return Ro(t)&&"method"in t}function si(t){return Ro(t)&&(Pt(t)||Dt(t))}function Pt(t){return"result"in t}function Dt(t){return"error"in t}class Of extends vf{constructor(e){super(e),this.events=new _t.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(ii(e.method,e.params||[],e.id||Zi().toString()),r)}async requestStrict(e,r){return new Promise(async(i,s)=>{if(!this.connection.connected)try{await this.open()}catch(a){s(a)}this.events.on(`${e.id}`,a=>{Dt(a)?s(a.error):i(a.result)});try{await this.connection.send(e,r)}catch(a){s(a)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),si(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const Tf=()=>typeof WebSocket<"u"?WebSocket:typeof bt<"u"&&typeof bt.WebSocket<"u"?bt.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),Af=()=>typeof WebSocket<"u"||typeof bt<"u"&&typeof bt.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",pn=t=>t.split("?")[0],yn=10,Nf=Tf();class Cf{constructor(e){if(this.url=e,this.events=new _t.EventEmitter,this.registering=!1,!gn(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Ji(e))}catch(i){this.onError(e.id,i)}}register(e=this.url){if(!gn(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,s)=>{this.events.once("register_error",a=>{this.resetMaxListeners(),s(a)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const s=Ao.isReactNative()?void 0:{rejectUnauthorized:!If(e)},a=new Nf(e,[],s);Af()?a.onerror=h=>{const c=h;i(this.emitError(c.error))}:a.on("error",h=>{i(this.emitError(h))}),a.onopen=()=>{this.onOpen(a),r(a)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?vo(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),s=i.message||i.toString(),a=ts(e,s);this.events.emit("payload",a)}parseError(e,r=this.url){return yf(e,pn(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>yn&&this.events.setMaxListeners(yn)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${pn(this.url)}`));return this.events.emit("register_error",r),r}}var Yr={},Rf={get exports(){return Yr},set exports(t){Yr=t}};(function(t,e){var r=200,i="__lodash_hash_undefined__",s=1,a=2,h=9007199254740991,c="[object Arguments]",u="[object Array]",g="[object AsyncFunction]",b="[object Boolean]",x="[object Date]",N="[object Error]",S="[object Function]",I="[object GeneratorFunction]",C="[object Map]",R="[object Number]",q="[object Null]",w="[object Object]",D="[object Promise]",p="[object Proxy]",_="[object RegExp]",f="[object Set]",n="[object String]",l="[object Symbol]",P="[object Undefined]",F="[object WeakMap]",K="[object ArrayBuffer]",k="[object DataView]",X="[object Float32Array]",v="[object Float64Array]",A="[object Int8Array]",G="[object Int16Array]",j="[object Int32Array]",L="[object Uint8Array]",$="[object Uint8ClampedArray]",U="[object Uint16Array]",B="[object Uint32Array]",te=/[\\^$.*+?()[\]{}|]/g,z=/^\[object .+?Constructor\]$/,Z=/^(?:0|[1-9]\d*)$/,Y={};Y[X]=Y[v]=Y[A]=Y[G]=Y[j]=Y[L]=Y[$]=Y[U]=Y[B]=!0,Y[c]=Y[u]=Y[K]=Y[b]=Y[k]=Y[x]=Y[N]=Y[S]=Y[C]=Y[R]=Y[w]=Y[_]=Y[f]=Y[n]=Y[F]=!1;var ee=typeof lt=="object"&&lt&&lt.Object===Object&&lt,T=typeof self=="object"&&self&&self.Object===Object&&self,O=ee||T||Function("return this")(),m=e&&!e.nodeType&&e,o=m&&!0&&t&&!t.nodeType&&t,y=o&&o.exports===m,H=y&&ee.process,W=function(){try{return H&&H.binding&&H.binding("util")}catch{}}(),le=W&&W.isTypedArray;function be(d,E){for(var M=-1,J=d==null?0:d.length,Ie=0,ne=[];++M<J;){var Re=d[M];E(Re,M,d)&&(ne[Ie++]=Re)}return ne}function de(d,E){for(var M=-1,J=E.length,Ie=d.length;++M<J;)d[Ie+M]=E[M];return d}function Ee(d,E){for(var M=-1,J=d==null?0:d.length;++M<J;)if(E(d[M],M,d))return!0;return!1}function Fe(d,E){for(var M=-1,J=Array(d);++M<d;)J[M]=E(M);return J}function Ae(d){return function(E){return d(E)}}function ye(d,E){return d.has(E)}function ge(d,E){return d==null?void 0:d[E]}function fe(d){var E=-1,M=Array(d.size);return d.forEach(function(J,Ie){M[++E]=[Ie,J]}),M}function ue(d,E){return function(M){return d(E(M))}}function ce(d){var E=-1,M=Array(d.size);return d.forEach(function(J){M[++E]=J}),M}var ae=Array.prototype,oe=Function.prototype,re=Object.prototype,he=O["__core-js_shared__"],pe=oe.toString,ie=re.hasOwnProperty,_e=function(){var d=/[^.]+$/.exec(he&&he.keys&&he.keys.IE_PROTO||"");return d?"Symbol(src)_1."+d:""}(),me=re.toString,De=RegExp("^"+pe.call(ie).replace(te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Se=y?O.Buffer:void 0,ve=O.Symbol,mt=O.Uint8Array,St=re.propertyIsEnumerable,Ft=ae.splice,ut=ve?ve.toStringTag:void 0,qt=Object.getOwnPropertySymbols,ur=Se?Se.isBuffer:void 0,Rr=ue(Object.keys,Object),Ue=er(O,"DataView"),Ne=er(O,"Map"),Le=er(O,"Promise"),Me=er(O,"Set"),$e=er(O,"WeakMap"),Ce=er(Object,"create"),qe=Ht(Ue),Ke=Ht(Ne),He=Ht(Le),Ve=Ht(Me),ke=Ht($e),ze=ve?ve.prototype:void 0,je=ze?ze.valueOf:void 0;function Oe(d){var E=-1,M=d==null?0:d.length;for(this.clear();++E<M;){var J=d[E];this.set(J[0],J[1])}}function Ge(){this.__data__=Ce?Ce(null):{},this.size=0}function We(d){var E=this.has(d)&&delete this.__data__[d];return this.size-=E?1:0,E}function Xo(d){var E=this.__data__;if(Ce){var M=E[d];return M===i?void 0:M}return ie.call(E,d)?E[d]:void 0}function Qo(d){var E=this.__data__;return Ce?E[d]!==void 0:ie.call(E,d)}function Zo(d,E){var M=this.__data__;return this.size+=this.has(d)?0:1,M[d]=Ce&&E===void 0?i:E,this}Oe.prototype.clear=Ge,Oe.prototype.delete=We,Oe.prototype.get=Xo,Oe.prototype.has=Qo,Oe.prototype.set=Zo;function At(d){var E=-1,M=d==null?0:d.length;for(this.clear();++E<M;){var J=d[E];this.set(J[0],J[1])}}function ea(){this.__data__=[],this.size=0}function ta(d){var E=this.__data__,M=Fr(E,d);if(M<0)return!1;var J=E.length-1;return M==J?E.pop():Ft.call(E,M,1),--this.size,!0}function ra(d){var E=this.__data__,M=Fr(E,d);return M<0?void 0:E[M][1]}function ia(d){return Fr(this.__data__,d)>-1}function sa(d,E){var M=this.__data__,J=Fr(M,d);return J<0?(++this.size,M.push([d,E])):M[J][1]=E,this}At.prototype.clear=ea,At.prototype.delete=ta,At.prototype.get=ra,At.prototype.has=ia,At.prototype.set=sa;function Kt(d){var E=-1,M=d==null?0:d.length;for(this.clear();++E<M;){var J=d[E];this.set(J[0],J[1])}}function na(){this.size=0,this.__data__={hash:new Oe,map:new(Ne||At),string:new Oe}}function oa(d){var E=Ur(this,d).delete(d);return this.size-=E?1:0,E}function aa(d){return Ur(this,d).get(d)}function ca(d){return Ur(this,d).has(d)}function ua(d,E){var M=Ur(this,d),J=M.size;return M.set(d,E),this.size+=M.size==J?0:1,this}Kt.prototype.clear=na,Kt.prototype.delete=oa,Kt.prototype.get=aa,Kt.prototype.has=ca,Kt.prototype.set=ua;function Pr(d){var E=-1,M=d==null?0:d.length;for(this.__data__=new Kt;++E<M;)this.add(d[E])}function ha(d){return this.__data__.set(d,i),this}function la(d){return this.__data__.has(d)}Pr.prototype.add=Pr.prototype.push=ha,Pr.prototype.has=la;function Ut(d){var E=this.__data__=new At(d);this.size=E.size}function fa(){this.__data__=new At,this.size=0}function da(d){var E=this.__data__,M=E.delete(d);return this.size=E.size,M}function ga(d){return this.__data__.get(d)}function pa(d){return this.__data__.has(d)}function ya(d,E){var M=this.__data__;if(M instanceof At){var J=M.__data__;if(!Ne||J.length<r-1)return J.push([d,E]),this.size=++M.size,this;M=this.__data__=new Kt(J)}return M.set(d,E),this.size=M.size,this}Ut.prototype.clear=fa,Ut.prototype.delete=da,Ut.prototype.get=ga,Ut.prototype.has=pa,Ut.prototype.set=ya;function ba(d,E){var M=Lr(d),J=!M&&Ra(d),Ie=!M&&!J&&ai(d),ne=!M&&!J&&!Ie&&gs(d),Re=M||J||Ie||ne,Ye=Re?Fe(d.length,String):[],Qe=Ye.length;for(var Te in d)(E||ie.call(d,Te))&&!(Re&&(Te=="length"||Ie&&(Te=="offset"||Te=="parent")||ne&&(Te=="buffer"||Te=="byteLength"||Te=="byteOffset")||Oa(Te,Qe)))&&Ye.push(Te);return Ye}function Fr(d,E){for(var M=d.length;M--;)if(hs(d[M][0],E))return M;return-1}function _a(d,E,M){var J=E(d);return Lr(d)?J:de(J,M(d))}function hr(d){return d==null?d===void 0?P:q:ut&&ut in Object(d)?xa(d):Ca(d)}function os(d){return lr(d)&&hr(d)==c}function as(d,E,M,J,Ie){return d===E?!0:d==null||E==null||!lr(d)&&!lr(E)?d!==d&&E!==E:wa(d,E,M,J,as,Ie)}function wa(d,E,M,J,Ie,ne){var Re=Lr(d),Ye=Lr(E),Qe=Re?u:Lt(d),Te=Ye?u:Lt(E);Qe=Qe==c?w:Qe,Te=Te==c?w:Te;var ht=Qe==w,Et=Te==w,tt=Qe==Te;if(tt&&ai(d)){if(!ai(E))return!1;Re=!0,ht=!1}if(tt&&!ht)return ne||(ne=new Ut),Re||gs(d)?cs(d,E,M,J,Ie,ne):Da(d,E,Qe,M,J,Ie,ne);if(!(M&s)){var dt=ht&&ie.call(d,"__wrapped__"),gt=Et&&ie.call(E,"__wrapped__");if(dt||gt){var Mt=dt?d.value():d,Nt=gt?E.value():E;return ne||(ne=new Ut),Ie(Mt,Nt,M,J,ne)}}return tt?(ne||(ne=new Ut),Sa(d,E,M,J,Ie,ne)):!1}function ma(d){if(!ds(d)||Aa(d))return!1;var E=ls(d)?De:z;return E.test(Ht(d))}function Ea(d){return lr(d)&&fs(d.length)&&!!Y[hr(d)]}function va(d){if(!Na(d))return Rr(d);var E=[];for(var M in Object(d))ie.call(d,M)&&M!="constructor"&&E.push(M);return E}function cs(d,E,M,J,Ie,ne){var Re=M&s,Ye=d.length,Qe=E.length;if(Ye!=Qe&&!(Re&&Qe>Ye))return!1;var Te=ne.get(d);if(Te&&ne.get(E))return Te==E;var ht=-1,Et=!0,tt=M&a?new Pr:void 0;for(ne.set(d,E),ne.set(E,d);++ht<Ye;){var dt=d[ht],gt=E[ht];if(J)var Mt=Re?J(gt,dt,ht,E,d,ne):J(dt,gt,ht,d,E,ne);if(Mt!==void 0){if(Mt)continue;Et=!1;break}if(tt){if(!Ee(E,function(Nt,Vt){if(!ye(tt,Vt)&&(dt===Nt||Ie(dt,Nt,M,J,ne)))return tt.push(Vt)})){Et=!1;break}}else if(!(dt===gt||Ie(dt,gt,M,J,ne))){Et=!1;break}}return ne.delete(d),ne.delete(E),Et}function Da(d,E,M,J,Ie,ne,Re){switch(M){case k:if(d.byteLength!=E.byteLength||d.byteOffset!=E.byteOffset)return!1;d=d.buffer,E=E.buffer;case K:return!(d.byteLength!=E.byteLength||!ne(new mt(d),new mt(E)));case b:case x:case R:return hs(+d,+E);case N:return d.name==E.name&&d.message==E.message;case _:case n:return d==E+"";case C:var Ye=fe;case f:var Qe=J&s;if(Ye||(Ye=ce),d.size!=E.size&&!Qe)return!1;var Te=Re.get(d);if(Te)return Te==E;J|=a,Re.set(d,E);var ht=cs(Ye(d),Ye(E),J,Ie,ne,Re);return Re.delete(d),ht;case l:if(je)return je.call(d)==je.call(E)}return!1}function Sa(d,E,M,J,Ie,ne){var Re=M&s,Ye=us(d),Qe=Ye.length,Te=us(E),ht=Te.length;if(Qe!=ht&&!Re)return!1;for(var Et=Qe;Et--;){var tt=Ye[Et];if(!(Re?tt in E:ie.call(E,tt)))return!1}var dt=ne.get(d);if(dt&&ne.get(E))return dt==E;var gt=!0;ne.set(d,E),ne.set(E,d);for(var Mt=Re;++Et<Qe;){tt=Ye[Et];var Nt=d[tt],Vt=E[tt];if(J)var ps=Re?J(Vt,Nt,tt,E,d,ne):J(Nt,Vt,tt,d,E,ne);if(!(ps===void 0?Nt===Vt||Ie(Nt,Vt,M,J,ne):ps)){gt=!1;break}Mt||(Mt=tt=="constructor")}if(gt&&!Mt){var Mr=d.constructor,$r=E.constructor;Mr!=$r&&"constructor"in d&&"constructor"in E&&!(typeof Mr=="function"&&Mr instanceof Mr&&typeof $r=="function"&&$r instanceof $r)&&(gt=!1)}return ne.delete(d),ne.delete(E),gt}function us(d){return _a(d,Ua,Ia)}function Ur(d,E){var M=d.__data__;return Ta(E)?M[typeof E=="string"?"string":"hash"]:M.map}function er(d,E){var M=ge(d,E);return ma(M)?M:void 0}function xa(d){var E=ie.call(d,ut),M=d[ut];try{d[ut]=void 0;var J=!0}catch{}var Ie=me.call(d);return J&&(E?d[ut]=M:delete d[ut]),Ie}var Ia=qt?function(d){return d==null?[]:(d=Object(d),be(qt(d),function(E){return St.call(d,E)}))}:La,Lt=hr;(Ue&&Lt(new Ue(new ArrayBuffer(1)))!=k||Ne&&Lt(new Ne)!=C||Le&&Lt(Le.resolve())!=D||Me&&Lt(new Me)!=f||$e&&Lt(new $e)!=F)&&(Lt=function(d){var E=hr(d),M=E==w?d.constructor:void 0,J=M?Ht(M):"";if(J)switch(J){case qe:return k;case Ke:return C;case He:return D;case Ve:return f;case ke:return F}return E});function Oa(d,E){return E=E??h,!!E&&(typeof d=="number"||Z.test(d))&&d>-1&&d%1==0&&d<E}function Ta(d){var E=typeof d;return E=="string"||E=="number"||E=="symbol"||E=="boolean"?d!=="__proto__":d===null}function Aa(d){return!!_e&&_e in d}function Na(d){var E=d&&d.constructor,M=typeof E=="function"&&E.prototype||re;return d===M}function Ca(d){return me.call(d)}function Ht(d){if(d!=null){try{return pe.call(d)}catch{}try{return d+""}catch{}}return""}function hs(d,E){return d===E||d!==d&&E!==E}var Ra=os(function(){return arguments}())?os:function(d){return lr(d)&&ie.call(d,"callee")&&!St.call(d,"callee")},Lr=Array.isArray;function Pa(d){return d!=null&&fs(d.length)&&!ls(d)}var ai=ur||Ma;function Fa(d,E){return as(d,E)}function ls(d){if(!ds(d))return!1;var E=hr(d);return E==S||E==I||E==g||E==p}function fs(d){return typeof d=="number"&&d>-1&&d%1==0&&d<=h}function ds(d){var E=typeof d;return d!=null&&(E=="object"||E=="function")}function lr(d){return d!=null&&typeof d=="object"}var gs=le?Ae(le):Ea;function Ua(d){return Pa(d)?ba(d):va(d)}function La(){return[]}function Ma(){return!1}t.exports=Fa})(Rf,Yr);function Pf(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var a=t.charAt(s),h=a.charCodeAt(0);if(r[h]!==255)throw new TypeError(a+" is ambiguous");r[h]=s}var c=t.length,u=t.charAt(0),g=Math.log(c)/Math.log(256),b=Math.log(256)/Math.log(c);function x(I){if(I instanceof Uint8Array||(ArrayBuffer.isView(I)?I=new Uint8Array(I.buffer,I.byteOffset,I.byteLength):Array.isArray(I)&&(I=Uint8Array.from(I))),!(I instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(I.length===0)return"";for(var C=0,R=0,q=0,w=I.length;q!==w&&I[q]===0;)q++,C++;for(var D=(w-q)*b+1>>>0,p=new Uint8Array(D);q!==w;){for(var _=I[q],f=0,n=D-1;(_!==0||f<R)&&n!==-1;n--,f++)_+=256*p[n]>>>0,p[n]=_%c>>>0,_=_/c>>>0;if(_!==0)throw new Error("Non-zero carry");R=f,q++}for(var l=D-R;l!==D&&p[l]===0;)l++;for(var P=u.repeat(C);l<D;++l)P+=t.charAt(p[l]);return P}function N(I){if(typeof I!="string")throw new TypeError("Expected String");if(I.length===0)return new Uint8Array;var C=0;if(I[C]!==" "){for(var R=0,q=0;I[C]===u;)R++,C++;for(var w=(I.length-C)*g+1>>>0,D=new Uint8Array(w);I[C];){var p=r[I.charCodeAt(C)];if(p===255)return;for(var _=0,f=w-1;(p!==0||_<q)&&f!==-1;f--,_++)p+=c*D[f]>>>0,D[f]=p%256>>>0,p=p/256>>>0;if(p!==0)throw new Error("Non-zero carry");q=_,C++}if(I[C]!==" "){for(var n=w-q;n!==w&&D[n]===0;)n++;for(var l=new Uint8Array(R+(w-n)),P=R;n!==w;)l[P++]=D[n++];return l}}}function S(I){var C=N(I);if(C)return C;throw new Error(`Non-${e} character`)}return{encode:x,decodeUnsafe:N,decode:S}}var Ff=Pf,Uf=Ff;const Po=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Lf=t=>new TextEncoder().encode(t),Mf=t=>new TextDecoder().decode(t);class $f{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class jf{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Fo(this,e)}}class Bf{constructor(e){this.decoders=e}or(e){return Fo(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Fo=(t,e)=>new Bf({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class zf{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new $f(e,r,i),this.decoder=new jf(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ni=({name:t,prefix:e,encode:r,decode:i})=>new zf(t,e,r,i),Cr=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=Uf(r,e);return ni({prefix:t,name:e,encode:i,decode:a=>Po(s(a))})},qf=(t,e,r,i)=>{const s={};for(let b=0;b<e.length;++b)s[e[b]]=b;let a=t.length;for(;t[a-1]==="=";)--a;const h=new Uint8Array(a*r/8|0);let c=0,u=0,g=0;for(let b=0;b<a;++b){const x=s[t[b]];if(x===void 0)throw new SyntaxError(`Non-${i} character`);u=u<<r|x,c+=r,c>=8&&(c-=8,h[g++]=255&u>>c)}if(c>=r||255&u<<8-c)throw new SyntaxError("Unexpected end of data");return h},Kf=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let a="",h=0,c=0;for(let u=0;u<t.length;++u)for(c=c<<8|t[u],h+=8;h>r;)h-=r,a+=e[s&c>>h];if(h&&(a+=e[s&c<<r-h]),i)for(;a.length*r&7;)a+="=";return a},et=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>ni({prefix:e,name:t,encode(s){return Kf(s,i,r)},decode(s){return qf(s,i,r,t)}}),Hf=ni({prefix:"\0",name:"identity",encode:t=>Mf(t),decode:t=>Lf(t)});var Vf=Object.freeze({__proto__:null,identity:Hf});const kf=et({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Gf=Object.freeze({__proto__:null,base2:kf});const Wf=et({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Yf=Object.freeze({__proto__:null,base8:Wf});const Jf=Cr({prefix:"9",name:"base10",alphabet:"0123456789"});var Xf=Object.freeze({__proto__:null,base10:Jf});const Qf=et({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Zf=et({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var ed=Object.freeze({__proto__:null,base16:Qf,base16upper:Zf});const td=et({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),rd=et({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),id=et({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),sd=et({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),nd=et({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),od=et({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ad=et({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),cd=et({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ud=et({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var hd=Object.freeze({__proto__:null,base32:td,base32upper:rd,base32pad:id,base32padupper:sd,base32hex:nd,base32hexupper:od,base32hexpad:ad,base32hexpadupper:cd,base32z:ud});const ld=Cr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),fd=Cr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var dd=Object.freeze({__proto__:null,base36:ld,base36upper:fd});const gd=Cr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),pd=Cr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var yd=Object.freeze({__proto__:null,base58btc:gd,base58flickr:pd});const bd=et({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),_d=et({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),wd=et({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),md=et({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Ed=Object.freeze({__proto__:null,base64:bd,base64pad:_d,base64url:wd,base64urlpad:md});const Uo=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),vd=Uo.reduce((t,e,r)=>(t[r]=e,t),[]),Dd=Uo.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Sd(t){return t.reduce((e,r)=>(e+=vd[r],e),"")}function xd(t){const e=[];for(const r of t){const i=Dd[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Id=ni({prefix:"🚀",name:"base256emoji",encode:Sd,decode:xd});var Od=Object.freeze({__proto__:null,base256emoji:Id}),Td=Lo,bn=128,Ad=127,Nd=~Ad,Cd=Math.pow(2,31);function Lo(t,e,r){e=e||[],r=r||0;for(var i=r;t>=Cd;)e[r++]=t&255|bn,t/=128;for(;t&Nd;)e[r++]=t&255|bn,t>>>=7;return e[r]=t|0,Lo.bytes=r-i+1,e}var Rd=Li,Pd=128,_n=127;function Li(t,i){var r=0,i=i||0,s=0,a=i,h,c=t.length;do{if(a>=c)throw Li.bytes=0,new RangeError("Could not decode varint");h=t[a++],r+=s<28?(h&_n)<<s:(h&_n)*Math.pow(2,s),s+=7}while(h>=Pd);return Li.bytes=a-i,r}var Fd=Math.pow(2,7),Ud=Math.pow(2,14),Ld=Math.pow(2,21),Md=Math.pow(2,28),$d=Math.pow(2,35),jd=Math.pow(2,42),Bd=Math.pow(2,49),zd=Math.pow(2,56),qd=Math.pow(2,63),Kd=function(t){return t<Fd?1:t<Ud?2:t<Ld?3:t<Md?4:t<$d?5:t<jd?6:t<Bd?7:t<zd?8:t<qd?9:10},Hd={encode:Td,decode:Rd,encodingLength:Kd},Mo=Hd;const wn=(t,e,r=0)=>(Mo.encode(t,e,r),e),mn=t=>Mo.encodingLength(t),Mi=(t,e)=>{const r=e.byteLength,i=mn(t),s=i+mn(r),a=new Uint8Array(s+r);return wn(t,a,0),wn(r,a,i),a.set(e,s),new Vd(t,r,e,a)};class Vd{constructor(e,r,i,s){this.code=e,this.size=r,this.digest=i,this.bytes=s}}const $o=({name:t,code:e,encode:r})=>new kd(t,e,r);class kd{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Mi(this.code,r):r.then(i=>Mi(this.code,i))}else throw Error("Unknown type, must be binary type")}}const jo=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Gd=$o({name:"sha2-256",code:18,encode:jo("SHA-256")}),Wd=$o({name:"sha2-512",code:19,encode:jo("SHA-512")});var Yd=Object.freeze({__proto__:null,sha256:Gd,sha512:Wd});const Bo=0,Jd="identity",zo=Po,Xd=t=>Mi(Bo,zo(t)),Qd={code:Bo,name:Jd,encode:zo,digest:Xd};var Zd=Object.freeze({__proto__:null,identity:Qd});new TextEncoder,new TextDecoder;const En={...Vf,...Gf,...Yf,...Xf,...ed,...hd,...dd,...yd,...Ed,...Od};({...Yd,...Zd});function qo(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function eg(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?qo(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Ko(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const vn=Ko("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),wi=Ko("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=eg(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),tg={utf8:vn,"utf-8":vn,hex:En.base16,latin1:wi,ascii:wi,binary:wi,...En};function rg(t,e="utf8"){const r=tg[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?qo(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}const Ho="wc",ig=2,is="core",Bt=`${Ho}@2:${is}:`,sg={name:is,logger:"error"},ng={database:":memory:"},og="crypto",Dn="client_ed25519_seed",ag=Q.ONE_DAY,cg="keychain",ug="0.3",hg="messages",lg="0.3",fg=Q.SIX_HOURS,dg="publisher",Vo="irn",gg="error",ko="wss://relay.walletconnect.com",Sn="wss://relay.walletconnect.org",pg="relayer",Pe={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},yg="_subscription",_r={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},bg=Q.ONE_SECOND/2,_g="2.9.2",wg=1e4,mg="0.3",Eg="WALLETCONNECT_CLIENT_ID",Ot={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},vg="subscription",Dg="0.3",Sg=Q.FIVE_SECONDS*1e3,xg="pairing",Ig="0.3",wr={wc_pairingDelete:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:0},res:{ttl:Q.ONE_DAY,prompt:!1,tag:0}}},It={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Og="history",Tg="0.3",Ag="expirer",yt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Ng="0.3",mi="verify-api",xn="https://verify.walletconnect.com";class Cg{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=cg,this.version=ug,this.initialized=!1,this.storagePrefix=Bt,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()},this.get=i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:a}=V("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(a)}return s},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=we.generateChildLogger(r,this.name)}get context(){return we.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,lo(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?fo(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Rg{constructor(e,r,i){this.core=e,this.logger=r,this.name=og,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=s=>(this.isInitialized(),this.keychain.has(s)),this.getClientId=async()=>{this.isInitialized();const s=await this.getClientSeed(),a=hn(s);return Io(a.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const s=hh();return this.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=async s=>{this.isInitialized();const a=await this.getClientSeed(),h=hn(a),c=Fi();return await cf(c,s,ag,h)},this.generateSharedKey=(s,a,h)=>{this.isInitialized();const c=this.getPrivateKey(s),u=lh(c,a);return this.setSymKey(u,h)},this.setSymKey=async(s,a)=>{this.isInitialized();const h=a||fh(s);return await this.keychain.set(h,s),h},this.deleteKeyPair=async s=>{this.isInitialized(),await this.keychain.del(s)},this.deleteSymKey=async s=>{this.isInitialized(),await this.keychain.del(s)},this.encode=async(s,a,h)=>{this.isInitialized();const c=uo(h),u=Ji(a);if($s(c)){const N=c.senderPublicKey,S=c.receiverPublicKey;s=await this.generateSharedKey(N,S)}const g=this.getSymKey(s),{type:b,senderPublicKey:x}=c;return gh({type:b,symKey:g,message:u,senderPublicKey:x})},this.decode=async(s,a,h)=>{this.isInitialized();const c=bh(a,h);if($s(c)){const u=c.receiverPublicKey,g=c.senderPublicKey;s=await this.generateSharedKey(u,g)}try{const u=this.getSymKey(s),g=ph({symKey:u,encoded:a});return vo(g)}catch(u){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(u)}},this.getPayloadType=s=>{const a=Hr(s);return Tr(a.type)},this.getPayloadSenderPublicKey=s=>{const a=Hr(s);return a.senderPublicKey?ot(a.senderPublicKey,nt):void 0},this.core=e,this.logger=we.generateChildLogger(r,this.name),this.keychain=i||new Cg(this.core,this.logger)}get context(){return we.getLoggerContext(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Dn)}catch{e=Fi(),await this.keychain.set(Dn,e)}return rg(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Pg extends Ml{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=hg,this.version=lg,this.initialized=!1,this.storagePrefix=Bt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,s)=>{this.isInitialized();const a=sr(s);let h=this.messages.get(i);return typeof h>"u"&&(h={}),typeof h[a]<"u"||(h[a]=s,this.messages.set(i,h),await this.persist()),a},this.get=i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s},this.has=(i,s)=>{this.isInitialized();const a=this.get(i),h=sr(s);return typeof a[h]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=we.generateChildLogger(e,this.name),this.core=r}get context(){return we.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,lo(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?fo(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Fg extends $l{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new _t.EventEmitter,this.name=dg,this.queue=new Map,this.publishTimeout=Q.toMiliseconds(Q.TEN_SECONDS),this.queueTimeout=Q.toMiliseconds(Q.FIVE_SECONDS),this.needsTransportRestart=!1,this.publish=async(i,s,a)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:a}});try{const h=(a==null?void 0:a.ttl)||fg,c=Ui(a),u=(a==null?void 0:a.prompt)||!1,g=(a==null?void 0:a.tag)||0,b=(a==null?void 0:a.id)||Zi().toString(),x={topic:i,message:s,opts:{ttl:h,relay:c,prompt:u,tag:g,id:b}},N=setTimeout(()=>this.queue.set(b,x),this.queueTimeout);try{await await Vr(this.rpcPublish(i,s,h,c,u,g,b),this.publishTimeout),clearTimeout(N),this.relayer.events.emit(Pe.publish,x)}catch{this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0;return}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:a}})}catch(h){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(h),h}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.relayer=e,this.logger=we.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return we.getLoggerContext(this.logger)}rpcPublish(e,r,i,s,a,h,c){var u,g,b,x;const N={method:Br(s.protocol).publish,params:{topic:e,message:r,ttl:i,prompt:a,tag:h},id:c};return st((u=N.params)==null?void 0:u.prompt)&&((g=N.params)==null||delete g.prompt),st((b=N.params)==null?void 0:b.tag)&&((x=N.params)==null||delete x.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:N}),this.relayer.request(N)}onPublish(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:r,message:i,opts:s}=e;await this.publish(r,i,s)})}registerEventListeners(){this.relayer.core.heartbeat.on(cr.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Pe.connection_stalled);return}this.checkQueue()}),this.relayer.on(Pe.message_ack,e=>{this.onPublish(e.id.toString())})}}class Ug{constructor(){this.map=new Map,this.set=(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const s=i.filter(a=>a!==r);if(!s.length){this.map.delete(e);return}this.map.set(e,s)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Lg=Object.defineProperty,Mg=Object.defineProperties,$g=Object.getOwnPropertyDescriptors,In=Object.getOwnPropertySymbols,jg=Object.prototype.hasOwnProperty,Bg=Object.prototype.propertyIsEnumerable,On=(t,e,r)=>e in t?Lg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,mr=(t,e)=>{for(var r in e||(e={}))jg.call(e,r)&&On(t,r,e[r]);if(In)for(var r of In(e))Bg.call(e,r)&&On(t,r,e[r]);return t},Ei=(t,e)=>Mg(t,$g(e));class zg extends zl{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new Ug,this.events=new _t.EventEmitter,this.name=vg,this.version=Dg,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Bt,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(i,s)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const a=Ui(s),h={topic:i,relay:a};this.pending.set(i,h);const c=await this.rpcSubscribe(i,a);return this.onSubscribe(c,h),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}}),c}catch(a){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(a),a}},this.unsubscribe=async(i,s)=>{await this.restartToComplete(),this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((s,a)=>{const h=new Q.Watch;h.start(this.pendingSubscriptionWatchLabel);const c=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(c),h.stop(this.pendingSubscriptionWatchLabel),s(!0)),h.elapsed(this.pendingSubscriptionWatchLabel)>=Sg&&(clearInterval(c),h.stop(this.pendingSubscriptionWatchLabel),a(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=we.generateChildLogger(r,this.name),this.clientId=""}get context(){return we.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const s=Ui(i);await this.rpcUnsubscribe(e,r,s);const a=Je("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,a),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,r){const i={method:Br(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await Vr(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Pe.connection_stalled)}return sr(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,i={method:Br(r.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{return await await Vr(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Pe.connection_stalled)}}rpcUnsubscribe(e,r,i){const s={method:Br(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,r){this.setSubscription(e,Ei(mr({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,mr({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r))}addSubscription(e,r){this.subscriptions.set(e,mr({},r)),this.topicMap.set(r.topic,e),this.events.emit(Ot.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(Ot.deleted,Ei(mr({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Ot.sync)}async reset(){if(this.cached.length){const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<e;r++){const i=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(Ot.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const r=await this.rpcBatchSubscribe(e);Ar(r)&&this.onBatchSubscribe(r.map((i,s)=>Ei(mr({},e[s]),{id:i})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach(r=>{e.push(r)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(cr.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Pe.connect,async()=>{await this.onConnect()}),this.relayer.on(Pe.disconnect,()=>{this.onDisconnect()}),this.events.on(Ot.created,async e=>{const r=Ot.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on(Ot.deleted,async e=>{const r=Ot.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),e())},this.pollingInterval)})}}var qg=Object.defineProperty,Tn=Object.getOwnPropertySymbols,Kg=Object.prototype.hasOwnProperty,Hg=Object.prototype.propertyIsEnumerable,An=(t,e,r)=>e in t?qg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Vg=(t,e)=>{for(var r in e||(e={}))Kg.call(e,r)&&An(t,r,e[r]);if(Tn)for(var r of Tn(e))Hg.call(e,r)&&An(t,r,e[r]);return t};class kg extends jl{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new _t.EventEmitter,this.name=pg,this.transportExplicitlyClosed=!1,this.initialized=!1,this.reconnecting=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(i){throw this.logger.debug("Failed to Publish Request"),this.logger.error(i),i}},this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?we.generateChildLogger(e.logger,this.name):we.pino(we.getDefaultLoggerOptions({level:e.logger||gg})),this.messages=new Pg(this.logger,e.core),this.subscriber=new zg(this,this.logger),this.publisher=new Fg(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||ko,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Sn}...`),await this.restartTransport(Sn)}this.registerEventListeners(),this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},wg)}get context(){return we.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now()})}async subscribe(e,r){var i;this.isInitialized();let s=((i=this.subscriber.topicMap.get(e))==null?void 0:i[0])||"";return s||(await Promise.all([new Promise(a=>{this.subscriber.once(Ot.created,h=>{h.topic===e&&a()})}),new Promise(async a=>{s=await this.subscriber.subscribe(e,r),a()})]),s)}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(Pe.transport_closed))}async transportOpen(e){if(this.transportExplicitlyClosed=!1,!this.reconnecting){this.relayUrl=e||this.relayUrl,this.reconnecting=!0;try{await Promise.all([new Promise(r=>{this.initialized||r(),this.subscriber.once(Ot.resubscribed,()=>{r()})}),await Promise.race([new Promise(async(r,i)=>{await Vr(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(s=>i(s)).then(()=>r()).finally(()=>this.removeListener(Pe.transport_closed,this.rejectTransportOpen))}),new Promise(r=>this.once(Pe.transport_closed,this.rejectTransportOpen))])])}catch(r){this.logger.error(r);const i=r;if(!this.isConnectionStalled(i.message))throw r;this.events.emit(Pe.transport_closed)}finally{this.reconnecting=!1}}}async restartTransport(e){this.transportExplicitlyClosed||this.reconnecting||(this.relayUrl=e||this.relayUrl,this.connected&&await Promise.all([new Promise(r=>{this.provider.once(_r.disconnect,()=>{r()})}),this.transportClose()]),await this.createProvider(),await this.transportOpen())}isConnectionStalled(e){return this.staleConnectionErrors.some(r=>e.includes(r))}rejectTransportOpen(){throw new Error("Attempt to connect to relay via `transportOpen` has stalled. Retrying...")}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Of(new Cf(Th({sdkVersion:_g,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:r,message:i}=e;await this.messages.set(r,i)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const s=this.messages.has(r,i);return s&&this.logger.debug(`Ignoring duplicate message: ${i}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),rs(e)){if(!e.method.endsWith(yg))return;const r=e.params,{topic:i,message:s,publishedAt:a}=r.data,h={topic:i,message:s,publishedAt:a};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Vg({type:"event",event:r.id},h)),this.events.emit(r.id,h),await this.acknowledgePayload(e),await this.onMessageEvent(h)}else si(e)&&this.events.emit(Pe.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(Pe.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=es(e.id,!0);await this.provider.connection.send(r)}registerProviderListeners(){this.provider.on(_r.payload,e=>this.onProviderPayload(e)),this.provider.on(_r.connect,()=>{this.events.emit(Pe.connect)}),this.provider.on(_r.disconnect,()=>{this.onProviderDisconnect()}),this.provider.on(_r.error,e=>{this.logger.error(e),this.events.emit(Pe.error,e)})}registerEventListeners(){this.events.on(Pe.connection_stalled,async()=>{await this.restartTransport()})}onProviderDisconnect(){this.events.emit(Pe.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.restartTransport()},Q.toMiliseconds(bg))}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(!this.connected){if(this.connecting)return await new Promise(e=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),e())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var Gg=Object.defineProperty,Nn=Object.getOwnPropertySymbols,Wg=Object.prototype.hasOwnProperty,Yg=Object.prototype.propertyIsEnumerable,Cn=(t,e,r)=>e in t?Gg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Rn=(t,e)=>{for(var r in e||(e={}))Wg.call(e,r)&&Cn(t,r,e[r]);if(Nn)for(var r of Nn(e))Yg.call(e,r)&&Cn(t,r,e[r]);return t};class oi extends Bl{constructor(e,r,i,s=Bt,a=void 0){super(e,r,i,s),this.core=e,this.logger=r,this.name=i,this.map=new Map,this.version=mg,this.cached=[],this.initialized=!1,this.storagePrefix=Bt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(h=>{this.getKey&&h!==null&&!st(h)?this.map.set(this.getKey(h),h):Qh(h)?this.map.set(h.id,h):Zh(h)&&this.map.set(h.topic,h)}),this.cached=[],this.initialized=!0)},this.set=async(h,c)=>{this.isInitialized(),this.map.has(h)?await this.update(h,c):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:h,value:c}),this.map.set(h,c),await this.persist())},this.get=h=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:h}),this.getData(h)),this.getAll=h=>(this.isInitialized(),h?this.values.filter(c=>Object.keys(h).every(u=>Yr(c[u],h[u]))):this.values),this.update=async(h,c)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:h,update:c});const u=Rn(Rn({},this.getData(h)),c);this.map.set(h,u),await this.persist()},this.delete=async(h,c)=>{this.isInitialized(),this.map.has(h)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:h,reason:c}),this.map.delete(h),await this.persist())},this.logger=we.generateChildLogger(r,this.name),this.storagePrefix=s,this.getKey=a}get context(){return we.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Jg{constructor(e,r){this.core=e,this.logger=r,this.name=xg,this.version=Ig,this.events=new _t,this.initialized=!1,this.storagePrefix=Bt,this.ignoredPayloadTypes=[Qt],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=Fi(),s=await this.core.crypto.setSymKey(i),a=vt(Q.FIVE_MINUTES),h={protocol:Vo},c={topic:s,expiry:a,relay:h,active:!1},u=zh({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:h});return await this.pairings.set(s,c),await this.core.relayer.subscribe(s),this.core.expirer.set(s,a),{topic:s,uri:u}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:s,symKey:a,relay:h}=$h(i.uri);if(this.pairings.keys.includes(s))throw new Error(`Pairing already exists: ${s}`);if(this.core.crypto.hasKeys(s))throw new Error(`Keychain already exists: ${s}`);const c=vt(Q.FIVE_MINUTES),u={topic:s,relay:h,expiry:c,active:!1};return await this.pairings.set(s,u),await this.core.crypto.setSymKey(a,s),await this.core.relayer.subscribe(s,{relay:h}),this.core.expirer.set(s,c),i.activatePairing&&await this.activate({topic:s}),u},this.activate=async({topic:i})=>{this.isInitialized();const s=vt(Q.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:s}),this.core.expirer.set(i,s)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:s}=i;if(this.pairings.keys.includes(s)){const a=await this.sendRequest(s,"wc_pairingPing",{}),{done:h,resolve:c,reject:u}=rr();this.events.once(Be("pairing_ping",a),({error:g})=>{g?u(g):c()}),await h()}},this.updateExpiry=async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})},this.updateMetadata=async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",Je("USER_DISCONNECTED")),await this.deletePairing(s))},this.sendRequest=async(i,s,a)=>{const h=ii(s,a),c=await this.core.crypto.encode(i,h),u=wr[s].req;return this.core.history.set(i,h),this.core.relayer.publish(i,c,u),h.id},this.sendResult=async(i,s,a)=>{const h=es(i,a),c=await this.core.crypto.encode(s,h),u=await this.core.history.get(s,i),g=wr[u.request.method].res;await this.core.relayer.publish(s,c,g),await this.core.history.resolve(h)},this.sendError=async(i,s,a)=>{const h=ts(i,a),c=await this.core.crypto.encode(s,h),u=await this.core.history.get(s,i),g=wr[u.request.method]?wr[u.request.method].res:wr.unregistered_method.res;await this.core.relayer.publish(s,c,g),await this.core.history.resolve(h)},this.deletePairing=async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,Je("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(s=>$t(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))},this.onRelayEventRequest=i=>{const{topic:s,payload:a}=i;switch(a.method){case"wc_pairingPing":return this.onPairingPingRequest(s,a);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,a);default:return this.onUnknownRpcMethodRequest(s,a)}},this.onRelayEventResponse=async i=>{const{topic:s,payload:a}=i,h=(await this.core.history.get(s,a.id)).request.method;switch(h){case"wc_pairingPing":return this.onPairingPingResponse(s,a);default:return this.onUnknownRpcMethodResponse(h)}},this.onPairingPingRequest=async(i,s)=>{const{id:a}=s;try{this.isValidPing({topic:i}),await this.sendResult(a,i,!0),this.events.emit("pairing_ping",{id:a,topic:i})}catch(h){await this.sendError(a,i,h),this.logger.error(h)}},this.onPairingPingResponse=(i,s)=>{const{id:a}=s;setTimeout(()=>{Pt(s)?this.events.emit(Be("pairing_ping",a),{}):Dt(s)&&this.events.emit(Be("pairing_ping",a),{error:s.error})},500)},this.onPairingDeleteRequest=async(i,s)=>{const{id:a}=s;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit("pairing_delete",{id:a,topic:i})}catch(h){await this.sendError(a,i,h),this.logger.error(h)}},this.onUnknownRpcMethodRequest=async(i,s)=>{const{id:a,method:h}=s;try{if(this.registeredMethods.includes(h))return;const c=Je("WC_METHOD_UNSUPPORTED",h);await this.sendError(a,i,c),this.logger.error(c)}catch(c){await this.sendError(a,i,c),this.logger.error(c)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(Je("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{if(!at(i)){const{message:s}=V("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(s)}if(!Xh(i.uri)){const{message:s}=V("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(s)}},this.isValidPing=async i=>{if(!at(i)){const{message:a}=V("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(a)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidDisconnect=async i=>{if(!at(i)){const{message:a}=V("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(a)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidPairingTopic=async i=>{if(!Xe(i,!1)){const{message:s}=V("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=V("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if($t(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=V("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}},this.core=e,this.logger=we.generateChildLogger(r,this.name),this.pairings=new oi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return we.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Pe.message,async e=>{const{topic:r,message:i}=e;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const s=await this.core.crypto.decode(r,i);try{rs(s)?(this.core.history.set(r,s),this.onRelayEventRequest({topic:r,payload:s})):si(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.core.history.delete(r,s.id))}catch(a){this.logger.error(a)}})}registerExpirerEvents(){this.core.expirer.on(yt.expired,async e=>{const{topic:r}=po(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit("pairing_expire",{topic:r}))})}}class Xg extends Ll{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new _t.EventEmitter,this.name=Og,this.version=Tg,this.cached=[],this.initialized=!1,this.storagePrefix=Bt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,s,a)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:a}),this.records.has(s.id))return;const h={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:a,expiry:vt(Q.THIRTY_DAYS)};this.records.set(h.id,h),this.events.emit(It.created,h)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=Dt(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.events.emit(It.updated,s))},this.get=async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s)),this.delete=(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(a=>{if(a.topic===i){if(typeof s<"u"&&a.id!==s)return;this.records.delete(a.id),this.events.emit(It.deleted,a)}})},this.exists=async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=we.generateChildLogger(r,this.name)}get context(){return we.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:ii(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(It.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(It.created,e=>{const r=It.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(It.updated,e=>{const r=It.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(It.deleted,e=>{const r=It.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.core.heartbeat.on(cr.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(e=>{Q.toMiliseconds(e.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${e.id}`),this.delete(e.topic,e.id))})}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Qg extends ql{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new _t.EventEmitter,this.name=Ag,this.version=Ng,this.cached=[],this.initialized=!1,this.storagePrefix=Bt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}},this.set=(i,s)=>{this.isInitialized();const a=this.formatTarget(i),h={target:a,expiry:s};this.expirations.set(a,h),this.checkExpiry(a,h),this.events.emit(yt.created,{target:a,expiration:h})},this.get=i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)},this.del=i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),a=this.getExpiration(s);this.expirations.delete(s),this.events.emit(yt.deleted,{target:s,expiration:a})}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=we.generateChildLogger(r,this.name)}get context(){return we.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Ah(e);if(typeof e=="number")return Nh(e);const{message:r}=V("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(yt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;Q.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(yt.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(cr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(yt.created,e=>{const r=yt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(yt.expired,e=>{const r=yt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(yt.deleted,e=>{const r=yt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Zg extends Kl{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,this.name=mi,this.initialized=!1,this.init=async i=>{ho()||!Gi()||(this.verifyUrl=(i==null?void 0:i.verifyUrl)||xn,await this.createIframe())},this.register=async i=>{var s;if(this.initialized||await this.init(),!!this.iframe)try{(s=this.iframe.contentWindow)==null||s.postMessage(i.attestationId,this.verifyUrl),this.logger.info(`postMessage sent: ${i.attestationId} ${this.verifyUrl}`)}catch{}},this.resolve=async i=>{var s;if(this.isDevEnv)return"";this.logger.info(`resolving attestation: ${i.attestationId}`);const a=this.startAbortTimer(Q.FIVE_SECONDS),h=await fetch(`${this.verifyUrl}/attestation/${i.attestationId}`,{signal:this.abortController.signal});return clearTimeout(a),h.status===200?(s=await h.json())==null?void 0:s.origin:""},this.createIframe=async()=>{try{await Promise.race([new Promise((i,s)=>{if(document.getElementById(mi))return i();const a=document.createElement("iframe");a.setAttribute("id",mi),a.setAttribute("src",`${this.verifyUrl}/${this.projectId}`),a.style.display="none",a.addEventListener("load",()=>{this.initialized=!0,i()}),a.addEventListener("error",h=>{s(h)}),document.body.append(a),this.iframe=a}),new Promise(i=>{setTimeout(()=>i("iframe load timeout"),Q.toMiliseconds(Q.ONE_SECOND/2))})])}catch(i){this.logger.error(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.error(i)}},this.logger=we.generateChildLogger(r,this.name),this.verifyUrl=xn,this.abortController=new AbortController,this.isDevEnv=ki()&&{}.IS_VITEST}get context(){return we.getLoggerContext(this.logger)}startAbortTimer(e){return setTimeout(()=>this.abortController.abort(),Q.toMiliseconds(e))}}var ep=Object.defineProperty,Pn=Object.getOwnPropertySymbols,tp=Object.prototype.hasOwnProperty,rp=Object.prototype.propertyIsEnumerable,Fn=(t,e,r)=>e in t?ep(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Un=(t,e)=>{for(var r in e||(e={}))tp.call(e,r)&&Fn(t,r,e[r]);if(Pn)for(var r of Pn(e))rp.call(e,r)&&Fn(t,r,e[r]);return t};class ss extends Ul{constructor(e){super(e),this.protocol=Ho,this.version=ig,this.name=is,this.events=new _t.EventEmitter,this.initialized=!1,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||ko;const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:we.pino(we.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||sg.logger}));this.logger=we.generateChildLogger(r,this.name),this.heartbeat=new cr.HeartBeat,this.crypto=new Rg(this,this.logger,e==null?void 0:e.keychain),this.history=new Xg(this,this.logger),this.expirer=new Qg(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Il(Un(Un({},ng),e==null?void 0:e.storageOptions)),this.relayer=new kg({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Jg(this,this.logger),this.verify=new Zg(this.projectId||"",this.logger)}static async init(e){const r=new ss(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(Eg,i),r}get context(){return we.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const ip=ss,Go="wc",Wo=2,Yo="client",ns=`${Go}@${Wo}:${Yo}:`,vi={name:Yo,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Ln="WALLETCONNECT_DEEPLINK_CHOICE",sp="proposal",np="Proposal expired",op="session",jr=Q.SEVEN_DAYS,ap="engine",Er={wc_sessionPropose:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1104},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1106},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1112},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1115}}},Di={min:Q.FIVE_MINUTES,max:Q.SEVEN_DAYS},vr={idle:"idle",active:"active"},cp="request",up=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var hp=Object.defineProperty,lp=Object.defineProperties,fp=Object.getOwnPropertyDescriptors,Mn=Object.getOwnPropertySymbols,dp=Object.prototype.hasOwnProperty,gp=Object.prototype.propertyIsEnumerable,$n=(t,e,r)=>e in t?hp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,pt=(t,e)=>{for(var r in e||(e={}))dp.call(e,r)&&$n(t,r,e[r]);if(Mn)for(var r of Mn(e))gp.call(e,r)&&$n(t,r,e[r]);return t},Si=(t,e)=>lp(t,fp(e));class pp extends Vl{constructor(e){super(e),this.name=ap,this.events=new _t,this.initialized=!1,this.ignoredPayloadTypes=[Qt],this.requestQueue={state:vr.idle,requests:[]},this.requestQueueDelay=Q.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(Er)}),this.initialized=!0,setTimeout(()=>{this.requestQueue.requests=this.getPendingSessionRequests(),this.processRequestQueue()},Q.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{this.isInitialized();const i=Si(pt({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(i);const{pairingTopic:s,requiredNamespaces:a,optionalNamespaces:h,sessionProperties:c,relays:u}=i;let g=s,b,x=!1;if(g&&(x=this.client.core.pairing.pairings.get(g).active),!g||!x){const{topic:D,uri:p}=await this.client.core.pairing.create();g=D,b=p}const N=await this.client.core.crypto.generateKeyPair(),S=pt({requiredNamespaces:a,optionalNamespaces:h,relays:u??[{protocol:Vo}],proposer:{publicKey:N,metadata:this.client.metadata}},c&&{sessionProperties:c}),{reject:I,resolve:C,done:R}=rr(Q.FIVE_MINUTES,np);if(this.events.once(Be("session_connect"),async({error:D,session:p})=>{if(D)I(D);else if(p){p.self.publicKey=N;const _=Si(pt({},p),{requiredNamespaces:p.requiredNamespaces,optionalNamespaces:p.optionalNamespaces});await this.client.session.set(p.topic,_),await this.setExpiry(p.topic,p.expiry),g&&await this.client.core.pairing.updateMetadata({topic:g,metadata:p.peer.metadata}),C(_)}}),!g){const{message:D}=V("NO_MATCHING_KEY",`connect() pairing topic: ${g}`);throw new Error(D)}const q=await this.sendRequest(g,"wc_sessionPropose",S),w=vt(Q.FIVE_MINUTES);return await this.setProposal(q,pt({id:q,expiry:w},S)),{uri:b,approval:R}},this.pair=async r=>(this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{this.isInitialized(),await this.isValidApprove(r);const{id:i,relayProtocol:s,namespaces:a,sessionProperties:h}=r,c=this.client.proposal.get(i);let{pairingTopic:u,proposer:g,requiredNamespaces:b,optionalNamespaces:x}=c;u=u||"",Dr(b)||(b=Vh(a,"approve()"));const N=await this.client.core.crypto.generateKeyPair(),S=g.publicKey,I=await this.client.core.crypto.generateSharedKey(N,S);u&&i&&(await this.client.core.pairing.updateMetadata({topic:u,metadata:g.metadata}),await this.sendResult(i,u,{relay:{protocol:s??"irn"},responderPublicKey:N}),await this.client.proposal.delete(i,Je("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:u}));const C=pt({relay:{protocol:s??"irn"},namespaces:a,requiredNamespaces:b,optionalNamespaces:x,pairingTopic:u,controller:{publicKey:N,metadata:this.client.metadata},expiry:vt(jr)},h&&{sessionProperties:h});await this.client.core.relayer.subscribe(I),await this.sendRequest(I,"wc_sessionSettle",C);const R=Si(pt({},C),{topic:I,pairingTopic:u,acknowledged:!1,self:C.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:N});return await this.client.session.set(I,R),await this.setExpiry(I,vt(jr)),{topic:I,acknowledged:()=>new Promise(q=>setTimeout(()=>q(this.client.session.get(I)),500))}},this.reject=async r=>{this.isInitialized(),await this.isValidReject(r);const{id:i,reason:s}=r,{pairingTopic:a}=this.client.proposal.get(i);a&&(await this.sendError(i,a,s),await this.client.proposal.delete(i,Je("USER_DISCONNECTED")))},this.update=async r=>{this.isInitialized(),await this.isValidUpdate(r);const{topic:i,namespaces:s}=r,a=await this.sendRequest(i,"wc_sessionUpdate",{namespaces:s}),{done:h,resolve:c,reject:u}=rr();return this.events.once(Be("session_update",a),({error:g})=>{g?u(g):c()}),await this.client.session.update(i,{namespaces:s}),{acknowledged:h}},this.extend=async r=>{this.isInitialized(),await this.isValidExtend(r);const{topic:i}=r,s=await this.sendRequest(i,"wc_sessionExtend",{}),{done:a,resolve:h,reject:c}=rr();return this.events.once(Be("session_extend",s),({error:u})=>{u?c(u):h()}),await this.setExpiry(i,vt(jr)),{acknowledged:a}},this.request=async r=>{this.isInitialized(),await this.isValidRequest(r);const{chainId:i,request:s,topic:a,expiry:h}=r,c=await this.sendRequest(a,"wc_sessionRequest",{request:s,chainId:i},h),{done:u,resolve:g,reject:b}=rr(h);this.events.once(Be("session_request",c),({error:N,result:S})=>{N?b(N):g(S)}),this.client.events.emit("session_request_sent",{topic:a,request:s,chainId:i,id:c});const x=await this.client.core.storage.getItem(Ln);return Ch({id:c,topic:a,wcDeepLink:x}),await u()},this.respond=async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:s}=r,{id:a}=s;Pt(s)?await this.sendResult(a,i,s.result):Dt(s)&&await this.sendError(a,i,s.error),this.cleanupAfterResponse(r)},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:i}=r;if(this.client.session.keys.includes(i)){const s=await this.sendRequest(i,"wc_sessionPing",{}),{done:a,resolve:h,reject:c}=rr();this.events.once(Be("session_ping",s),({error:u})=>{u?c(u):h()}),await a()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async r=>{this.isInitialized(),await this.isValidEmit(r);const{topic:i,event:s,chainId:a}=r;await this.sendRequest(i,"wc_sessionEvent",{event:s,chainId:a})},this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;if(this.client.session.keys.includes(i)){const s=Zi().toString();let a;const h=c=>{(c==null?void 0:c.id.toString())===s&&(this.client.core.relayer.events.removeListener(Pe.message_ack,h),a())};await Promise.all([new Promise(c=>{a=c,this.client.core.relayer.on(Pe.message_ack,h)}),this.sendRequest(i,"wc_sessionDelete",Je("USER_DISCONNECTED"),void 0,s)]),await this.deleteSession(i)}else await this.client.core.pairing.disconnect({topic:i})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(i=>Yh(i,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const i=this.client.core.pairing.pairings.get(r.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(a=>{var h,c;return((h=a.peerMetadata)==null?void 0:h.url)&&((c=a.peerMetadata)==null?void 0:c.url)===r.peer.metadata.url&&a.topic&&a.topic!==i.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(a=>this.client.core.pairing.disconnect({topic:a.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}},this.deleteSession=async(r,i)=>{const{self:s}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,Je("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(s.publicKey)&&await this.client.core.crypto.deleteKeyPair(s.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),i||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Ln).catch(a=>this.client.logger.warn(a))},this.deleteProposal=async(r,i)=>{await Promise.all([this.client.proposal.delete(r,Je("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),s?Promise.resolve():this.client.core.expirer.del(r)]),this.requestQueue.requests=this.requestQueue.requests.filter(a=>a.id!==r),s&&(this.requestQueue.state=vr.idle)},this.setExpiry=async(r,i)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:i}),this.client.core.expirer.set(r,i)},this.setProposal=async(r,i)=>{await this.client.proposal.set(r,i),this.client.core.expirer.set(r,i.expiry)},this.setPendingSessionRequest=async r=>{const i=Er.wc_sessionRequest.req.ttl,{id:s,topic:a,params:h}=r;await this.client.pendingRequest.set(s,{id:s,topic:a,params:h}),i&&this.client.core.expirer.set(s,vt(i))},this.sendRequest=async(r,i,s,a,h)=>{const c=ii(i,s);if(Gi()&&up.includes(i)){const b=sr(JSON.stringify(c));await this.client.core.verify.register({attestationId:b})}const u=await this.client.core.crypto.encode(r,c),g=Er[i].req;return a&&(g.ttl=a),h&&(g.id=h),this.client.core.history.set(r,c),this.client.core.relayer.publish(r,u,g),c.id},this.sendResult=async(r,i,s)=>{const a=es(r,s),h=await this.client.core.crypto.encode(i,a),c=await this.client.core.history.get(i,r),u=Er[c.request.method].res;this.client.core.relayer.publish(i,h,u),await this.client.core.history.resolve(a)},this.sendError=async(r,i,s)=>{const a=ts(r,s),h=await this.client.core.crypto.encode(i,a),c=await this.client.core.history.get(i,r),u=Er[c.request.method].res;this.client.core.relayer.publish(i,h,u),await this.client.core.history.resolve(a)},this.cleanup=async()=>{const r=[],i=[];this.client.session.getAll().forEach(s=>{$t(s.expiry)&&r.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{$t(s.expiry)&&i.push(s.id)}),await Promise.all([...r.map(s=>this.deleteSession(s)),...i.map(s=>this.deleteProposal(s))])},this.onRelayEventRequest=r=>{const{topic:i,payload:s}=r,a=s.method;switch(a){case"wc_sessionPropose":return this.onSessionProposeRequest(i,s);case"wc_sessionSettle":return this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return this.onSessionExtendRequest(i,s);case"wc_sessionPing":return this.onSessionPingRequest(i,s);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return this.onSessionRequest(i,s);case"wc_sessionEvent":return this.onSessionEventRequest(i,s);default:return this.client.logger.info(`Unsupported request method ${a}`)}},this.onRelayEventResponse=async r=>{const{topic:i,payload:s}=r,a=(await this.client.core.history.get(i,s.id)).request.method;switch(a){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${a}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:i}=r,{message:s}=V("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)},this.onSessionProposeRequest=async(r,i)=>{const{params:s,id:a}=i;try{this.isValidConnect(pt({},i.params));const h=vt(Q.FIVE_MINUTES),c=pt({id:a,pairingTopic:r,expiry:h},s);await this.setProposal(a,c);const u=sr(JSON.stringify(i)),g=await this.getVerifyContext(u,c.proposer.metadata);this.client.events.emit("session_proposal",{id:a,params:c,verifyContext:g})}catch(h){await this.sendError(a,r,h),this.client.logger.error(h)}},this.onSessionProposeResponse=async(r,i)=>{const{id:s}=i;if(Pt(i)){const{result:a}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:a});const h=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:h});const c=h.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const u=a.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:u});const g=await this.client.core.crypto.generateSharedKey(c,u);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:g});const b=await this.client.core.relayer.subscribe(g);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:b}),await this.client.core.pairing.activate({topic:r})}else Dt(i)&&(await this.client.proposal.delete(s,Je("USER_DISCONNECTED")),this.events.emit(Be("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(r,i)=>{const{id:s,params:a}=i;try{this.isValidSessionSettleRequest(a);const{relay:h,controller:c,expiry:u,namespaces:g,requiredNamespaces:b,optionalNamespaces:x,sessionProperties:N,pairingTopic:S}=i.params,I=pt({topic:r,relay:h,expiry:u,namespaces:g,acknowledged:!0,pairingTopic:S,requiredNamespaces:b,optionalNamespaces:x,controller:c.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:c.publicKey,metadata:c.metadata}},N&&{sessionProperties:N});await this.sendResult(i.id,r,!0),this.events.emit(Be("session_connect"),{session:I}),this.cleanupDuplicatePairings(I)}catch(h){await this.sendError(s,r,h),this.client.logger.error(h)}},this.onSessionSettleResponse=async(r,i)=>{const{id:s}=i;Pt(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Be("session_approve",s),{})):Dt(i)&&(await this.client.session.delete(r,Je("USER_DISCONNECTED")),this.events.emit(Be("session_approve",s),{error:i.error}))},this.onSessionUpdateRequest=async(r,i)=>{const{params:s,id:a}=i;try{this.isValidUpdate(pt({topic:r},s)),await this.client.session.update(r,{namespaces:s.namespaces}),await this.sendResult(a,r,!0),this.client.events.emit("session_update",{id:a,topic:r,params:s})}catch(h){await this.sendError(a,r,h),this.client.logger.error(h)}},this.onSessionUpdateResponse=(r,i)=>{const{id:s}=i;Pt(i)?this.events.emit(Be("session_update",s),{}):Dt(i)&&this.events.emit(Be("session_update",s),{error:i.error})},this.onSessionExtendRequest=async(r,i)=>{const{id:s}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,vt(jr)),await this.sendResult(s,r,!0),this.client.events.emit("session_extend",{id:s,topic:r})}catch(a){await this.sendError(s,r,a),this.client.logger.error(a)}},this.onSessionExtendResponse=(r,i)=>{const{id:s}=i;Pt(i)?this.events.emit(Be("session_extend",s),{}):Dt(i)&&this.events.emit(Be("session_extend",s),{error:i.error})},this.onSessionPingRequest=async(r,i)=>{const{id:s}=i;try{this.isValidPing({topic:r}),await this.sendResult(s,r,!0),this.client.events.emit("session_ping",{id:s,topic:r})}catch(a){await this.sendError(s,r,a),this.client.logger.error(a)}},this.onSessionPingResponse=(r,i)=>{const{id:s}=i;setTimeout(()=>{Pt(i)?this.events.emit(Be("session_ping",s),{}):Dt(i)&&this.events.emit(Be("session_ping",s),{error:i.error})},500)},this.onSessionDeleteRequest=async(r,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),await Promise.all([new Promise(a=>{this.client.core.relayer.once(Pe.publish,async()=>{a(await this.deleteSession(r))})}),this.sendResult(s,r,!0)]),this.client.events.emit("session_delete",{id:s,topic:r})}catch(a){this.client.logger.error(a)}},this.onSessionRequest=async(r,i)=>{const{id:s,params:a}=i;try{this.isValidRequest(pt({topic:r},a)),await this.setPendingSessionRequest({id:s,topic:r,params:a}),this.addRequestToQueue({id:s,topic:r,params:a}),await this.processRequestQueue()}catch(h){await this.sendError(s,r,h),this.client.logger.error(h)}},this.onSessionRequestResponse=(r,i)=>{const{id:s}=i;Pt(i)?this.events.emit(Be("session_request",s),{result:i.result}):Dt(i)&&this.events.emit(Be("session_request",s),{error:i.error})},this.onSessionEventRequest=async(r,i)=>{const{id:s,params:a}=i;try{this.isValidEmit(pt({topic:r},a)),this.client.events.emit("session_event",{id:s,topic:r,params:a})}catch(h){await this.sendError(s,r,h),this.client.logger.error(h)}},this.addRequestToQueue=r=>{this.requestQueue.requests.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.requestQueue.state=vr.idle,this.processRequestQueue()},Q.toMiliseconds(this.requestQueueDelay))},this.processRequestQueue=async()=>{if(this.requestQueue.state===vr.active){this.client.logger.info("session request queue is already active.");return}const r=this.requestQueue.requests[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{const{id:i,topic:s,params:a}=r,h=sr(JSON.stringify({id:i,params:a})),c=this.client.session.get(s),u=await this.getVerifyContext(h,c.peer.metadata);this.requestQueue.state=vr.active,this.client.events.emit("session_request",{id:i,topic:s,params:a,verifyContext:u})}catch(i){this.client.logger.error(i)}},this.isValidConnect=async r=>{if(!at(r)){const{message:u}=V("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(u)}const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:a,sessionProperties:h,relays:c}=r;if(st(i)||await this.isValidPairingTopic(i),!al(c,!0)){const{message:u}=V("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(u)}!st(s)&&Dr(s)!==0&&this.validateNamespaces(s,"requiredNamespaces"),!st(a)&&Dr(a)!==0&&this.validateNamespaces(a,"optionalNamespaces"),st(h)||this.validateSessionProps(h,"sessionProperties")},this.validateNamespaces=(r,i)=>{const s=ol(r,"connect()",i);if(s)throw new Error(s.message)},this.isValidApprove=async r=>{if(!at(r))throw new Error(V("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:s,relayProtocol:a,sessionProperties:h}=r;await this.isValidProposalId(i);const c=this.client.proposal.get(i),u=zr(s,"approve()");if(u)throw new Error(u.message);const g=ks(c.requiredNamespaces,s,"approve()");if(g)throw new Error(g.message);if(!Xe(a,!0)){const{message:b}=V("MISSING_OR_INVALID",`approve() relayProtocol: ${a}`);throw new Error(b)}st(h)||this.validateSessionProps(h,"sessionProperties")},this.isValidReject=async r=>{if(!at(r)){const{message:a}=V("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(a)}const{id:i,reason:s}=r;if(await this.isValidProposalId(i),!ul(s)){const{message:a}=V("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(a)}},this.isValidSessionSettleRequest=r=>{if(!at(r)){const{message:g}=V("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(g)}const{relay:i,controller:s,namespaces:a,expiry:h}=r;if(!bo(i)){const{message:g}=V("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(g)}const c=el(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);const u=zr(a,"onSessionSettleRequest()");if(u)throw new Error(u.message);if($t(h)){const{message:g}=V("EXPIRED","onSessionSettleRequest()");throw new Error(g)}},this.isValidUpdate=async r=>{if(!at(r)){const{message:u}=V("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(u)}const{topic:i,namespaces:s}=r;await this.isValidSessionTopic(i);const a=this.client.session.get(i),h=zr(s,"update()");if(h)throw new Error(h.message);const c=ks(a.requiredNamespaces,s,"update()");if(c)throw new Error(c.message)},this.isValidExtend=async r=>{if(!at(r)){const{message:s}=V("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionTopic(i)},this.isValidRequest=async r=>{if(!at(r)){const{message:u}=V("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(u)}const{topic:i,request:s,chainId:a,expiry:h}=r;await this.isValidSessionTopic(i);const{namespaces:c}=this.client.session.get(i);if(!Vs(c,a)){const{message:u}=V("MISSING_OR_INVALID",`request() chainId: ${a}`);throw new Error(u)}if(!hl(s)){const{message:u}=V("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(u)}if(!dl(c,a,s.method)){const{message:u}=V("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(u)}if(h&&!bl(h,Di)){const{message:u}=V("MISSING_OR_INVALID",`request() expiry: ${h}. Expiry must be a number (in seconds) between ${Di.min} and ${Di.max}`);throw new Error(u)}},this.isValidRespond=async r=>{if(!at(r)){const{message:a}=V("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(a)}const{topic:i,response:s}=r;if(await this.isValidSessionTopic(i),!ll(s)){const{message:a}=V("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(a)}},this.isValidPing=async r=>{if(!at(r)){const{message:s}=V("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async r=>{if(!at(r)){const{message:c}=V("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(c)}const{topic:i,event:s,chainId:a}=r;await this.isValidSessionTopic(i);const{namespaces:h}=this.client.session.get(i);if(!Vs(h,a)){const{message:c}=V("MISSING_OR_INVALID",`emit() chainId: ${a}`);throw new Error(c)}if(!fl(s)){const{message:c}=V("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(c)}if(!gl(h,a,s.name)){const{message:c}=V("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidDisconnect=async r=>{if(!at(r)){const{message:s}=V("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.getVerifyContext=async(r,i)=>{const s={verified:{verifyUrl:i.verifyUrl||"",validation:"UNKNOWN",origin:i.url||""}};try{const a=await this.client.core.verify.resolve({attestationId:r,verifyUrl:i.verifyUrl});a&&(s.verified.origin=a,s.verified.validation=a===i.url?"VALID":"INVALID")}catch(a){this.client.logger.error(a)}return this.client.logger.info(`Verify context: ${JSON.stringify(s)}`),s},this.validateSessionProps=(r,i)=>{Object.values(r).forEach(s=>{if(!Xe(s,!1)){const{message:a}=V("MISSING_OR_INVALID",`${i} must be in Record<string, string> format. Received: ${JSON.stringify(s)}`);throw new Error(a)}})}}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(Pe.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const s=await this.client.core.crypto.decode(r,i);try{rs(s)?(this.client.core.history.set(r,s),this.onRelayEventRequest({topic:r,payload:s})):si(s)?(await this.client.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.client.core.history.delete(r,s.id)):this.onRelayEventUnknownPayload({topic:r,payload:s})}catch(a){this.client.logger.error(a)}})}registerExpirerEvents(){this.client.core.expirer.on(yt.expired,async e=>{const{topic:r,id:i}=po(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,V("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}isValidPairingTopic(e){if(!Xe(e,!1)){const{message:r}=V("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=V("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if($t(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=V("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!Xe(e,!1)){const{message:r}=V("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(!this.client.session.keys.includes(e)){const{message:r}=V("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if($t(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:r}=V("EXPIRED",`session topic: ${e}`);throw new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Xe(e,!1)){const{message:r}=V("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=V("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!cl(e)){const{message:r}=V("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=V("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if($t(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:r}=V("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class yp extends oi{constructor(e,r){super(e,r,sp,ns),this.core=e,this.logger=r}}class bp extends oi{constructor(e,r){super(e,r,op,ns),this.core=e,this.logger=r}}class _p extends oi{constructor(e,r){super(e,r,cp,ns,i=>i.id),this.core=e,this.logger=r}}class Jo extends Hl{constructor(e){super(e),this.protocol=Go,this.version=Wo,this.name=vi.name,this.events=new _t.EventEmitter,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(s){throw this.logger.error(s.message),s}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(s){throw this.logger.error(s.message),s}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(s){throw this.logger.error(s.message),s}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(s){throw this.logger.error(s.message),s}},this.update=async i=>{try{return await this.engine.update(i)}catch(s){throw this.logger.error(s.message),s}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(s){throw this.logger.error(s.message),s}},this.request=async i=>{try{return await this.engine.request(i)}catch(s){throw this.logger.error(s.message),s}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(s){throw this.logger.error(s.message),s}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(s){throw this.logger.error(s.message),s}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(s){throw this.logger.error(s.message),s}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(s){throw this.logger.error(s.message),s}},this.find=i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=(e==null?void 0:e.name)||vi.name,this.metadata=(e==null?void 0:e.metadata)||Sh();const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:we.pino(we.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||vi.logger}));this.core=(e==null?void 0:e.core)||new ip(e),this.logger=we.generateChildLogger(r,this.name),this.session=new bp(this.core,this.logger),this.proposal=new yp(this.core,this.logger),this.pendingRequest=new _p(this.core,this.logger),this.engine=new pp(this)}static async init(e){const r=new Jo(e);return await r.initialize(),r}get context(){return we.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}export{Je as A,Ar as C,Dr as H,Of as J,Op as O,Tp as S,Jo as U,Ip as W,Ap as Z,vo as a,we as c,ts as f,Pp as i,yf as p,np as r,Ji as s,kh as t};
//# sourceMappingURL=index.es-5c6a5a23.js.map
