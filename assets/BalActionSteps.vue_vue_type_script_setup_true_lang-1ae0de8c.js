import{_ as se}from"./BalStack.vue_vue_type_script_lang-b46da6b4.js";import{aA as ae,aq as oe,ao as re,au as le,bN as ce,aw as ue}from"./BalBtn-a3a093af.js";import{_ as de}from"./BalTooltip.vue_vue_type_style_index_0_lang-b52dcfa5.js";import{g as fe,_ as pe}from"./wallet-logos-eb0836bb.js";import{d as z,r as C,o as me,p as P,n as ge,b as r,c as k,l as w,x as p,e as _e,f as b,q as v,F as U,i as ve,B as j,h as L,y as D,D as s,A as N,am as be,E as ye}from"./runtime-core.esm-bundler-24a2b16f.js";import{_ as X}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as he}from"./BalAlert-48dfe2e8.js";import{a as A}from"./anime.es-de4e5aa0.js";import{w as xe,x as Ae}from"./useTransactions-19512b92.js";import{u as ke,c as we}from"./errors-e4e66976.js";const Be=z({props:{initial:{type:Object,default:()=>({opacity:0})},animate:{type:Object,default:()=>({opacity:1})},exit:{type:Object,default:()=>({opacity:0})},unmountInstantly:{type:Boolean,default:()=>!1},isVisible:{type:Boolean,default:()=>!0}},emits:["on-exit","update-dimensions","on-presence"],setup(e,{emit:c}){const i=C();return me(()=>{i.value&&A.set(i.value,{...e.initial})}),P(()=>e.isVisible,async()=>{e.isVisible&&(await ge(),i.value&&A.set(i.value,{...e.initial}))}),{animateContainer:i,enter:async(m,a)=>{c("on-presence",{isCompleted:!1}),setTimeout(()=>{A({targets:m,...e.animate,easing:"spring(0.2, 80, 10, 0)",complete:()=>{a(),c("on-presence",{isCompleted:!0})}})},0),setTimeout(()=>{i.value&&c("update-dimensions",{width:i.value.offsetWidth,height:i.value.offsetHeight})},0)},leave:(m,a)=>{e.unmountInstantly&&(a(),c("on-exit",{isCompleted:!0})),A.set(m,{"pointer-events":"none"}),A({targets:m,...e.exit,easing:"spring(0.2, 80, 10, 0)",complete:()=>{a(),c("on-exit",{isCompleted:!0})}})}}}}),Ce={key:0,id:"animateContainer",ref:"animateContainer"};function Le(e,c,i,y,f,m){return r(),k(ae,{class:"relative",appear:"",css:!1,onEnter:e.enter,onLeave:e.leave},{default:w(()=>[e.isVisible?(r(),p("div",Ce,[_e(e.$slots,"default")],512)):b("",!0)]),_:3},8,["onEnter","onLeave"])}const Te=X(Be,[["render",Le]]);var o=(e=>(e[e.Todo=0]="Todo",e[e.Active=1]="Active",e[e.WalletOpen=2]="WalletOpen",e[e.Pending=3]="Pending",e[e.Success=4]="Success",e[e.Warning=5]="Warning",e[e.Error=6]="Error",e[e.Completed=7]="Completed",e))(o||{});const We={class:"flex items-center"},$e=["src"],Ee={class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},Ve={key:3},Oe=z({__name:"BalHorizSteps",props:{steps:{default:()=>[{tooltip:"You did this",state:o.Success},{tooltip:"Wallet is tiggered",state:o.WalletOpen},{tooltip:"This is pending",state:o.Pending},{tooltip:"Do this now",state:o.Active},{tooltip:"Do this next",state:o.Todo}]},spacerWidth:{default:16}},setup(e){const c=o,{connector:i,provider:y}=oe(),f=v(()=>{var a;return fe((a=i==null?void 0:i.value)==null?void 0:a.id,y)});function m(a){switch(a){case o.Success:return"border-lime-500 dark:border-lime-500 text-lime-500";case o.Pending:return"border-none dark:border-none text-orange-500";case o.Active:return"border-purple-500 dark:border-purple-500 text-gradient";case o.WalletOpen:return"border-purple-500 dark:border-purple-500 text-gradient";default:return"dark:border-gray-700"}}return(a,F)=>{const T=re,W=pe,$=de;return r(),p("div",We,[(r(!0),p(U,null,ve(e.steps,(g,u)=>(r(),p("div",{key:u,class:"flex items-center"},[u!==0?(r(),p("div",{key:0,class:j(["h-px bg-gray-100 dark:bg-gray-700",`w-${e.spacerWidth}`])},null,2)):b("",!0),L($,{text:g.tooltip,width:"44",textAlign:"center"},{activator:w(()=>[D("div",{class:j(["step",m(g.state)])},[g.state===s(c).Success?(r(),k(T,{key:0,name:"check"})):g.state===s(c).WalletOpen?(r(),p("img",{key:1,src:s(f),class:"w-4 h-4"},null,8,$e)):g.state===s(c).Pending?(r(),p(U,{key:2},[D("span",Ee,N(u+1),1),L(W,{class:"w-8 h-8 animate-spin"})],64)):(r(),p("span",Ve,N(u+1),1))],2)]),_:2},1032,["text"])]))),128))])}}});const Pe=X(Oe,[["__scopeId","data-v-1e7eed49"]]),je="/assets/signature-06cd4de7.svg",De=["src"],Ne={key:1,class:"w-8"},Ke=z({__name:"BalActionSteps",props:{actions:null,primaryActionType:null,disabled:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},loadingLabel:{default:""}},emits:["success","failed","setCurrentActionIndex"],setup(e,{emit:c}){const i=e,y={init:!1,confirming:!1,confirmed:!1,confirmedAt:""},f=C(0),m=C(i.actions),a=C([]);be(()=>{a.value=i.actions.map(()=>({...y}))}),P(()=>i.actions,n=>{n.forEach((t,l)=>{m.value[l]=t,a.value[l]||(a.value[l]={...y})})},{deep:!0}),P(()=>f.value,n=>{c("setCurrentActionIndex",n)},{immediate:!0});const{txListener:F,getTxConfirmedAt:T}=xe(),{formatErrorMsg:W}=ke(),{t:$}=le(),g=v(()=>m.value.map((n,t)=>{const l=a.value[t];return{label:n.label,loadingLabel:l.init?n.loadingLabel:n.confirmingLabel,pending:l.init||l.confirming,isSignAction:n.isSignAction,promise:ne.bind(null,n,l),step:{tooltip:n.stepTooltip,state:ee(l,t)}}})),u=v(()=>g.value[f.value]),E=v(()=>a.value[f.value]),H=v(()=>a.value[a.value.length-1]),I=v(()=>g.value.map(n=>n.step)),Z=v(()=>13-I.value.length),S=v(()=>{var n;return(n=u.value)!=null&&n.pending?u.value.loadingLabel:i.loadingLabel||$("Loading")});function ee(n,t){return f.value<t?o.Todo:n.confirming?o.Pending:n.init?o.WalletOpen:n.confirmed?o.Success:o.Active}async function ne(n,t){var _;const{action:l}=n;try{t.init=!0,t.error=null;const d=await l();if(t.init=!1,t.confirming=!0,(_=u.value)!=null&&_.isSignAction){te(t);return}d&&ie(d,t,n)}catch(d){t.init=!1,t.confirming=!1,t.error=W(d),we({error:(d==null?void 0:d.cause)||d,action:i.primaryActionType,context:{level:"fatal"}})}}function te(n){f.value+=1,n.confirming=!1,n.confirmed=!0}async function ie(n,t,l){const{postActionValidation:_,actionInvalidReason:d}=l;await F(n,{onTxConfirmed:async h=>{if(t.receipt=h,await Ae(n),await(_==null?void 0:_())||!_){const B=await T(h);t.confirmedAt=ce(B),t.confirmed=!0,f.value>=g.value.length-1?c("success",h,t.confirmedAt):f.value+=1}else d&&(t.error=d),t.init=!1;t.confirming=!1},onTxFailed:()=>{t.confirming=!1,c("failed")}})}return(n,t)=>{const l=he,_=Pe,d=ue,h=se;return r(),p("div",null,[L(Te,{isVisible:""},{default:w(()=>{var V,B,M,q,R;return[(V=s(E))!=null&&V.error&&!e.isLoading?(r(),k(l,{key:0,type:"error",title:(M=(B=s(E))==null?void 0:B.error)==null?void 0:M.title,description:(R=(q=s(E))==null?void 0:q.error)==null?void 0:R.description,block:"",class:"mb-4"},null,8,["title","description"])):b("",!0),L(h,{vertical:""},{default:w(()=>{var Y,G,J;return[s(g).length>1&&!((Y=s(H))!=null&&Y.confirmed)?(r(),k(_,{key:0,steps:s(I),spacerWidth:s(Z),class:"flex justify-center"},null,8,["steps","spacerWidth"])):b("",!0),(G=s(H))!=null&&G.confirmed?b("",!0):(r(),k(d,{key:1,disabled:i.disabled,color:"gradient",loading:((J=s(u))==null?void 0:J.pending)||e.isLoading,loadingLabel:s(S),block:"",onClick:t[0]||(t[0]=O=>{var x;return(x=s(u))==null?void 0:x.promise()})},{default:w(()=>{var O,x,K,Q;return[D("div",{class:j({"flex grow justify-between items-center":(O=s(u))==null?void 0:O.isSignAction})},[(x=s(u))!=null&&x.isSignAction?(r(),p("img",{key:0,src:s(je)},null,8,De)):b("",!0),ye(" "+N((K=s(u))==null?void 0:K.label)+" ",1),(Q=s(u))!=null&&Q.isSignAction?(r(),p("div",Ne)):b("",!0)],2)]}),_:1},8,["disabled","loading","loadingLabel"]))]}),_:1})]}),_:1})])}}});export{Te as A,o as S,Ke as _};
//# sourceMappingURL=BalActionSteps.vue_vue_type_script_setup_true_lang-1ae0de8c.js.map
