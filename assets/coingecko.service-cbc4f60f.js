var G=Object.defineProperty;var Y=(a,t,e)=>t in a?G(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var v=(a,t,e)=>(Y(a,typeof t!="symbol"?t+"":t,e),e);import{_ as W}from"./BalLoadingBlock.vue_vue_type_style_index_0_lang-24e44890.js";import{S as T,Z as X,c as K,W as Z,V as R,o as U,R as J}from"./connector-d867b6ec.js";import{n as $}from"./numeral-77821a11.js";import{i as Q,S as _}from"./echarts-39b4b08d.js";import{u as ee}from"./useDarkMode-2a25fc5b.js";import{aR as te,bE as F,aO as ae,bM as re}from"./BalBtn-a3a093af.js";import{u as se}from"./useTailwind-d0408df9.js";import{d as q,r as V,q as N,p as z,o as oe,b as w,c as ne,x as C,B as k,y as S,A as f,E,f as A,F as j,D as h,h as ie,C as le,e as ce}from"./runtime-core.esm-bundler-24a2b16f.js";import{r as ue}from"./promise-5e82c3ab.js";import{r as P,f as D}from"./tailwind.config-93ced0cc.js";import{t as he}from"./index-4d33cff6.js";function me(a){P(1,arguments);var t=he(a);return D(t*1e3)}function de(a){P(1,arguments);var t=D(a),e=t.getTime();return e}function fe(a){return P(1,arguments),Math.floor(de(a)/1e3)}function pe(a){P(1,arguments);var t=D(a);return t.setMinutes(0,0,0),t}const ye={key:0,class:"pb-3"},ge={class:"text-white"},ve=S("span",{class:"font-normal text-white"},"1",-1),xe={class:"font-normal text-white"},be={class:"font-normal text-white"},He=q({__name:"BalChart",props:{data:null,chartType:null,onAxisMoved:null,isLoading:{type:Boolean,default:!1},hideYAxis:{type:Boolean,default:!1},hideXAxis:{type:Boolean,default:!1},xAxisMinInterval:null,showHeader:{type:Boolean,default:!1},needChartValue:{type:Boolean,default:!1},axisLabelFormatter:{default:()=>({})},color:null,hoverColor:null,hoverBorderColor:null,height:null,showLegend:{type:Boolean,default:!1},legendState:null,forceResizeTick:null,isLastValueChipVisible:{type:Boolean},customGrid:null,chartClass:null,wrapperClass:null,showTooltip:{type:Boolean,default:!0},showTooltipLayer:{type:Boolean,default:!0},useMinMax:{type:Boolean,default:!1},areaStyle:null,inputSym:null,outputSym:null,timespan:null,landing:{type:Boolean,default:!1}},emits:["periodSelected","setCurrentChartValue","mouseLeaveEvent","mouseEnterEvent"],setup(a,{emit:t}){const e=a;Q();const l=V(),p=V("$0,00"),o=V(0),m=V(0),{fNum:i}=te(),n=se(),{darkMode:c}=ee(),x=N(()=>({legend:{show:e.showLegend,left:0,top:0,icon:"roundRect",itemHeight:5,formatter:r=>{var u;const s=T.last((u=e.data.find(y=>y.name===r))==null?void 0:u.values);return`${r}: ${i(s[1],e.axisLabelFormatter.yAxis)}`},selected:e.legendState||{},textStyle:{color:c.value?n.theme.colors.gray[100]:n.theme.colors.gray[800]},inactiveColor:c.value?n.theme.colors.gray[700]:n.theme.colors.gray[300]},xAxis:{type:"time",show:!e.hideXAxis,axisTick:{show:!1},axisLine:{show:!1},minInterval:e.xAxisMinInterval,axisLabel:{formatter:e.axisLabelFormatter.xAxis?r=>i(r,e.axisLabelFormatter.xAxis):void 0,color:n.theme.colors.gray[400]},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.3)","rgba(200,200,200,0.3)"]}}},yAxis:{axisLine:{show:!1},axisTick:{show:!1},min:e.useMinMax?"dataMin":null,max:e.useMinMax?"dataMax":null,type:"value",show:!e.hideYAxis,splitNumber:4,splitLine:{show:!1},position:"left",axisLabel:{show:!e.hideYAxis,formatter:e.axisLabelFormatter.yAxis?r=>i(r,e.axisLabelFormatter.yAxis):void 0,color:n.theme.colors.gray[400]},nameGap:25},color:e.color,grid:e.customGrid||{left:"2.5%",right:0,top:"10%",bottom:"5%",containLabel:!0},tooltip:{show:e.showTooltip,showContent:e.showTooltipLayer,trigger:"axis",confine:!0,axisPointer:{type:"shadow",label:{show:!1}},backgroundColor:c.value?n.theme.colors.gray[800]:n.theme.colors.white,borderColor:c.value?n.theme.colors.gray[900]:n.theme.colors.white,formatter:r=>`
            <div class='flex flex-col font-body bg-white dark:bg-gray-850 dark:text-white'>
              <span>${r[0].value[0]}</span>
              ${r.map(s=>`
                    <span>
                      ${s.marker} ${s.seriesName}
                      <span class='font-semibold'>
                        ${i(s.value[1],e.axisLabelFormatter.yAxis)}
                      </span>
                    </span>
                  `).join("")}
            </div>
          `},series:e.data.map((r,s)=>{var u,y;return{data:r.values,type:e.chartType,smooth:.3,showSymbol:!1,name:r.name,silent:!0,animationEasing:function(M){return M===1?1:1-Math.pow(2,-10*M)},lineStyle:{width:2},areaStyle:e.areaStyle,itemStyle:{borderRadius:100},emphasis:{itemStyle:{color:e.hoverColor,borderColor:e.hoverBorderColor}},markLine:{symbol:"roundRect",symbolSize:0,lineStyle:{color:"rgba(0, 0, 0, 0)"},precision:5,label:{backgroundColor:(e.color||[])[s]||"black",borderRadius:3,padding:4,formatter:M=>i(M.data.yAxis,e.axisLabelFormatter.yAxis),color:"#FFF",fontSize:10},data:e.isLastValueChipVisible?[{name:"Latest",yAxis:((u=e.data[s])==null?void 0:u.values.length)>0?(T.last((y=e.data[s])==null?void 0:y.values)||[])[1]:0}]:[],animation:!1}}})})),g=N(()=>{let r={};return e.height&&typeof e.height=="number"&&(r.height=`${e.height}px`),r});z(()=>e.forceResizeTick,()=>{l.value&&l.value.resize()});function d(r){const s=$((e.data[0].values[e.data[0].values.length-1]||[])[1]);if(r){p.value=i(s.value()||0,e.axisLabelFormatter.yAxis||{style:"currency",currency:"USD",fixedFormat:!0});const y=e.data[0].values[0];y&&t("setCurrentChartValue",{chartDate:y[0],chartValue:y[1]})}const u=$((e.data[0].values[0]||[])[1]);o.value=((s.value()||0)-(u.value()||0))/(u.value()||0),m.value=0}z(()=>e.data,()=>{d(!0)}),oe(()=>{d(!0)});function b(){d(!0),t("mouseLeaveEvent")}function O(){t("mouseEnterEvent")}const I=({dataIndex:r,seriesIndex:s})=>{var u;if(!(!e.showHeader&&!e.needChartValue)&&(u=e.data[s])!=null&&u.values){e.onAxisMoved&&e.onAxisMoved(e.data[s].values[r]);const y=e.data[s].values[r];t("setCurrentChartValue",{chartDate:y[0],chartValue:y[1]});const M=X(e.data[s].values[r][1]).toFixed(6);if(p.value=i(M,e.axisLabelFormatter.yAxis||{style:"currency",currency:"USD",fixedFormat:!0}),r===0){m.value=0;const L=Number(e.data[s].values[0][1]),B=e.data[s].values[e.data[s].values.length-1][1];o.value=(B-L)/L}else{m.value=1;const L=e.data[s].values[r-1][1],B=e.data[s].values[r][1],H=(B-L)/L;if(L===0&&B!==0){o.value=1;return}if(isNaN(H)){o.value=0;return}o.value=H}}};return(r,s)=>{const u=W;return a.isLoading?(w(),ne(u,{key:0,class:"mt-16 h-96"})):(w(),C("div",{key:1,class:k(a.wrapperClass),onMouseenter:O,onTouchstartPassive:O,onMouseleave:b,onTouchend:b},[a.showHeader?(w(),C("div",{key:0,id:"lineChartHeader",class:k(["mb-4",{"px-10":a.landing}])},[a.landing?(w(),C("div",ye,[S("h2",ge,f(r.$t("landing.infoCard.featured.title")),1),E(" "+f(a.inputSym)+" / "+f(a.outputSym),1)])):A("",!0),S("h3",{class:k(["text-xl font-light tracking-wider text-gray-800 dark:text-gray-400 truncate",{hidden:a.landing,"sm:block":a.landing}])},[a.inputSym?(w(),C(j,{key:0},[ve,E(" "+f(a.inputSym)+" = ",1),S("span",xe,f(h(p)),1),E(" "+f(a.outputSym),1)],64)):A("",!0),a.inputSym?A("",!0):(w(),C(j,{key:1},[S("div",null,f(e.data[0].name),1),S("span",be,f(h(p)),1)],64))],2),S("span",{class:k({"text-lime-400":h(o)>=0,"text-red-400":h(o)<0,"font-regular":!0,"rounded-md":!0,"py-0.5":!0,"px-1":!0,"bg-lime-200":h(o)>=0,"bg-red-200":h(o)<0,"bg-opacity-10":!0})},f(h($)(h(o)).format("+0.0%")),3),a.timespan?(w(),C("span",{key:1,id:"timespanText",class:k({"pl-2":!0,"text-sm":!0,"font-light":!0,"text-gray-200":!0,hidden:h(m)>0})},f(r.$t("inThePast"))+" "+f(a.timespan),3)):A("",!0)],2)):A("",!0),ie(h(_),{ref_key:"chartInstance",ref:l,class:k([a.height&&typeof(a.height==="string")?`h-${a.height}`:"","w-full",a.chartClass,a.landing?"pr-10 lg:pr-0":""]),option:h(x),autoresize:"",updateOptions:{replaceMerge:"series"},style:le([h(g)]),onUpdateAxisPointer:I},null,8,["class","option","style"])],34))}}}),Re=q({__name:"BalBlankSlate",props:{align:{default:"start"}},setup(a){const t=a,e=N(()=>({"items-start":t.align==="start","items-center":t.align==="center","items-end":t.align==="end"}));return(l,p)=>(w(),C("div",{class:k(["bal-blank-slate text-secondary",h(e)])},[ce(l.$slots,"default",{textContent:f(l.$t("noContent"))})],2))}});class we{constructor(t,e=K){v(this,"client");v(this,"fiatParam");v(this,"appNetwork");v(this,"platformId");this.configService=e,this.client=t.client,this.fiatParam=t.supportedFiat,this.appNetwork=this.configService.network.key,this.platformId=Se(this.appNetwork)}async getTokensHistorical(t,e,l=1,p="day"){try{if(t.length/l>10)throw new Error("To many requests for rate limit.");const o=Math.floor(Date.now()/1e3),m=p==="hour"?o+1*F-o%F:o-o%F,i=m-e*F;t=t.map(Z).map(g=>this.addressMapIn(g));const n=[];t.forEach(g=>{const d=`/coins/${this.platformId}/contract/${g.toLowerCase()}/market_chart/range?vs_currency=${this.fiatParam}&from=${i}&to=${m}`,b=ue(this.client.get(d),2,2e3);n.push(b)});const c=await Promise.all(n);return this.parseHistoricalPrices(c,t,i,p)}catch(o){throw console.error("Unable to fetch token prices",t,o),o}}parseHistoricalPrices(t,e,l,p="day"){const o=Object.fromEntries(e.map((i,n)=>{i=this.addressMapOut(i);const c=t[n].prices,x={};if(p==="hour"){const g=T.groupBy(c,d=>fe(pe(me(d[0]/1e3))));for(const d of Object.keys(g)){const b=(T.last(g[d])||[])[1]||0;x[Number(d)*1e3]=b}}else if(p==="day")for(const g in c){const[d,b]=c[g];x[d]=b}return[i,x]})),m={};for(const i in o){const n=o[i];for(const c in n){const x=n[c];c in m||(m[c]=[]),m[c].push(x)}}return m}addressMapIn(t){var l;const e=(l=R)==null?void 0:l.PriceChainMap;return e?U(e[t.toLowerCase()]||t):t}addressMapOut(t){var l;const e=(l=R)==null?void 0:l.PriceChainMap;return e?U(T.invert(e)[t.toLowerCase()]||t):t}}class Ce{constructor(){v(this,"baseUrl");v(this,"dataCache",{});this.baseUrl="https://api.coingecko.com/api/v3"}async get(t){if(!this.dataCache[t]){const{data:e}=await ae.get(this.baseUrl+t);return this.dataCache[t]=e,e}return this.dataCache[t]}}const ke=new Ce,Se=a=>Object.fromEntries(Object.values(J).map(e=>[e.chainId.toString(),e.thirdParty.coingecko.platformId]))[a]||"ethereum";class Me{constructor(t=ke,e=we){v(this,"supportedFiat");v(this,"prices");this.client=t,this.supportedFiat=re.join(","),this.prices=new e(this)}}const Ue=new Me;export{Re as _,He as a,Ue as c,me as f};
//# sourceMappingURL=coingecko.service-cbc4f60f.js.map
