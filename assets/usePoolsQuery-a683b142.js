import{u as C,S as I,c as K,a8 as $,Z as B}from"./connector-d867b6ec.js";import{bG as T,bH as F,av as Y,aY as V}from"./BalBtn-a3a093af.js";import{g as G,i as L,c as Q,b as H,P as U,p as _}from"./api-069228f5.js";import{t as D}from"./index-c7e2fe85.js";import{p as Z,r as J}from"./runtime-core.esm-bundler-24a2b16f.js";function E(){return{onFetch:a=>{a.fetchFn=()=>{var r,e,o,y,w,p;const l=(r=a.fetchOptions)==null||(e=r.meta)==null?void 0:e.refetchPage,g=(o=a.fetchOptions)==null||(y=o.meta)==null?void 0:y.fetchMore,f=g==null?void 0:g.pageParam,b=(g==null?void 0:g.direction)==="forward",N=(g==null?void 0:g.direction)==="backward",P=((w=a.state.data)==null?void 0:w.pages)||[],v=((p=a.state.data)==null?void 0:p.pageParams)||[];let m=v,x=!1;const R=t=>{Object.defineProperty(t,"signal",{enumerable:!0,get:()=>{var i;if((i=a.signal)!=null&&i.aborted)x=!0;else{var h;(h=a.signal)==null||h.addEventListener("abort",()=>{x=!0})}return a.signal}})},s=a.options.queryFn||(()=>Promise.reject("Missing queryFn")),n=(t,i,h,k)=>(m=k?[i,...m]:[...m,i],k?[h,...t]:[...t,h]),u=(t,i,h,k)=>{if(x)return Promise.reject("Cancelled");if(typeof h>"u"&&!i&&t.length)return Promise.resolve(t);const A={queryKey:a.queryKey,pageParam:h,meta:a.options.meta};R(A);const M=s(A);return Promise.resolve(M).then(z=>n(t,h,z,k))};let c;if(!P.length)c=u([]);else if(b){const t=typeof f<"u",i=t?f:q(a.options,P);c=u(P,t,i)}else if(N){const t=typeof f<"u",i=t?f:j(a.options,P);c=u(P,t,i,!0)}else{m=[];const t=typeof a.options.getNextPageParam>"u";c=(l&&P[0]?l(P[0],0,P):!0)?u([],t,v[0]):Promise.resolve(n([],v[0],P[0]));for(let h=1;h<P.length;h++)c=c.then(k=>{if(l&&P[h]?l(P[h],h,P):!0){const M=t?v[h]:q(a.options,k);return u(k,t,M)}return Promise.resolve(n(k,v[h],P[h]))})}return c.then(t=>({pages:t,pageParams:m}))}}}}function q(a,r){return a.getNextPageParam==null?void 0:a.getNextPageParam(r[r.length-1],r)}function j(a,r){return a.getPreviousPageParam==null?void 0:a.getPreviousPageParam(r[0],r)}function W(a,r){if(a.getNextPageParam&&Array.isArray(r)){const e=q(a,r);return typeof e<"u"&&e!==null&&e!==!1}}function X(a,r){if(a.getPreviousPageParam&&Array.isArray(r)){const e=j(a,r);return typeof e<"u"&&e!==null&&e!==!1}}class S extends T{constructor(r,e){super(r,e)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(r,e){super.setOptions({...r,behavior:E()},e)}getOptimisticResult(r){return r.behavior=E(),super.getOptimisticResult(r)}fetchNextPage({pageParam:r,...e}={}){return this.fetch({...e,meta:{fetchMore:{direction:"forward",pageParam:r}}})}fetchPreviousPage({pageParam:r,...e}={}){return this.fetch({...e,meta:{fetchMore:{direction:"backward",pageParam:r}}})}createResult(r,e){var o,y,w,p,l,g;const{state:f}=r,b=super.createResult(r,e),{isFetching:N,isRefetching:P}=b,v=N&&((o=f.fetchMeta)==null||(y=o.fetchMore)==null?void 0:y.direction)==="forward",m=N&&((w=f.fetchMeta)==null||(p=w.fetchMore)==null?void 0:p.direction)==="backward";return{...b,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:W(e,(l=f.data)==null?void 0:l.pages),hasPreviousPage:X(e,(g=f.data)==null?void 0:g.pages),isFetchingNextPage:v,isFetchingPreviousPage:m,isRefetching:P&&!v&&!m}}}function O(a,r,e){const o=F(S,a,r,e);return{...o,fetchNextPage:o.fetchNextPage.value,fetchPreviousPage:o.fetchPreviousPage.value,refetch:o.refetch.value,remove:o.remove.value}}function oe(a=J([]),r={},e,o){const{injectTokens:y,tokens:w}=Y(),{networkId:p}=C();let l=g();function g(){const s=G();return new s(N(),{timeout:30*1e3})}function f(){return{fetch:async s=>{const n=await Q.pools.get(P(s)),u=I.flatten(n.map(c=>[...c.tokensList,...D(c.tokens),c.address]));return y(u),n},get skip(){return Q.pools.skip}}}function b(){return{fetch:async s=>{const n=await H.pools.get(P(s)),u=new U(n);let c=await u.decorate(w.value);const d=I.flatten(n.map(t=>[...t.tokensList,...D(t.tokens),t.address]));return await y(d),c=await u.reCalculateTotalLiquidities(),c},get skip(){}}}function N(){const s=[];if(L){const u=f();s.push(u)}const n=b();return s.push(n),s}function P(s){var t,i;const n=e!=null&&e.isExactTokensList?"eq":"contains",u=a.value.map(h=>h.toLowerCase()),c=L?o==null?void 0:o.value:"totalLiquidity",d={chainId:K.network.chainId,orderBy:c,orderDirection:"desc",where:{tokensList:{[n]:u},poolType:{in:$.IncludedPoolTypes},totalShares:{gt:1e-5},id:{not_in:$.BlockList}}};return d.where&&((t=e==null?void 0:e.poolIds)!=null&&t.value)&&(d.where.id={in:e.poolIds.value}),d.where&&((i=e==null?void 0:e.poolAddresses)!=null&&i.value)&&(d.where.address={in:e.poolAddresses.value}),s.first&&(d.first=(e==null?void 0:e.first)||s.first),s.skip&&(d.skip=s.skip),d}function v(s=0){const n={};return a.value.length||(n.first=(e==null?void 0:e.pageSize)||$.Pagination.PerPage),s&&s>0&&(n.skip=s),n}function m(s){return(o==null?void 0:o.value)==="totalLiquidity"?s:(o==null?void 0:o.value)==="apr"?s.sort((n,u)=>{var t,i;const c=((t=n==null?void 0:n.apr)==null?void 0:t.max)??0;return(((i=u==null?void 0:u.apr)==null?void 0:i.max)??0)-c}):(o==null?void 0:o.value)==="volume"?s.sort((n,u)=>{const c=B((n==null?void 0:n.totalSwapVolume)??0);return B((u==null?void 0:u.totalSwapVolume)??0).minus(c).toNumber()}):s}Z(()=>[a,o],()=>{l=g()},{deep:!0});const x=V.Pools.All(p,a,o,e==null?void 0:e.poolIds,e==null?void 0:e.poolAddresses),R=async({pageParam:s=0})=>{var c,d;const n=v(s);let u=0;try{let t=await l.fetch(n);return L||(t=m(t)),_.addPools(t),u=(c=l.currentProvider)!=null&&c.skip?l.currentProvider.skip:((d=_.pools.value)==null?void 0:d.length)||0,{pools:t,skip:u}}catch(t){const i=_.pools.value;if(i&&i.length>0)return{pools:i,skip:u};throw t}};return r.getNextPageParam=s=>s.skip||0,O(x,R,r)}export{O as a,E as i,oe as u};
//# sourceMappingURL=usePoolsQuery-a683b142.js.map
