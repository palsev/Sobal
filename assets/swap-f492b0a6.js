var St=Object.defineProperty;var yt=(e,t,a)=>t in e?St(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var Me=(e,t,a)=>(yt(e,typeof t!="symbol"?t+"":t,a),a);import{aR as Ue,av as Le,aJ as Ce,bB as fa,aT as ae,ao as ga,b2 as ra,au as la,aq as Qe,aS as ce,cl as Ya,cn as bt,at as et,aw as at,bn as Oe,bp as Fe,az as kt,ay as At,b6 as tt,bo as xe,aP as _t,bq as Ia,b3 as Ma,bJ as xt,aA as ya}from"./BalBtn-a3a093af.js";import{_ as Et}from"./BalAccordion.vue_vue_type_script_setup_true_lang-d7724aa6.js";import{_ as Da}from"./MyWallet.vue_vue_type_script_setup_true_lang-b31e97b2.js";import{P as Na}from"./PairPriceGraph-a70d4eaf.js";import{_ as Tt}from"./BalTooltip.vue_vue_type_style_index_0_lang-b52dcfa5.js";import{_ as Ct}from"./BalToggle-35e11638.js";import{_ as st}from"./BalAlert-48dfe2e8.js";import{l as ha,c as ke,n as ia,Q as Ea,ai as Re,aj as ea,o as Je,B as De,U as Ze,a7 as $t,b as de,R as We,u as Ta,Z as se,S as Ra,ax as ca,ab as Wa,V as Bt,O as Pt,ay as ba}from"./connector-d867b6ec.js";import{u as Ot}from"./tailwind.config-93ced0cc.js";import{r as P,b as g,x as H,y as i,d as Ve,q as d,D as r,c as q,l as G,f as ue,A as B,h as I,C as Ua,F as aa,i as pa,B as Ne,G as Ca,H as $a,p as Ge,am as nt,E as na,v as Ba,ai as Pa,o as ua,ap as Ft,j as He,T as Lt,e as ka,as as Va}from"./runtime-core.esm-bundler-24a2b16f.js";import{_ as It}from"./BalModal-3bc137a6.js";import{_ as Mt}from"./BalActionSteps.vue_vue_type_script_setup_true_lang-1ae0de8c.js";import{_ as Ke}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as ot}from"./BalAsset-402797b2.js";import{_ as Dt}from"./BalStack.vue_vue_type_script_lang-b46da6b4.js";import{a as rt,R as ta,u as Aa,b as Nt,_ as Rt,S as Wt}from"./SwapSettingsPopover.vue_vue_type_style_index_0_lang-2f86f757.js";import{u as Ut,A as Vt}from"./useTokenApprovalActions-7a65b699.js";import{ab as lt,ac as it,k as wa,ad as Ht,ae as ze,d as ut,a5 as ye,af as sa,ag as Ha,ah as Te,ai as Gt,aj as zt,ak as Qt}from"./index-c7e2fe85.js";import{u as _a}from"./useSwapState-9610c199.js";import{L as ct}from"./useDarkMode-2a25fc5b.js";import{M as qt,t as Oa,O as da,y as jt,z as Jt,A as Ga,D as ma,w as pt,E as Zt}from"./useTransactions-19512b92.js";import{b as dt}from"./useGnosisSafeApp-4db73fba.js";import{c as oa,i as Fa}from"./errors-e4e66976.js";import{o as Kt}from"./TokenListsListItem-06129f32.js";import{u as La}from"./useBreakpoints-06419e03.js";import{a as Xt}from"./validations-7d885fa3.js";import{_ as za}from"./TokenInput.vue_vue_type_script_setup_true_lang-e965c189.js";import{u as Yt}from"./useVeBAL-c380e517.js";import{u as es}from"./usePoolFilters-857a71ae.js";import{c as as}from"./urls-ace5408b.js";import{p as ts}from"./user-tokens.provider-a7c5ddbf.js";import"./_commonjsHelpers-87174ba5.js";import"./metamask.connector-ad3cfd34.js";import"./pools-b19f9d28.js";import"./BalLink-6d436d10.js";import"./BalAssetSet-ca8ea95f.js";import"./BalLoadingBlock.vue_vue_type_style_index_0_lang-24e44890.js";import"./coingecko.service-cbc4f60f.js";import"./numeral-77821a11.js";import"./echarts-39b4b08d.js";import"./browser-6a4b4883.js";import"./useTailwind-d0408df9.js";import"./promise-5e82c3ab.js";import"./index-4d33cff6.js";import"./coingecko-514b8e81.js";import"./wallet-logos-eb0836bb.js";import"./anime.es-de4e5aa0.js";import"./Avatar.vue_vue_type_script_setup_true_lang-75ff433f.js";import"./options-bcf19abd.js";import"./BalBtnGroup-31269ec8.js";import"./BalPopover-e1e06c58.js";import"./index-27a66705.js";import"./events-5f626723.js";import"./readable-browser-744f1df3.js";import"./immutable-2b056f5a.js";import"./index-1de0572e.js";import"./meta.service-bad03ebe.js";import"./SelectTokenModal-d05a5195.js";import"./token-lists.provider-5bfd7ae9.js";import"./index.esm-d983ad6e.js";const vt=P(ha(`inputAsset.${ia.value}`,ke.network.tokens.InitialSwapTokens.input)),mt=P(ha(`outputAsset.${ia.value}`,ke.network.tokens.InitialSwapTokens.output));function ss(e){vt.value=e,Ea(`inputAsset.${ia.value}`,e)}function ns(e){mt.value=e,Ea(`outputAsset.${ia.value}`,e)}function wt(){return{inputAsset:vt,outputAsset:mt,setInputAsset:ss,setOutputAsset:ns}}const os={},rs={width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ls=i("path",{d:"M0.888584 8.06059L7.77779 14.9498L14.667 8.06059L13.211 6.59752L8.83603 10.9796V0.333313H6.71955V10.9796L2.33745 6.59752L0.888584 8.06059Z",fill:"currentColor"},null,-1),is=[ls];function us(e,t){return g(),H("svg",rs,is)}const cs=Ke(os,[["render",us]]),ps=e=>(Ca("data-v-6e030ef6"),e=e(),$a(),e),ds={class:"mr-2"},vs=["textContent"],ms={key:1},ws={class:"flex justify-between text-xs"},fs={class:"font-semibold"},gs={class:"flex flex-col items-end"},hs={class:"font-semibold"},Ss={class:"relative mt-2"},ys=ps(()=>i("div",{class:"absolute mx-9 h-1/2 border-b border-gray-500 border-dashed pair-line"},null,-1)),bs={class:"flex relative z-10 justify-between"},ks={class:"relative my-1.5 mx-4"},As={class:"relative z-10"},_s={class:"flex items-center ml-4 w-4"},xs={class:"flex"},Es=["href"],Ts={class:"mr-4 w-10 text-xs text-right text-secondary"},Cs=Ve({__name:"SwapRoute",props:{addressIn:null,amountIn:null,addressOut:null,amountOut:null,pools:null,sorReturn:null,hideContainer:{type:Boolean}},setup(e){const t=e,{fNum:a}=Ue(),{getToken:n}=Le(),s=P(!1);function l(){s.value=!s.value}const o=d(()=>{const c=n(t.addressIn).symbol;return{amount:t.amountIn,address:t.addressIn,symbol:c}}),u=d(()=>{const c=n(t.addressOut).symbol;return{amount:t.amountOut,address:t.addressOut,symbol:c}}),v=d(()=>{const{sorReturn:c}=t;if(!c.hasSwaps)return[];const S=t.pools,f=c.result.swaps,_=c.result.tokenAddresses,x=t.addressIn,E=t.addressOut;return w(x,E,S,f,_)});function w(c,S,f,_,x){if(c=c===Re?ea:Je(c),S=S===Re?ea:Je(S),!f.length||!_.length||!x.length||x.length===1)return[];const E=_.reduce((T,F)=>T.plus(F.amount||"0"),new De(0)),h=[],O=[];for(let T=0;T<_.length;T++){const F=_[T],te=f.find(ne=>ne.id===F.poolId);if(te){const ne=x[F.assetInIndex]===Ce?ea:Je(x[F.assetInIndex]),m=x[F.assetOutIndex]===Ce?ea:Je(x[F.assetOutIndex]),D=ne===c&&m===S,Q={pool:{address:te.address,id:te.id,tokens:te.tokens.map(k=>({address:Je(k.address),share:parseFloat(k.weight||"")||1/te.tokens.length})).sort((k,$)=>Ze(k.address,ne)||Ze($.address,m)?-1:Ze(k.address,m)||Ze($.address,ne)?1:k.share-$.share).filter((k,$,W)=>$<2||$>W.length-3)},tokenIn:ne,tokenOut:m,amount:new De(F.amount||"0")};if(O.push(Q),D){const $={share:Q.amount.div(E).toNumber(),hops:[Q]};h.push($)}else if(m===S&&F.amount==="0"){const W={share:new De(O[T-1].amount).div(E).toNumber(),hops:[O[T-1],Q]};h.push(W)}else if(ne===c&&F.amount==="0"){const W={share:new De(O[T-1].amount).div(E).toNumber(),hops:[Q,O[T-1]]};h.push(W)}}}return h}function y(c){return a(c,ae.percent)}return(c,S)=>{const f=ga,_=ot,x=fa;return r(v).length>0?(g(),q(x,{key:0,shadow:"none"},{default:G(()=>[e.hideContainer?ue("",!0):(g(),H("div",{key:0,class:"flex items-center cursor-pointer text-secondary",onClick:l},[i("div",ds,B(c.$t("swapRoute")),1),r(s)?(g(),q(f,{key:0,name:"chevron-up",size:"sm"})):(g(),q(f,{key:1,name:"chevron-down",size:"sm"}))])),r(s)||e.hideContainer?(g(),H("div",{key:1,class:Ne([e.hideContainer?"":"mt-5"])},[r(v).length===0?(g(),H("div",{key:0,class:"mt-5 text-sm text-secondary",textContent:B(c.$t("noData"))},null,8,vs)):(g(),H("div",ms,[i("div",null,[i("div",ws,[i("div",null,[i("div",fs,B(r(o).amount),1),i("div",null,B(r(o).symbol),1)]),i("div",gs,[i("div",hs,B(r(u).amount),1),i("div",null,B(r(u).symbol),1)])]),i("div",Ss,[ys,i("div",bs,[I(_,{address:r(o).address,size:36},null,8,["address"]),I(_,{address:r(u).address,size:36},null,8,["address"])])])]),i("div",{class:"flex justify-between",style:Ua({margin:`8px ${12+r(v).length}px`})},[I(f,{name:"triangle",size:"xxs",filled:!0,class:"rotate-180 text-secondary"}),I(f,{name:"triangle",size:"xxs",filled:!0,class:"text-secondary"})],4),i("div",ks,[(g(!0),H(aa,null,pa(r(v),(E,h)=>(g(),H("div",{key:h,style:Ua({height:`${18+70*h}px`,width:`calc(100% - ${4*(r(v).length-h-1)}px + 1px)`,margin:`0 ${2*(r(v).length-h-1)-1}px`}),class:"absolute rounded-b-md border-r border-b border-l border-gray-500"},null,4))),128)),i("div",As,[(g(!0),H(aa,null,pa(r(v),E=>{var h,O;return g(),H("div",{key:(O=(h=E.hops[0])==null?void 0:h.pool)==null?void 0:O.address,class:"flex justify-between mt-9 first:mt-0"},[i("div",_s,[I(f,{name:"triangle",size:"xxs",filled:!0,class:"rotate-90 text-secondary"})]),i("div",xs,[(g(!0),H(aa,null,pa(E.hops,T=>{var F;return g(),H("div",{key:(F=T==null?void 0:T.pool)==null?void 0:F.address,class:"flex ml-4 first:ml-0 bg-white hover:bg-gray-50 dark:bg-gray-900 dark:hover:bg-gray-800 rounded-xl border border-gray-100 hover:border-gray-300 dark:border-gray-600 dark:hover:border-gray-400 shadow transition-colors"},[i("a",{class:"flex p-1.5",href:`/#/${r($t)}/pool/${T.pool.id}`,target:"_blank"},[(g(!0),H(aa,null,pa(T.pool.tokens,te=>(g(),q(_,{key:te.address,class:"ml-1.5 first:ml-0",address:te.address,size:20},null,8,["address"]))),128))],8,Es)])}),128))]),i("div",Ts,B(y(E.share)),1)])}),128))])])]))],2)):ue("",!0)]),_:1})):ue("",!0)}}});const ft=Ke(Cs,[["__scopeId","data-v-6e030ef6"]]);var he=(e=>(e[e.NonWrap=0]="NonWrap",e[e.Wrap=1]="Wrap",e[e.Unwrap=2]="Unwrap",e))(he||{});const gt=(e,t)=>{const a=ke.network.tokens.Addresses.nativeAsset,n=ke.network.tokens.Addresses.wNativeAsset,{stETH:s,wstETH:l}=ke.network.tokens.Addresses;return e===a&&t===n||e===s&&t===l?1:t===a&&e===n||t===s&&e===l?2:0},Qa=async(e,t,a)=>{if(t===0)throw new Error("Invalid wrap type");const n=ke.network.tokens.Addresses.wNativeAsset,{wstETH:s}=ke.network.tokens.Addresses;if(e===n)return de.from(a);if(e===s)return lt({amount:a,isWrap:t===1});throw new Error("Unknown wrapper")};async function $s(e,t,a,n){try{if(a===We[e].tokens.Addresses.wNativeAsset)return Ps(e,t,n);if(a===We[e].tokens.Addresses.wstETH)return Fs(e,t,n);throw new Error("Unrecognised wrapper contract")}catch(s){return console.log("[Wrapper] Wrap error:",s),Promise.reject(s)}}async function Bs(e,t,a,n){try{if(a===We[e].tokens.Addresses.wNativeAsset)return Os(e,t,n);if(a===We[e].tokens.Addresses.wstETH)return Ls(e,t,n);throw new Error("Unrecognised wrapper contract")}catch(s){return console.log("[Wrapper] Unwrap error:",s),Promise.reject(s)}}const Ps=async(e,t,a)=>await new ra(t.getSigner()).contract.sendTransaction({contractAddress:We[e].tokens.Addresses.wNativeAsset,abi:["function deposit() payable"],action:"deposit",options:{value:a}}),Os=async(e,t,a)=>await new ra(t.getSigner()).contract.sendTransaction({contractAddress:We[e].tokens.Addresses.wNativeAsset,abi:["function withdraw(uint256 wad)"],action:"withdraw",params:[a]}),Fs=async(e,t,a)=>await new ra(t.getSigner()).contract.sendTransaction({contractAddress:We[e].tokens.Addresses.wstETH,abi:["function wrap(uint256 _stETHAmount) returns (uint256)"],action:"wrap",params:[a]}),Ls=async(e,t,a)=>await new ra(t.getSigner()).contract.sendTransaction({contractAddress:We[e].tokens.Addresses.wstETH,abi:["function unwrap(uint256 _wstETHAmount) returns (uint256)"],action:"unwrap",params:[a]}),Is={class:"w-full"},Ms={class:"p-3 w-full text-sm bg-gray-50 dark:bg-gray-800 rounded-t-lg border-b dark:border-gray-800"},Ds={class:"relative p-3 border-b border-gray-100 dark:border-gray-900"},Ns={class:"flex items-center"},Rs={class:"mr-3"},Ws={class:"font-medium"},Us={class:"text-sm text-secondary"},Vs={class:"arrow-down"},Hs={class:"p-3"},Gs={class:"flex items-center"},zs={class:"mr-3"},Qs={class:"font-medium"},qs={class:"text-sm text-secondary"},js={key:0},Js={class:"flex justify-between items-center p-3 w-full border-b dark:border-gray-900"},Zs={class:"font-semibold"},Ks={class:"flex text-xs uppercase divide-x dark:divide-gray-500"},Xs={key:0,class:"p-3 text-sm"},Ys={class:"summary-item-row"},en=["innerHTML"],an={class:"summary-item-row"},tn={class:"text-lime-400"},sn={class:"summary-item-row"},nn=["innerHTML"],on={class:"p-3 w-full text-sm bg-white dark:bg-gray-800 rounded-b-lg"},rn={class:"font-medium summary-item-row"},ln={class:"w-64"},un=["innerHTML"],cn={class:"summary-item-row text-secondary"},pn={class:"w-64"},dn=["innerHTML"],vn=Ve({__name:"SwapPreviewModal",props:{swapping:null,error:null,warning:null},emits:["swap","close"],setup(e,{emit:t}){const a=e,n=.02,{t:s}=la(),{fNum:l,toFiat:o}=Ue(),{balanceFor:u}=Le(),{blockNumber:v,account:w,startConnectWithInjectedProvider:y}=Qe(),{slippage:c}=Ya(),{networkConfig:S}=Ta(),f=P(a.swapping.isWrapUnwrapSwap.value?null:a.swapping.getQuote()),_=P(!1),x=P(!1),E=P(!1),h=P(!0),O=d(()=>l(c.value,ae.percent)),T=d(()=>a.swapping.tokenIn.value.address),F=d(()=>l(o(a.swapping.tokenInAmountInput.value,a.swapping.tokenIn.value.address),ae.fiat)),te=d(()=>l(o(a.swapping.tokenOutAmountInput.value,a.swapping.tokenOut.value.address),ae.fiat)),ne=d(()=>a.swapping.isBalancerSwap.value),m=d(()=>E.value?l("0",ae.fiat):"0.0 ETH"),D=d(()=>w.value&&se(a.swapping.tokenInAmountInput.value).isGreaterThan(u(a.swapping.tokenInAddressInput.value))),R=d(()=>!!D.value||!!a.error||!!h.value),Q=d(()=>{const A={amountBeforeFees:"",swapFees:"",totalWithoutSlippage:"",totalWithSlippage:""},K=a.swapping.exactIn.value,pe=a.swapping.tokenIn.value,p=a.swapping.tokenOut.value,L=a.swapping.tokenInAmountInput.value,C=a.swapping.tokenOutAmountInput.value;if(a.swapping.isWrapUnwrapSwap.value)A.amountBeforeFees=C,A.swapFees="0",A.totalWithoutSlippage=C,A.totalWithSlippage=C;else{const J=a.swapping.getQuote();K?(A.amountBeforeFees=C,A.swapFees=ce(J.feeAmountOutToken,p.decimals),A.totalWithoutSlippage=se(A.amountBeforeFees).minus(A.swapFees).toString(),A.totalWithSlippage=ce(J.minimumOutAmount,p.decimals)):(A.amountBeforeFees=L,A.swapFees=ce(J.feeAmountInToken,pe.decimals),A.totalWithoutSlippage=se(A.amountBeforeFees).plus(A.swapFees).toString(),A.totalWithSlippage=ce(J.maximumInAmount,pe.decimals))}return E.value?Ra.mapValues(A,J=>`${l(o(J,K?p.address:pe.address),ae.fiat)}`):Ra.mapValues(A,J=>`${l(J,ae.token)} ${K||a.swapping.isWrapUnwrapSwap.value?p.symbol:pe.symbol}`)}),k=d(()=>a.swapping.isWrap.value?{modalTitle:s("previewWrap",[a.swapping.tokenIn.value.symbol]),confirmSwap:s("confirmWrap",[a.swapping.tokenIn.value.symbol]),swapSummary:{title:s("swapSummary.wrap.title"),swapFees:s("swapSummary.wrap.swapFees"),totalBeforeFees:s("swapSummary.wrap.totalBeforeFees"),totalAfterFees:s("swapSummary.wrap.totalAfterFees"),totalWithSlippage:s("swapSummary.wrap.totalWithSlippage",[a.swapping.tokenIn.value.symbol])}}:a.swapping.isUnwrap.value?{modalTitle:s("previewUnwrap",[a.swapping.tokenOut.value.symbol]),confirmSwap:s("confirmUnwrap",[a.swapping.tokenOut.value.symbol]),swapSummary:{title:s("swapSummary.unwrap.title"),swapFees:s("swapSummary.unwrap.swapFees"),totalBeforeFees:s("swapSummary.unwrap.totalBeforeFees"),totalAfterFees:s("swapSummary.unwrap.totalAfterFees"),totalWithSlippage:s("swapSummary.unwrap.totalWithSlippage",[a.swapping.tokenOut.value.symbol])}}:a.swapping.exactIn.value?{modalTitle:s("previewSwap"),confirmSwap:s("confirmSwap"),swapSummary:{title:s("swapSummary.exactIn.title",[a.swapping.tokenIn.value.symbol]),swapFees:s("swapSummary.exactIn.swapFees"),totalBeforeFees:s("swapSummary.exactIn.totalBeforeFees"),totalAfterFees:s("swapSummary.exactIn.totalAfterFees"),totalWithSlippage:s("swapSummary.exactIn.totalWithSlippage",[O.value])}}:{modalTitle:s("previewSwap"),confirmSwap:s("confirmSwap"),swapSummary:{title:s("swapSummary.exactOut.title",[a.swapping.tokenOut.value.symbol]),swapFees:s("swapSummary.exactOut.swapFees"),totalBeforeFees:s("swapSummary.exactOut.totalBeforeFees"),totalAfterFees:s("swapSummary.exactOut.totalAfterFees"),totalWithSlippage:s("swapSummary.exactOut.totalWithSlippage",[O.value])}}),$=d(()=>gt(a.swapping.tokenIn.value.address,a.swapping.tokenOut.value.address)),W=d(()=>it(T.value,a.swapping.tokenOut.value.address)&&$.value===he.NonWrap),{getTokenApprovalActions:oe}=Ut(),N=P([]),{relayerSignature:Z,relayerApprovalAction:V}=rt(ta.BATCH),ve=Aa(ta.BATCH),me=Aa(ta.COWSWAP,a.swapping.isCowswapSwap),we=Aa(ta.LIDO,W),b=d(()=>a.swapping.sor.pools.value),M=d(()=>a.swapping.isJoinExitSwap.value&&!ve.isUnlocked.value&&!Z.value),z=d(()=>a.swapping.isCowswapSwap.value&&a.swapping.requiresTokenApproval.value&&!me.isUnlocked.value),re=d(()=>a.swapping.isBalancerSwap.value&&!we.isUnlocked.value),fe=d(()=>a.swapping.isJoinExitSwap.value&&!ve.isUnlocked.value),ge=d(()=>z.value||me.init.value||me.approved.value||me.approving.value),Se=d(()=>!a.swapping.isJoinExitSwap.value&&(re.value||we.init.value||we.approved.value||we.approving.value)),j=d(()=>M.value||z.value||re.value),be=d(()=>!j.value&&_.value&&!x.value),$e=d(()=>{const A=[];return ge.value?A.push(me.action.value):Se.value?A.push(we.action.value):fe.value&&A.push(V.value),N.value.length>0&&A.push(...N.value),A.push({label:k.value.confirmSwap,loadingLabel:s("actionSteps.swap.loadingLabel"),confirmingLabel:s("confirming"),action:Ae,stepTooltip:a.swapping.isCowswapSwap.value&&!a.swapping.isJoinExitSwap?s("swapSummary.transactionTypesTooltips.sign.content"):s("swapSummary.transactionTypesTooltips.swap.content")}),A});async function Ae(){return a.swapping.swap(()=>{a.swapping.resetAmounts(),t("close")})}function Be(){t("close")}function Ie(){_.value=!1,x.value=!0,f.value=a.swapping.getQuote()}function Xe(){if(f.value!=null){const A=a.swapping.getQuote();if(a.swapping.exactIn.value){const K=se(f.value.minimumOutAmount.toString()),pe=se(A.minimumOutAmount.toString());if(K.eq(ca))pe.eq(ca)?_.value=!1:_.value=!0;else{const p=K.minus(pe).abs().div(K);_.value=p.gt(n)}}else{const K=se(f.value.maximumInAmount.toString()),pe=se(A.maximumInAmount.toString());if(K.eq(ca))pe.eq(ca)?_.value=!1:_.value=!0;else{const p=K.minus(pe).abs().div(K);_.value=p.gt(n)}}_.value&&(x.value=!1)}}const qe=d(()=>a.swapping.isWrap.value&&!a.swapping.isNativeAssetSwap.value?a.swapping.tokenOut.value.address:S.addresses.vault);return Ge(v,()=>{Xe()}),nt(async()=>{N.value=await oe({amountsToApprove:[{address:T.value,amount:a.swapping.tokenInAmountInput.value}],spender:qe.value,actionType:Vt.Swapping}),h.value=!1}),(A,K)=>{const pe=ga,p=Dt,L=st,C=ot,J=cs,le=fa,X=at,Y=Mt,ee=It;return g(),q(ee,{show:"",onClose:Be},{default:G(()=>[i("div",null,[I(p,{horizontal:"",align:"center",spacing:"xs",class:"mb-4"},{default:G(()=>[i("button",{class:"flex text-blue-500 hover:text-blue-700",onClick:Be},[I(pe,{class:"flex",name:"chevron-left"})]),i("h4",null,B(r(k).modalTitle),1)]),_:1}),I(le,{noPad:"",class:"overflow-auto relative mb-6"},{header:G(()=>[i("div",Is,[i("div",null,[e.error?(g(),q(L,{key:0,class:"p-3 mb-2",type:"error",size:"sm",title:e.error.header,description:e.error.body,actionLabel:e.error.label,block:""},null,8,["title","description","actionLabel"])):e.warning?(g(),q(L,{key:1,class:"p-3 mb-2",type:"warning",size:"sm",title:e.warning.header,description:e.warning.body,block:""},null,8,["title","description"])):ue("",!0)]),i("div",Ms,[i("span",null,B(A.$t("effectivePrice"))+" "+B(e.swapping.exactIn.value?e.swapping.effectivePriceMessage.value.tokenIn:e.swapping.effectivePriceMessage.value.tokenOut),1)])])]),default:G(()=>[i("div",null,[r(D)?(g(),q(L,{key:0,class:"p-3",type:"error",size:"sm",title:`${r(s)("exceedsBalance")} ${r(l)(r(u)(a.swapping.tokenInAddressInput.value),r(ae).token)} ${a.swapping.tokenIn.value.symbol}`,block:"",square:""},null,8,["title"])):ue("",!0),i("div",Ds,[i("div",Ns,[i("div",Rs,[I(C,{address:e.swapping.tokenIn.value.address,size:36},null,8,["address"])]),i("div",null,[i("div",Ws,B(r(l)(e.swapping.tokenInAmountInput.value,r(ae).token))+" "+B(e.swapping.tokenIn.value.symbol),1),i("div",Us,B(r(F)),1)])])]),i("div",Vs,[I(J)]),i("div",Hs,[i("div",Gs,[i("div",zs,[I(C,{address:e.swapping.tokenOut.value.address,size:36},null,8,["address"])]),i("div",null,[i("div",Qs,B(r(l)(e.swapping.tokenOutAmountInput.value,r(ae).token))+" "+B(e.swapping.tokenOut.value.symbol),1),i("div",qs,[na(B(r(te))+" ",1),e.swapping.isBalancerSwap.value||e.swapping.isWrapUnwrapSwap.value?(g(),H("span",js," / "+B(A.$t("priceImpact"))+": "+B(r(l)(e.swapping.sor.priceImpact.value,r(ae).percent)),1)):ue("",!0)])])])])])]),_:1}),I(le,{noPad:"",shadow:"none",class:"mb-3"},{header:G(()=>[i("div",Js,[i("div",Zs,B(r(k).swapSummary.title),1),i("div",Ks,[i("div",{class:Ne(["pr-2 cursor-pointer font-medium",{"text-blue-600":!E.value}]),onClick:K[0]||(K[0]=ie=>E.value=!1)},B(A.$t("tokens")),3),i("div",{class:Ne(["pl-2 cursor-pointer font-medium uppercase",{"text-blue-600":E.value}]),onClick:K[1]||(K[1]=ie=>E.value=!0)},B(r(bt).usd),3)])])]),footer:G(()=>[i("div",on,[i("div",rn,[i("div",ln,B(r(k).swapSummary.totalAfterFees),1),i("div",{innerHTML:r(Q).totalWithoutSlippage},null,8,un)]),i("div",cn,[i("div",pn,B(r(k).swapSummary.totalWithSlippage),1),i("div",{innerHTML:e.swapping.isWrapUnwrapSwap.value?"":r(Q).totalWithSlippage},null,8,dn)])])]),default:G(()=>[e.swapping.isCowswapSwap.value?(g(),H("div",Xs,[i("div",Ys,[i("div",null,B(r(k).swapSummary.totalBeforeFees),1),i("div",{innerHTML:r(Q).amountBeforeFees},null,8,en)]),i("div",an,[i("div",null,B(A.$t("swapSummary.gasCosts")),1),i("div",tn,"-"+B(r(m)),1)]),i("div",sn,[i("div",null,B(r(k).swapSummary.swapFees),1),i("div",{innerHTML:e.swapping.isWrapUnwrapSwap.value?r(m):e.swapping.exactIn.value?`-${r(Q).swapFees}`:`+${r(Q).swapFees}`},null,8,nn)])])):ue("",!0)]),_:1}),r(be)?(g(),q(L,{key:0,class:"p-3 mb-4",type:"error",size:"md",title:A.$t("priceUpdatedAlert.title"),description:A.$t("priceUpdatedAlert.description",[r(l)(n,r(ae).percent)]),actionLabel:A.$t("priceUpdatedAlert.actionLabel"),block:"",onActionClick:Ie},null,8,["title","description","actionLabel"])):ue("",!0),r(w)?(g(),q(Y,{key:2,actions:r($e),primaryActionType:"swap",disabled:r(R)||r(be)},null,8,["actions","disabled"])):(g(),q(X,{key:1,color:"gradient",block:"",onClick:et(r(y),["prevent"])},{default:G(()=>[na(B(A.$t("connectWallet")),1)]),_:1},8,["onClick"])),e.swapping.submissionError.value!=null?(g(),q(L,{key:3,class:"p-3 mt-4",type:"error",size:"md",title:A.$t("swapSubmissionError.title"),description:e.swapping.submissionError.value,block:"",actionLabel:A.$t("swapSubmissionError.actionLabel"),onActionClick:e.swapping.resetSubmissionError},null,8,["title","description","actionLabel","onActionClick"])):ue("",!0),e.swapping.isJoinExitSwap.value?(g(),q(L,{key:4,class:"p-3 mt-4",type:"tip",size:"md",title:"",description:r(fe)?A.$t("isJoinExitTipDescription.withApproval"):A.$t("isJoinExitTipDescription.withoutApproval"),block:""},null,8,["description"])):ue("",!0)]),r(ne)?(g(),q(ft,{key:0,addressIn:e.swapping.tokenIn.value.address,amountIn:e.swapping.tokenInAmountInput.value,addressOut:e.swapping.tokenOut.value.address,amountOut:e.swapping.tokenOutAmountInput.value,pools:r(b),sorReturn:e.swapping.sor.sorReturn.value,class:"mt-3"},null,8,["addressIn","amountIn","addressOut","amountOut","pools","sorReturn"])):ue("",!0)]),_:1})}}});const mn=Ke(vn,[["__scopeId","data-v-031d67ec"]]);function xa(e){const t=Date.now()/1e3,a=Math.floor(e*60+t);return Math.min(a,qt)}const qa=Oe("0.2",18),wn={}.VITE_GNOSIS_APP_DATA??"0xE9F29AE547955463ED535162AEFEE525D8D309571A2B18BC26086C8C35D781EB",_e=Ba({warnings:{highFees:!1},validationError:null,submissionError:null});function fn({exactIn:e,tokenInAddressInput:t,tokenInAmountInput:a,tokenOutAddressInput:n,tokenOutAmountInput:s,tokenInAmountScaled:l,tokenOutAmountScaled:o,tokenIn:u,tokenOut:v,slippageBufferRate:w}){const{transactionDeadline:y}=dt(),{account:c,getSigner:S}=Qe(),{addTransaction:f}=Oa(),{fNum:_}=Ue(),{balanceFor:x}=Le(),{t:E}=la(),h=P(!1),O=P(!1),T=P(null),F=P(0),te=d(()=>_e.validationError!=null);function ne(){const k=T.value??"0",$=l.value.isZero()?"0":o.value.mul(k).div(l.value).toString();return{feeAmountInToken:k,feeAmountOutToken:$}}function m(){const{feeAmountInToken:k,feeAmountOutToken:$}=ne(),W=l.value.add(k).mul(Oe(String(1+w.value),18)).div(Fe),oe=o.value.sub($).mul(Fe).div(Oe(String(1+w.value),18));return{feeAmountInToken:k,feeAmountOutToken:$,maximumInAmount:W,minimumOutAmount:oe}}async function D(k){let $;try{O.value=!0,_e.submissionError=null,$=m();const W={sellToken:t.value,buyToken:n.value,sellAmount:(e.value?l.value:$.maximumInAmount).sub($.feeAmountInToken).toString(),buyAmount:e.value?$.minimumOutAmount.toString():o.value.toString(),validTo:xa(y.value),appData:wn,feeAmount:$.feeAmountInToken,kind:e.value?da.SELL:da.BUY,receiver:c.value,partiallyFillable:!1,sellTokenBalance:jt.EXTERNAL},{signature:oe,signingScheme:N}=await Jt(W,S()),Z=await Ga.sendSignedOrder({order:{...W,signature:oe,receiver:c.value,signingScheme:N},owner:c.value}),V=e.value?a.value:ce($.maximumInAmount,u.value.decimals).toString(),ve=e.value?ce($.minimumOutAmount,v.value.decimals).toString():s.value,me=e.value?"":"~",we=e.value?"~":"",b=`${me}${_(V,ae.token)} ${u.value.symbol} -> ${we}${_(ve,ae.token)} ${v.value.symbol}`,{validTo:M,partiallyFillable:z}=W;f({id:Z,type:"order",action:"swap",summary:b,details:{tokenIn:u.value,tokenOut:v.value,tokenInAddress:t.value,tokenOutAddress:n.value,tokenInAmount:a.value,tokenOutAmount:s.value,exactIn:e.value,quote:$,slippageBufferRate:w.value,order:{validTo:M,partiallyFillable:z}}}),k!=null&&k(),O.value=!1,kt(At.CowswapSwap)}catch(W){const oe=E("swapException",["Cowswap"]);throw oa({error:W,action:"swap",msgPrefix:oe,context:{level:"fatal",extra:{sender:c.value,tokenIn:u.value,tokenOut:v.value,tokenInAmount:a.value,tokenOutAmount:s.value,quote:$}}}),Fa(W)||(_e.submissionError=oe),O.value=!1,W}}function R(k=!0){_e.warnings.highFees=!1,_e.validationError=null,_e.submissionError=null,k&&(T.value=null)}async function Q(){if(e.value&&!a.value||!e.value&&!s.value)return;const k=e.value?l.value:o.value;if(k===void 0)return;if(k.isZero()){e.value?s.value="0":a.value="0";return}h.value=!0,_e.validationError=null,F.value+=1;const $=F.value;try{const W={sellToken:t.value,buyToken:n.value,kind:e.value?da.SELL:da.BUY,fromDecimals:u.value.decimals,toDecimals:v.value.decimals,from:c.value||Ce,receiver:c.value||Ce,[e.value?"sellAmountAfterFee":"buyAmountAfterFee"]:k.toString(),partiallyFillable:!1},oe=await Ga.getPriceQuote(W);if(e.value&&!a.value||!e.value&&!s.value){h.value=!1;return}if(oe&&$===F.value)if(T.value=oe.feeAmount,e.value){s.value=se(ce(oe.buyAmount??"0",v.value.decimals)).toFixed(6,De.ROUND_DOWN);const{feeAmountInToken:N}=m();_e.warnings.highFees=de.from(N).gt(k.mul(qa).div(Fe))}else{a.value=se(ce(oe.sellAmount??"0",u.value.decimals)).toFixed(6,De.ROUND_DOWN);const{feeAmountOutToken:N,maximumInAmount:Z}=m();_e.warnings.highFees=de.from(N).gt(k.mul(qa).div(Fe)),c.value&&se(ce(Z,u.value.decimals)).gt(x(u.value.address))&&(_e.validationError=ma.PriceExceedsBalance)}}catch(W){console.log("[CoWswap Quotes] Failed to update quotes",W)}h.value=!1}return{swap:D,handleAmountChange:Q,resetState:R,...Pa(_e),feeQuote:T,updatingQuotes:h,hasValidationError:te,confirming:O,getQuote:m}}const ja={}.VITE_SWAP_COST||"100000";class gn{constructor(t,a,n){Me(this,"sorV2");Me(this,"fetchStatus",{v2finishedFetch:!1,v2success:!1});Me(this,"isFetching");Me(this,"maxPools");Me(this,"gasPrice");Me(this,"selectedPools",[]);this.sorV2=wa().sor,this.gasPrice=a,this.maxPools=n,this.isFetching=!1}async setCostOutputToken(t,a,n=null){t=t===Re?ea:t,n&&await this.sorV2.swapCostCalculator.setNativeAssetPriceInToken(t,n);const s=await this.sorV2.getCostOfSwapInToken(t,a,this.gasPrice,de.from(ja));return console.log(`[SorManager] Cost for token ${t}: ${s.toString()}`),s}async fetchPools(){if(!this.isFetching){this.isFetching=!0,console.time("[SorManager] fetchPools");try{const t=await this.sorV2.fetchPools();this.fetchStatus.v2finishedFetch=!0,this.fetchStatus.v2success=t,t||oa({error:new Error("SOR Fetch pools failed"),context:{level:"fatal"}})}catch(t){console.log(`[SorManager] V2 fetchPools issue: ${t.message}`),this.fetchStatus.v2finishedFetch=!0,this.fetchStatus.v2success=!1,oa({error:t,msgPrefix:"SORFetchPools",context:{level:"fatal"}})}console.log(`[SorManager] V2 fetchPools result: ${this.fetchStatus.v2success}`),console.timeEnd("[SorManager] V2 fetchPools"),this.selectedPools=this.sorV2.getPools(),this.isFetching=!1}}async getBestSwap(t,a,n,s,l,o){const u=t===Re?Ce:t,v=a===Re?Ce:a,w=Math.floor(Date.now()/1e3),y={maxPools:this.maxPools,gasPrice:this.gasPrice,swapGas:de.from(ja),poolTypeFilter:Ht.All,timestamp:w,forceRefresh:!0},c=await this.sorV2.getSwaps(u.toLowerCase(),v.toLowerCase(),l,o,y);return console.log(`[SorManager] ${c.returnAmount.toString()}: V2 return amount`),console.log(`[SorManager] ${c.returnAmountConsideringFees.toString()}: V2 return amount with fees`),{tokenIn:t,tokenOut:a,returnDecimals:l===ze.SwapExactIn?s:n,hasSwaps:c.swaps.length>0,returnAmount:c.returnAmount,result:c,marketSpNormalised:c.marketSp}}hasPoolData(){return this.fetchStatus.v2finishedFetch?this.fetchStatus.v2success===!1?(console.log("[SorManager] Error Fetching V2 Pools - No Liquidity Sources."),!1):!0:(console.log("[SorManager] Not finished fetching pools."),!1)}}class ht{constructor(t=ke,a=tt){Me(this,"abi");this.config=t,this.walletService=a,this.abi=ut.Vault__factory.abi}get address(){return this.config.network.addresses.vault}swap(t,a,n,s,l={}){const o=xa(s);return this.walletService.txBuilder.contract.sendTransaction({contractAddress:this.address,abi:this.abi,action:"swap",params:[t,a,n,o],options:l})}batchSwap(t,a,n,s,l,o,u={}){const v=xa(o);return this.walletService.txBuilder.contract.sendTransaction({contractAddress:this.address,abi:this.abi,action:"batchSwap",params:[t,a,n,s,l,v],options:u})}getInternalBalance(t,a){return this.walletService.txBuilder.contract.callStatic({contractAddress:this.address,abi:this.abi,action:"getInternalBalance",params:[t,a]})}manageUserBalance({kind:t,asset:a,amount:n,sender:s,recipient:l}){return this.walletService.txBuilder.contract.sendTransaction({contractAddress:this.address,abi:this.abi,action:"manageUserBalance",params:[[{kind:t,asset:a,amount:n,sender:s,recipient:l}]]})}}const va=new ht;class hn extends ht{constructor(){super(),this.abi=ut.LidoRelayer__factory.abi}get address(){return this.config.network.addresses.lidoRelayer}}const Ja=new hn;var Pe=(e=>(e[e.fixed=0]="fixed",e[e.min=1]="min",e[e.max=2]="max",e))(Pe||{});class Sn{constructor(t,a=ke,n=tt){this.transactionDeadline=t,this.config=a,this.walletService=n}async batchSwapV2(t,a,n,s){if(it(t.address,a.address))return this.lidoBatchSwap(t,a,n,s);console.log("[Swap Service] batchSwapV2");const l={};Ze(t.address,Ce)&&(l.value=t.amount);const o=a.type===1?ye.SwapExactIn:ye.SwapExactOut,u=await this.getFundManagement();try{if(n.length==1){const w={poolId:n[0].poolId,kind:o,assetIn:s[n[0].assetInIndex],assetOut:s[n[0].assetOutIndex],amount:n[0].amount,userData:n[0].userData},y=o===ye.SwapExactIn?a.amount.toString():t.amount.toString();return va.swap(w,u,y,this.transactionDeadline.value,l)}const v=this.calculateLimits([t],[a],s);return va.batchSwap(o,n,s,u,v,this.transactionDeadline.value,l)}catch(v){return console.log("[Swapper] batchSwapV2 Error:",v),Promise.reject(v)}}async lidoBatchSwap(t,a,n,s){console.log("[Swapper] lidoBatchSwap");const l={};Ze(t.address,Ce)&&(l.value=t.amount);const o=this.config.network.tokens.Addresses.wstETH||"";sa(t.address)?t={address:o.toLowerCase(),amount:await Ha(t.amount),type:t.type}:sa(a.address)&&(a={address:o.toLowerCase(),amount:await Ha(a.amount),type:a.type});const u=a.type===1?ye.SwapExactIn:ye.SwapExactOut,v=await this.getFundManagement();try{if(n.length==1){const y={poolId:n[0].poolId,kind:u,assetIn:s[n[0].assetInIndex],assetOut:s[n[0].assetOutIndex],amount:n[0].amount,userData:n[0].userData};return Ja.swap(y,v,a.amount.toString(),this.transactionDeadline.value,l)}const w=this.calculateLimits([t],[a],s);return Ja.batchSwap(u,n,s,v,w,this.transactionDeadline.value,l)}catch(w){return console.log("[Swapper] lidoBatchSwap Error:",w),Promise.reject(w)}}async boostedJoinBatchSwap(t,a,n,s){try{const l={},o=await this.getFundManagement(),u=this.calculateLimits(t,[a],s);return va.batchSwap(ye.SwapExactIn,n,s,o,u,this.transactionDeadline.value,l)}catch(l){throw console.log("[Swapper] batchSwapGivenInV2 Error:",l),l}}async boostedExitBatchSwap(t,a,n,s,l){try{const o={},u=await this.getFundManagement(),v=this.calculateLimits([t],a,s);return console.log("limits",v),va.batchSwap(l,n,s,u,v,this.transactionDeadline.value,o)}catch(o){throw console.log("[Swapper] batchSwapGivenInV2 Error:",o),o}}async getFundManagement(){const t=await this.walletService.getUserAddress();return{sender:t,recipient:t,fromInternalBalance:!1,toInternalBalance:!1}}calculateLimits(t,a,n){const s=[];return n.forEach((l,o)=>{const u=t.find(w=>l.toLowerCase()===w.address.toLowerCase()),v=a.find(w=>l.toLowerCase()===w.address.toLowerCase());u?s[o]=u.amount.toString():v?s[o]=v.amount.mul(-1).toString():s[o]="0"}),console.log("Limits",s),s}}function yn(){const{transactionDeadline:e}=dt(),t=new Sn(e);async function a(o,u,v){const w=o.result.tokenIn,y=o.result.tokenOut,c={address:w,amount:u,type:Pe.fixed},S={address:y,amount:v,type:Pe.min};return console.log("PERFORM SWAP"),t.batchSwapV2(c,S,o.result.swaps,o.result.tokenAddresses)}async function n(o,u,v){const w=o.result.tokenIn,y=o.result.tokenOut,c={address:w,amount:u,type:Pe.max},S={address:y,amount:v,type:Pe.fixed};return t.batchSwapV2(c,S,o.result.swaps,o.result.tokenAddresses)}async function s(o,u,v,w,y){const c=Object.entries(w).map(([f,_])=>({address:f,amount:_,type:Pe.fixed})),S={address:v,amount:y,type:Pe.min};return t.boostedJoinBatchSwap(c,S,o,u)}async function l(o,u,v,w,y,c=ye.SwapExactIn){const S={address:v,amount:de.from(w),type:Pe.min},f=Object.entries(y).map(([_,x])=>({address:_,amount:de.from(x),type:Pe.fixed}));return t.boostedExitBatchSwap(S,f,o,u,c)}return{swapIn:a,swapOut:n,boostedJoinBatchSwap:s,boostedExitBatchSwap:l}}const bn={}.VITE_GAS_PRICE||"100000000000",kn={}.VITE_MAX_POOLS||"4",Za=1e-4,An=.05,Ee=Ba({validationErrors:{highPriceImpact:!1,noSwaps:!1},submissionError:null});function Ka(e,t,a,n,s,l){const o=Te(e.toString(),n),u=Te(a.toString(),t),v=18,w=de.from(10).pow(v),y=o.mul(w).div(u),c=Te(l,v);let S;s==ye.SwapExactIn?S=c.mul(w).div(y):S=y.mul(w).div(c);const f=4,_=Math.round(S.div(de.from(10).pow(v-f)));return S=de.from(_).mul(de.from(10).pow(v-f)),Fe.sub(S)}function _n({exactIn:e,tokenInAddressInput:t,tokenInAmountInput:a,tokenOutAddressInput:n,tokenOutAmountInput:s,wrapType:l,tokenInAmountScaled:o,tokenOutAmountScaled:u,sorConfig:v={handleAmountsOnFetchPools:!0},tokenIn:w,tokenOut:y,slippageBufferRate:c,isCowswapSwap:S}){let f;const _=P([]),x=P({hasSwaps:!1,tokenIn:"",tokenOut:"",returnDecimals:18,returnAmount:xe,marketSpNormalised:"0",result:{tokenAddresses:[],swaps:[],swapAmount:xe,returnAmount:xe,returnAmountConsideringFees:xe,tokenIn:"",tokenOut:"",marketSp:"0",swapAmountForSwaps:xe,returnAmountFromSwaps:xe}}),E=P(!1),h=P(!1),O=P(0),T=P(""),F=P(!0),{account:te,getProvider:ne,appNetworkConfig:m}=Qe(),D=d(()=>ne()),{trackGoal:R,Goals:Q}=xt(),{txListener:k}=pt(),{addTransaction:$}=Oa(),{fNum:W,toFiat:oe}=Ue(),{t:N}=la(),{injectTokens:Z,priceFor:V,getToken:ve}=Le(),{swapIn:me,swapOut:we}=yn();ua(async()=>{const p=[];t.value&&!ve(t.value)&&p.push(t.value),n.value&&!ve(n.value)&&p.push(n.value),await Z(p),await M(),await Se()});function b(){Ee.validationErrors.highPriceImpact=!1,Ee.validationErrors.noSwaps=!1,Ee.submissionError=null}async function M(){f=new gn(_t.jsonProvider,de.from(bn),Number(kn)),z()}async function z(){f&&(console.time("[SOR] fetchPools"),await f.fetchPools(),console.timeEnd("[SOR] fetchPools"),F.value=!1,v.handleAmountsOnFetchPools&&Se())}function re(){R(Q.BalancerSwap),Wa.value&&R(Q.BalancerSwapMainnet)}async function fe(){if(f&&x.value.hasSwaps&&!h.value){const{result:p}=x.value,L=e.value?ye.SwapExactIn:ye.SwapExactOut,C=await wa().swaps.queryBatchSwap({kind:L,swaps:p.swaps,assets:p.tokenAddresses});if(p!==x.value.result)return;if(C.length>=2){const J=A(t.value),le=A(n.value);let X=t.value===Re?Ce:t.value,Y=n.value===Re?Ce:n.value;sa(t.value)&&(X=ke.network.tokens.Addresses.wstETH||""),sa(n.value)&&(Y=ke.network.tokens.Addresses.wstETH||"");const ee=p.tokenAddresses.indexOf(X.toLowerCase()),ie=p.tokenAddresses.indexOf(Y.toLowerCase());if(L===ye.SwapExactOut){let U=C[ee]?de.from(C[ee]).abs():de.from(0);U=await K({amount:U,address:t.value,isInputToken:!1}),a.value=U.gt(0)?qe(ce(U,J)):""}if(L===ye.SwapExactIn){let U=C[ie]?de.from(C[ie]).abs():de.from(0);U=await K({amount:U,address:n.value,isInputToken:!1}),s.value=U.gt(0)?qe(ce(U,le)):""}}}}function ge(p){e.value&&se(p).isZero()?s.value="":!e.value&&se(p).isZero()?a.value="":p==="NaN"?(a.value="",s.value=""):(a.value=p,s.value=p),O.value=0,x.value.hasSwaps=!1,x.value.returnAmount=xe}async function Se(){if(S.value)return;let p=e.value?a.value:s.value;if(p===""||se(p).isZero()||p==="NaN"){ge(p);return}const C=t.value,J=n.value;if(!C||!J){e.value?s.value="":a.value="";return}const le=A(t.value),X=A(n.value),Y=e.value?le:X;if(p=Kt(p,Y),l.value!==he.NonWrap){const ee=l.value===he.Wrap?J:C;if(e.value){a.value=p;const ie=await Qa(ee,l.value,Te(p,le));s.value=Ia(ie,le)}else{s.value=p;const ie=await Qa(ee,l.value===he.Wrap?he.Unwrap:he.Wrap,Te(p,X));a.value=Ia(ie,X)}x.value.hasSwaps=!1,O.value=0;return}if(!f||!f.hasPoolData()){e.value?s.value="":a.value="";return}if(e.value){await Ae(n.value,X,f);let ee=Ma(p,le);console.log("[SOR Manager] swapExactIn");const ie=await f.getBestSwap(C,J,le,X,ze.SwapExactIn,ee);x.value=ie;let U=ie.returnAmount;if(s.value=U.gt(0)?qe(ce(U,X)):"",!x.value.hasSwaps)O.value=0,Ee.validationErrors.noSwaps=!0;else{ee=await K({amount:ee,address:C,isInputToken:!0}),U=await K({amount:U,address:J,isInputToken:!1});const Sa=Ka(ee,le,U,X,ye.SwapExactIn,ie.marketSpNormalised);O.value=Math.max(Number(ce(Sa)),Za)}}else{await Ae(t.value,le,f);let ee=Ma(p,X);console.log("[SOR Manager] swapExactOut");const ie=await f.getBestSwap(C,J,le,X,ze.SwapExactOut,ee);x.value=ie;let U=ie.returnAmount;if(a.value=U.gt(0)?qe(ce(U,le)):"",!x.value.hasSwaps)O.value=0,Ee.validationErrors.noSwaps=!0;else{ee=await K({amount:ee,address:J,isInputToken:!0}),U=await K({amount:U,address:C,isInputToken:!1});const Sa=Ka(U,le,ee,X,ye.SwapExactIn,ie.marketSpNormalised);O.value=Math.max(Number(ce(Sa)),Za)}}_.value=f.selectedPools,Ee.validationErrors.highPriceImpact=O.value>=An}function j(p,L){h.value=!1;let C="";const J=W(a.value,{...ae.token,maximumSignificantDigits:6}),le=W(s.value,{...ae.token,maximumSignificantDigits:6}),X=w.value.symbol,Y=y.value.symbol;["wrap","unwrap"].includes(L)?C=N("transactionSummary.wrapUnwrap",[J,X,Y]):C=`${J} ${X} -> ${le} ${Y}`,$({id:p.hash,type:"tx",action:L,summary:C,details:{tokenIn:w.value,tokenOut:y.value,tokenInAddress:t.value,tokenOutAddress:n.value,tokenInAmount:a.value,tokenOutAmount:s.value,exactIn:e.value,quote:Xe(),priceImpact:O.value,slippageBufferRate:c.value}});const ee=oe(a.value,t.value)||"0";k(p,{onTxConfirmed:async()=>{R(Q.Swapped,se(ee).times(100).toNumber()||0),E.value=!1,T.value=p.hash},onTxFailed:()=>{E.value=!1}})}async function be(p){R(Q.ClickSwap),E.value=!0,h.value=!0,Ee.submissionError=null;const L=t.value,C=n.value,J=ve(L).decimals,le=ve(C).decimals,X=Te(a.value,J);if(l.value==he.Wrap){try{const Y=await $s(m.key,D.value,C,X);console.log("Wrap tx",Y),j(Y,"wrap"),p!=null&&p(),re()}catch(Y){pe(Y,L,C)}return}else if(l.value==he.Unwrap){try{const Y=await Bs(m.key,D.value,L,X);console.log("Unwrap tx",Y),j(Y,"unwrap"),p!=null&&p(),re()}catch(Y){pe(Y,L,C)}return}if(e.value){const Y=Te(s.value,le),ee=Ie(Y),ie=x.value;try{const U=await me(ie,X,ee);console.log("Swap in tx",U),j(U,"swap"),p!=null&&p(),re()}catch(U){pe(U,L,C)}}else{const Y=Be(X),ee=x.value,ie=Te(s.value,le);try{const U=await we(ee,Y,ie);console.log("Swap out tx",U),j(U,"swap"),p!=null&&p(),re()}catch(U){pe(U,L,C)}}}function $e(p){const L=V(m.nativeAsset.address),C=V(p);return C===0?0:L/C}async function Ae(p,L,C){await C.setCostOutputToken(p,L,$e(p).toString())}function Be(p){return p.mul(Te(String(1+c.value),18)).div(Fe)}function Ie(p){return p.mul(Fe).div(Te(String(1+c.value),18))}function Xe(){const p=o!=null?Be(o.value):xe,L=u!=null?Ie(u.value):xe;return{feeAmountInToken:"0",feeAmountOutToken:"0",maximumInAmount:p,minimumOutAmount:L}}function qe(p){return W(p,{maximumSignificantDigits:6,useGrouping:!1,fixedFormat:!0})}function A(p){var L;return(L=ve(p))==null?void 0:L.decimals}async function K({amount:p,address:L,isInputToken:C}){return sa(L)&&Wa.value?lt({amount:p,isWrap:C}):p}function pe(p,L,C){throw Fa(p)||(console.trace(p),Ee.submissionError=N("swapException",["Balancer"]),oa({error:p,action:"swap",msgPrefix:Ee.submissionError,context:{extra:{sender:te.value,tokenIn:L,tokenOut:C},tags:{swapType:"balancer"}}})),E.value=!1,h.value=!1,p}return{...Pa(Ee),sorManager:f,sorReturn:x,pools:_,initSor:M,handleAmountChange:Se,exactIn:e,swap:be,swapping:E,priceImpact:O,latestTxHash:T,fetchPools:z,poolsLoading:F,getQuote:Xe,resetState:b,confirming:h,updateSwapAmounts:fe,resetInputAmounts:ge,setSwapCost:Ae}}const xn=[{inputs:[{internalType:"contract IVault",name:"vault",type:"address"},{internalType:"address",name:"libraryAddress",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"getLibrary",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getVault",outputs:[{internalType:"contract IVault",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes[]",name:"data",type:"bytes[]"}],name:"multicall",outputs:[{internalType:"bytes[]",name:"results",type:"bytes[]"}],stateMutability:"payable",type:"function"},{stateMutability:"payable",type:"receive"}],je=Ba({validationErrors:{highPriceImpact:!1},submissionError:null});function En({exactIn:e,tokenInAddressInput:t,tokenInAmountInput:a,tokenOutAddressInput:n,tokenOutAmountInput:s,tokenInAmountScaled:l,tokenOutAmountScaled:o,tokenIn:u,tokenOut:v,slippageBufferRate:w,pools:y}){const c=P(null),S=P(!1),f=P(!1),_=P(0),x=P(""),E=P(!1),{account:h,getSigner:O}=Qe(),{injectTokens:T,getToken:F}=Le(),{relayerSignature:te}=rt(ta.BATCH),ne=Nt(P(ke.network.addresses.batchRelayer)),{addTransaction:m}=Oa(),{txListener:D}=pt(),{fNum:R}=Ue(),{t:Q}=la(),k=d(()=>je.validationErrors.highPriceImpact!=!1);function $(){je.validationErrors.highPriceImpact=!1,je.submissionError=null}function W(b){a.value=b,s.value=b,_.value=0}async function oe(){E.value=!0,c.value=await wa().sor.getSwaps(t.value,n.value,e.value?ze.SwapExactIn:ze.SwapExactOut,e.value?Oe(a.value||"0",u.value.decimals):Oe(s.value||"0",v.value.decimals),void 0,!0),E.value=!1}async function N(){var fe;if(e.value&&!a.value||!e.value&&!s.value||y.value.length===0||(e.value?l.value:o.value)===void 0)return;await oe();const M=we(t.value),z=we(n.value),re=((fe=c.value)==null?void 0:fe.returnAmount)||de.from("0");re.isZero()||(e.value?s.value=se(ce(re,z)).toFixed(6,De.ROUND_DOWN):a.value=se(ce(re,M)).toFixed(6,De.ROUND_DOWN))}async function Z(b){var re,fe;const M=wa();let z;try{if(f.value=!0,je.submissionError=null,!c.value)return;const ge=Gt(c.value,y.value,h.value,((re=M.contracts.relayer)==null?void 0:re.address)??"",M.networkConfig.addresses.tokens.wrappedNativeAsset,String(w.value*1e4),te.value||void 0);z=await new ra(O()).contract.sendTransaction({contractAddress:((fe=M.contracts.relayer)==null?void 0:fe.address)??"",abi:xn,action:"multicall",params:[ge.rawCalls]}),console.log(z);const j=R(a.value,{...ae.token,maximumSignificantDigits:6}),be=R(s.value,{...ae.token,maximumSignificantDigits:6});m({id:z.hash,type:"tx",action:"swap",summary:`${j} ${u.value.symbol} -> ${be} ${v.value.symbol}`,details:{tokenIn:u.value,tokenOut:v.value,tokenInAddress:t.value,tokenOutAddress:n.value,tokenInAmount:a.value,tokenOutAmount:s.value,exactIn:e.value,quote:me(),priceImpact:_.value,slippageBufferRate:w.value}}),b!=null&&b(),await D(z,{onTxConfirmed:async()=>{f.value=!1,ne.refetch()},onTxFailed:()=>{f.value=!1}})}catch(ge){const Se=Q("swapException",["Relayer"]);throw oa({error:ge,action:"swap",msgPrefix:Se,context:{level:"fatal",extra:{sender:h.value,swapInfo:c.value,tx:z}}}),Fa(ge)||(je.submissionError=Q("swapException",["Relayer"])),S.value=!1,f.value=!1,ge}}function V(b){return b.mul(Oe(String(1+w.value),18)).div(Fe)}function ve(b){return b.mul(Fe).div(Oe(String(1+w.value),18))}function me(){const b=l!=null?V(l.value):xe,M=o!=null?ve(o.value):xe;return{feeAmountInToken:"0",feeAmountOutToken:"0",maximumInAmount:b,minimumOutAmount:M}}function we(b){var M;return(M=F(b))==null?void 0:M.decimals}return ua(async()=>{const b=[];t.value&&!F(t.value)&&b.push(t.value),n.value&&!F(n.value)&&b.push(n.value),await T(b)}),Ge(y,()=>{N()}),{...Pa(je),pools:y,hasValidationError:k,handleAmountChange:N,exactIn:e,swap:Z,swapInfo:c,swapping:S,priceImpact:_,latestTxHash:x,getQuote:me,resetState:$,confirming:f,swapInfoLoading:E,resetInputAmounts:W}}const Ye=P(ha(ct.Swap.Gasless,!0));function Tn(e,t,a,n,s){const{fNum:l}=Ue(),{getToken:o,tokens:u}=Le(),{blockNumber:v}=Qe(),{slippage:w}=Ya(),{setInputAsset:y,setOutputAsset:c}=wt(),S=d(()=>parseFloat(w.value)),f=d(()=>gt(t.value,n.value)),_=d(()=>f.value===he.Wrap),x=d(()=>f.value===he.Unwrap),E=d(()=>o(t.value)),h=d(()=>o(n.value)),O=d(()=>t.value===Re),T=d(()=>Oe(a.value||"0",E.value.decimals)),F=d(()=>Oe(s.value||"0",h.value.decimals)),te=d(()=>!(f.value===he.Unwrap||O.value)),ne=d(()=>{var $e,Ae,Be,Ie;const j=parseFloat(a.value),be=parseFloat(s.value);return j>0&&be>0?{tokenIn:`1 ${($e=E.value)==null?void 0:$e.symbol} = ${l(se(be).div(j).toString(),ae.token)} ${(Ae=h.value)==null?void 0:Ae.symbol}`,tokenOut:`1 ${(Be=h.value)==null?void 0:Be.symbol} = ${l(se(j).div(be).toString(),ae.token)} ${(Ie=E.value)==null?void 0:Ie.symbol}`}:{tokenIn:"",tokenOut:""}}),m=d(()=>Zt.includes(ia.value)),D=d(()=>{var j,be,$e,Ae;return f.value!==he.NonWrap?"wrapUnwrap":O.value?"balancer":Ye.value&&m.value?"cowswap":((((j=V.swapInfo.value)==null?void 0:j.returnAmount)&&!((be=V.swapInfo.value)!=null&&be.returnAmount.isZero())?zt(e.value?ze.SwapExactIn:ze.SwapExactOut,t.value,n.value):!1)?Qt(N.pools.value,(($e=V.swapInfo.value)==null?void 0:$e.swaps)??[],((Ae=V.swapInfo.value)==null?void 0:Ae.tokenAddresses)??[]):!1)?"joinExit":"balancer"}),R=d(()=>D.value==="cowswap"),Q=d(()=>D.value==="balancer"),k=d(()=>D.value==="joinExit"),$=d(()=>D.value==="wrapUnwrap"),W=d(()=>O.value||$.value),oe=d(()=>parseFloat(a.value)>0&&parseFloat(s.value)>0),N=_n({exactIn:e,tokenInAddressInput:t,tokenInAmountInput:a,tokenOutAddressInput:n,tokenOutAmountInput:s,wrapType:f,tokenInAmountScaled:T,tokenOutAmountScaled:F,sorConfig:{handleAmountsOnFetchPools:!0},tokenIn:E,tokenOut:h,slippageBufferRate:S,isCowswapSwap:R}),Z=fn({exactIn:e,tokenInAddressInput:t,tokenInAmountInput:a,tokenOutAddressInput:n,tokenOutAmountInput:s,tokenInAmountScaled:T,tokenOutAmountScaled:F,tokenIn:E,tokenOut:h,slippageBufferRate:S}),V=En({exactIn:e,tokenInAddressInput:t,tokenInAmountInput:a,tokenOutAddressInput:n,tokenOutAmountInput:s,tokenInAmountScaled:T,tokenOutAmountScaled:F,tokenIn:E,tokenOut:h,slippageBufferRate:S,pools:N.pools}),ve=d(()=>oe.value||$.value?!1:R.value?Z.updatingQuotes.value:V.swapInfoLoading.value||N.poolsLoading.value),me=d(()=>N.confirming.value||Z.confirming.value||V.confirming.value),we=d(()=>N.submissionError.value||Z.submissionError.value||V.submissionError.value);async function b(j){return R.value?Z.swap(()=>{j&&j(),Z.resetState()}):k.value?V.swap(()=>{j&&j(),V.resetState()}):N.swap(()=>{j&&j(),N.resetState()})}function M(){N.submissionError.value=null,Z.submissionError.value=null,V.submissionError.value=null}function z(j){Ye.value=j,Ea(ct.Swap.Gasless,Ye.value)}function re(){z(!Ye.value),Se()}function fe(){return R.value?Z.getQuote():k.value?V.getQuote():N.getQuote()}function ge(){N.resetInputAmounts("")}async function Se(){e.value?s.value="":a.value="",Z.resetState(!1),N.resetState(),V.resetState(),R.value?Z.handleAmountChange():(await N.handleAmountChange(),await V.handleAmountChange())}return Ge(t,async()=>{y(t.value),Se()}),Ge(n,()=>{c(n.value),Se()}),ua(()=>{window.location.href.includes("gasless=false")&&z(!1)}),Ge(v,()=>{R.value?Z.hasValidationError.value||Z.handleAmountChange():k.value?V.hasValidationError.value||V.handleAmountChange():Q.value&&N.updateSwapAmounts()}),Ge(S,()=>{Se()}),{isWrap:_,isUnwrap:x,isNativeAssetSwap:O,tokenIn:E,tokenOut:h,tokenInAmountScaled:T,tokenOutAmountScaled:F,tokens:u,requiresTokenApproval:te,effectivePriceMessage:ne,swapRoute:D,exactIn:e,isLoading:ve,cowswap:Z,sor:N,joinExit:V,isCowswapSwap:R,isBalancerSwap:Q,isJoinExitSwap:k,wrapType:f,isWrapUnwrapSwap:$,tokenInAddressInput:t,tokenInAmountInput:a,tokenOutAddressInput:n,tokenOutAmountInput:s,slippageBufferRate:S,isConfirming:me,submissionError:we,resetSubmissionError:M,swapGasless:Ye,toggleSwapGasless:re,isGaslessSwappingDisabled:W,isCowswapSupportedOnNetwork:m,resetAmounts:ge,getQuote:fe,swap:b,handleAmountChange:Se}}function Cn(e,t,a,n){const{isWalletReady:s}=Qe(),{balances:l}=Le(),o=d(()=>!y(t.value)&&!y(n.value)),u=d(()=>!e.value||!a.value),v=d(()=>!l.value[e.value]||se(l.value[e.value]).lt(t.value)),w=d(()=>o.value||u.value?2:s.value&&v.value?4:0);function y(S){return se(S).gt(0)&&S.trim()!==""&&S!=="NaN"}const c=d(()=>w.value);return{validationStatus:w,errorMessage:c,isValidTokenAmount:y}}const $n=Ve({emits:["toggle"],setup(e,{emit:t}){const a=P(!1);function n(){a.value=!a.value,t("toggle")}return{isRotated:a,toggle:n}}});const Bn=e=>(Ca("data-v-a887edec"),e=e(),$a(),e),Pn=Bn(()=>i("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 21 18",class:"w-5 h-3 icon-swap-toggle"},[i("path",{d:"M6.26693 16.2421L6.26693 3.5252L8.70412 5.96238C9.03943 6.29801 9.58349 6.29801 9.91943 5.96238C10.2554 5.62676 10.2551 5.08301 9.91943 4.74707L6.01537 0.843008C5.97568 0.80332 5.93193 0.767695 5.88537 0.736133C5.87349 0.728633 5.86037 0.72332 5.84849 0.716445C5.81287 0.694883 5.77693 0.67332 5.73787 0.657383C5.72005 0.650195 5.70099 0.646758 5.68287 0.640195C5.64818 0.628633 5.6138 0.615508 5.57724 0.608008C5.52162 0.596758 5.46505 0.59082 5.40724 0.59082C5.34943 0.59082 5.29287 0.596758 5.23724 0.608008C5.20068 0.615195 5.1663 0.62832 5.13162 0.640195C5.11349 0.646758 5.09443 0.649883 5.07662 0.657383C5.03787 0.673633 5.00193 0.694883 4.96599 0.716445C4.95412 0.72332 4.94099 0.728633 4.92912 0.736133C4.88255 0.767695 4.8388 0.80332 4.79912 0.843008L0.895679 4.74645C0.727866 4.91426 0.643804 5.13395 0.643804 5.35395C0.643804 5.57395 0.727866 5.79363 0.895679 5.96145C1.23099 6.29707 1.77505 6.29707 2.11099 5.96145L4.54787 3.52488L4.54787 16.2418C4.54787 16.7164 4.93255 17.1011 5.40724 17.1011C5.88193 17.1011 6.26693 16.7168 6.26693 16.2421Z",class:"fill-current text-secondary"}),i("path",{d:"M15.7625 17.2669C15.7987 17.2597 15.8328 17.2469 15.8672 17.235C15.8856 17.2284 15.905 17.2253 15.9231 17.2175C15.9612 17.2013 15.9966 17.1806 16.0322 17.1591C16.0447 17.1519 16.0584 17.1462 16.0706 17.1384C16.1172 17.1069 16.1609 17.0713 16.2006 17.0316L20.1037 13.1284C20.4394 12.7928 20.4394 12.2491 20.1037 11.9131C19.7684 11.5775 19.2244 11.5775 18.8884 11.9131L16.4516 14.3497V1.63281C16.4516 1.15813 16.0669 0.773438 15.5922 0.773438C15.1175 0.773438 14.7328 1.15813 14.7328 1.63281V14.3497L12.2956 11.9125C11.9603 11.5769 11.4163 11.5769 11.0803 11.9125C10.9125 12.0803 10.8284 12.3 10.8284 12.52C10.8284 12.74 10.9125 12.9597 11.0803 13.1275L14.9841 17.0316C15.0238 17.0713 15.0675 17.1069 15.1141 17.1384C15.1262 17.1462 15.14 17.1519 15.1525 17.1591C15.1878 17.1803 15.2234 17.2013 15.2616 17.2175C15.2797 17.225 15.2991 17.2284 15.3175 17.235C15.3519 17.2466 15.3859 17.2594 15.4222 17.2669C15.4778 17.2778 15.5344 17.2841 15.5922 17.2841C15.65 17.2841 15.7069 17.2778 15.7625 17.2669Z",class:"text-blue-600 group-hover:text-pink-500 dark:text-blue-400 dark:group-hover:text-yellow-500 dark:group-focus:text-yellow-500 fill-current"})],-1)),On=[Pn];function Fn(e,t,a,n,s,l){return g(),H("div",{class:"group flex justify-center items-center w-9 h-9 bg-gray-50 dark:bg-gray-900 rounded-full shadow cursor-pointer toggle-btn",onClick:t[0]||(t[0]=(...o)=>e.toggle&&e.toggle(...o))},[i("div",{class:Ne(["duration-300 ease-in-out",{"rotate-180":e.isRotated}])},On,2)])}const Ln=Ke($n,[["render",Fn],["__scopeId","data-v-a887edec"]]),In={class:"flex items-center my-2"},Mn=i("div",{class:"mx-2 h-px bg-gray-100 dark:bg-gray-700 grow"},null,-1),Dn=["innerHTML"],Nn=Ve({__name:"SwapPair",props:{tokenInAmount:null,tokenInAddress:null,tokenOutAmount:null,tokenOutAddress:null,exactIn:{type:Boolean},priceImpact:null,effectivePriceMessage:null,swapLoading:{type:Boolean}},emits:["update:tokenInAmount","update:tokenInAddress","update:tokenOutAmount","update:tokenOutAddress","update:exactIn","amountChange"],setup(e,{emit:t}){const a=e,{fNum:n}=Ue(),{getToken:s}=Le(),{veBalTokenInfo:l}=Yt(),o=P(""),u=P(""),v=P(""),w=P(""),y=P(!0),c=P(void 0),S=d(()=>!u.value||!w.value),f=d(()=>!o.value||!v.value),_=d(()=>s(u.value)),x=d(()=>s(w.value)),E=d(()=>{if(S.value||f.value)return"";if(a.effectivePriceMessage)return y.value?a.effectivePriceMessage.value.tokenIn:a.effectivePriceMessage.value.tokenOut;let m,D,R;return y.value?(m=se(v.value).div(o.value).toString(),D=_.value.symbol,R=x.value.symbol):(m=se(o.value).div(v.value).toString(),D=x.value.symbol,R=_.value.symbol),`1 ${D} = ${n(m,ae.token)} ${R}`});function h(m){c.value&&clearTimeout(c.value),c.value=setTimeout(()=>{m()},300)}function O(m){t("update:tokenInAmount",m),h(()=>{t("amountChange")})}function T(m){t("update:tokenOutAmount",m),h(()=>{t("amountChange")})}function F(){t("update:exactIn",!a.exactIn),t("update:tokenInAmount",v.value),t("update:tokenInAddress",w.value),t("update:tokenOutAmount",o.value),t("update:tokenOutAddress",u.value),t("amountChange")}async function te(m){if(m===w.value){F();return}t("update:tokenInAddress",m)}async function ne(m){if(m===u.value){F();return}t("update:tokenOutAddress",m)}return Ft(()=>{o.value=a.tokenInAmount,u.value=a.tokenInAddress,v.value=a.tokenOutAmount,w.value=a.tokenOutAddress}),ua(()=>{a.tokenOutAmount&&T(a.tokenOutAmount)}),(m,D)=>(g(),H("div",null,[I(za,{amount:r(o),address:r(u),name:"tokenIn","aria-label":m.$t("inputLabels.tokenIn"),excludedTokens:r(l)?[r(l).address]:[],ignoreWalletBalance:e.swapLoading,autoFocus:"","onUpdate:amount":O,"onUpdate:address":te,onInput:D[0]||(D[0]=R=>t("update:exactIn",!0)),onSetMax:D[1]||(D[1]=R=>t("update:exactIn",!0))},null,8,["amount","address","aria-label","excludedTokens","ignoreWalletBalance"]),i("div",In,[I(Ln,{onToggle:F}),Mn,r(E)?(g(),H("div",{key:0,class:"flex items-center text-xs text-gray-600 dark:text-gray-400 cursor-pointer",onClick:D[2]||(D[2]=R=>y.value=!r(y)),innerHTML:r(E)},null,8,Dn)):ue("",!0)]),I(za,{amount:r(v),address:r(w),name:"tokenOut","aria-label":m.$t("inputLabels.tokenOut"),priceImpact:e.priceImpact,noRules:"",noMax:"",disableNativeAssetBuffer:"",excludedTokens:r(l)?[r(l).address]:[],"onUpdate:amount":T,"onUpdate:address":ne,onInput:D[3]||(D[3]=R=>t("update:exactIn",!1))},null,8,["amount","address","aria-label","priceImpact","excludedTokens"])]))}}),Rn=Ve({components:{SwapPair:Nn,SwapPreviewModal:mn,SwapRoute:ft,SwapSettingsPopover:Rt},setup(){const{inputAsset:e,outputAsset:t}=wt(),a=Ot(),{t:n}=la(),{bp:s}=La(),{fNum:l}=Ue(),{appNetworkConfig:o,isMismatchedNetwork:u}=Qe(),{nativeAsset:v}=Le(),{tokenInAddress:w,tokenOutAddress:y,tokenInAmount:c,tokenOutAmount:S,setTokenInAddress:f,setTokenOutAddress:_,setTokenInAmount:x,setTokenOutAmount:E,setInitialized:h}=_a(),O=P(!0),T=P(!1),F=P({highPriceImpact:!1}),te=ha("alwaysShowRoutes",!0),ne=d(()=>{switch(s.value){case"xs":return"none";case"sm":return"lg";default:return"xl"}}),m=Tn(O,w,c,y,S),{errorMessage:D}=Cn(w,c,y,S),R=d(()=>m.sor.validationErrors.value.highPriceImpact&&!F.value.highPriceImpact),Q=d(()=>{const b=u.value,M=!c.value||!S.value,z=m.isCowswapSwap.value&&m.cowswap.hasValidationError.value,re=m.isBalancerSwap.value&&R.value;return M||z||re||b}),k=d(()=>{var b,M;return m.wrapType.value===he.Wrap?`${n("wrap")} ${(b=m.tokenIn.value)==null?void 0:b.symbol}`:m.wrapType.value===he.Unwrap?`${n("unwrap")} ${(M=m.tokenOut.value)==null?void 0:M.symbol}`:n("swap")}),$=d(()=>m.sor.pools.value),W=d(()=>{if(u.value)return{header:n("switchNetwork"),body:n("networkMismatch",[o.name])};if(m.isBalancerSwap.value&&!m.isLoading.value&&m.sor.validationErrors.value.noSwaps)return{header:n("insufficientLiquidity"),body:n("insufficientLiquidityDetailed")};if(m.isCowswapSwap.value){if(m.cowswap.validationError.value!=null){const b=m.cowswap.validationError.value;return b===ma.SellAmountDoesNotCoverFee?{header:n("cowswapErrors.lowAmount.header"),body:n("cowswapErrors.lowAmount.body")}:b===ma.PriceExceedsBalance?{header:n("cowswapErrors.lowBalance.header",[m.tokenIn.value.symbol]),body:n("cowswapErrors.lowBalance.body",[m.tokenIn.value.symbol,l(ce(m.getQuote().maximumInAmount,m.tokenIn.value.decimals),ae.token),l(m.slippageBufferRate.value,ae.percent)])}:b===ma.NoLiquidity?{header:n("cowswapErrors.noLiquidity.header",[m.tokenIn.value.symbol]),body:n("cowswapErrors.noLiquidity.body")}:{header:n("cowswapErrors.genericError.header"),body:m.cowswap.validationError.value}}}else if(m.isBalancerSwap.value&&R.value)return{header:n("highPriceImpact"),body:n("highPriceImpactDetailed"),label:n("accept")}}),oe=d(()=>{if(m.isCowswapSwap.value&&m.cowswap.warnings.value.highFees)return{header:n("cowswapWarnings.highFees.header"),body:n("cowswapWarnings.highFees.body")}});function N(){m.sor.validationErrors.value.highPriceImpact&&(F.value.highPriceImpact=!0)}function Z(b){var M,z;return(b==null?void 0:b.toLowerCase())===((M=v.deeplinkId)==null?void 0:M.toLowerCase())||(b==null?void 0:b.toLowerCase())===((z=v.symbol)==null?void 0:z.toLowerCase())}function V(b){for(const M of b){if(Z(M))return v.address;if(Pt(M))return Je(M)}}function ve(){var fe,ge;const b=V([a.currentRoute.value.params.assetIn,e.value,o.tokens.InitialSwapTokens.input]);b&&f(b);const M=V([a.currentRoute.value.params.assetOut,t.value,o.tokens.InitialSwapTokens.output]);M&&_(M);let z=(fe=a.currentRoute.value.query)==null?void 0:fe.inAmount,re=(ge=a.currentRoute.value.query)==null?void 0:ge.outAmount;z&&x(z),!z&&re&&E(re)}function me(){m.resetSubmissionError(),T.value=!0}function we(){m.resetSubmissionError(),T.value=!1}return nt(()=>{ve(),h(!0)}),{TOKENS:Bt,SwapSettingsContext:Wt,tokenInAddress:w,tokenInAmount:c,tokenOutAddress:y,tokenOutAmount:S,modalSwapPreviewIsOpen:T,alwaysShowRoutes:te,exactIn:O,swapping:m,pools:$,title:k,error:W,warning:oe,errorMessage:D,isRequired:Xt,swapDisabled:Q,swapCardShadow:ne,handlePreviewButton:me,handlePreviewModalClose:we,handleErrorButtonClick:N}}});const Wn=e=>(Ca("data-v-507298be"),e=e(),$a(),e),Un={class:"flex justify-between items-center w-full"},Vn={key:4,class:"flex items-center mt-5 h-8 text-sm"},Hn={key:0,class:"text-secondary"},Gn={class:"flex gap-2 items-center"},zn=Wn(()=>i("span",{class:"text-lg"},"⛽",-1)),Qn={key:0},qn={key:1},jn={key:2},Jn={key:1},Zn={class:"flex items-center swap-gasless"},Kn=["textContent"],Xn={key:0,class:"pl-2 text-sm text-gray-600 dark:text-gray-400"},Yn={key:1,class:"pl-2 text-sm text-gray-600 dark:text-gray-400"},eo=["innerHTML"];function ao(e,t,a,n,s,l){const o=He("SwapSettingsPopover"),u=He("SwapPair"),v=st,w=at,y=Ct,c=Tt,S=ga,f=fa,_=He("SwapRoute"),x=He("SafeTeleport"),E=He("SwapPreviewModal");return g(),H(aa,null,[I(f,{class:"relative card-container",shadow:e.swapCardShadow,noBorder:""},{header:G(()=>[i("div",Un,[i("h4",null,B(e.title),1),I(o,{context:e.SwapSettingsContext.swap,isGasless:e.swapping.swapGasless.value},null,8,["context","isGasless"])])]),default:G(()=>[i("div",null,[I(u,{tokenInAmount:e.tokenInAmount,"onUpdate:tokenInAmount":t[0]||(t[0]=h=>e.tokenInAmount=h),tokenInAddress:e.tokenInAddress,"onUpdate:tokenInAddress":t[1]||(t[1]=h=>e.tokenInAddress=h),tokenOutAmount:e.tokenOutAmount,"onUpdate:tokenOutAmount":t[2]||(t[2]=h=>e.tokenOutAmount=h),tokenOutAddress:e.tokenOutAddress,"onUpdate:tokenOutAddress":t[3]||(t[3]=h=>e.tokenOutAddress=h),exactIn:e.exactIn,"onUpdate:exactIn":t[4]||(t[4]=h=>e.exactIn=h),swapLoading:e.swapping.isBalancerSwap.value?e.swapping.isLoading.value:!1,effectivePriceMessage:e.swapping.effectivePriceMessage,class:"mb-4",onAmountChange:e.swapping.handleAmountChange},null,8,["tokenInAmount","tokenInAddress","tokenOutAmount","tokenOutAddress","exactIn","swapLoading","effectivePriceMessage","onAmountChange"]),e.error?(g(),q(v,{key:0,class:"p-3 mb-4",type:"error",size:"sm",title:e.error.header,description:e.error.body,actionLabel:e.error.label,block:"",onActionClick:e.handleErrorButtonClick},null,8,["title","description","actionLabel","onActionClick"])):e.warning?(g(),q(v,{key:1,class:"p-3 mb-4",type:"warning",size:"sm",title:e.warning.header,description:e.warning.body,block:""},null,8,["title","description"])):ue("",!0),e.swapping.isLoading.value?(g(),q(w,{key:2,loading:"",disabled:"",loadingLabel:e.swapping.isCowswapSwap.value?e.$t("loadingBestPrice"):e.$t("loading"),block:""},null,8,["loadingLabel"])):(g(),q(w,{key:3,label:e.$t("preview"),disabled:e.swapDisabled,color:"gradient",block:"",onClick:et(e.handlePreviewButton,["prevent"])},null,8,["label","disabled","onClick"])),e.swapping.isCowswapSupportedOnNetwork.value?(g(),H("div",Vn,[I(ya,{name:"fade",mode:"out-in"},{default:G(()=>[e.swapping.isGaslessSwappingDisabled.value?(g(),H("div",Hn,[i("div",Gn,[zn,I(ya,{name:"fade",mode:"out-in"},{default:G(()=>[e.swapping.isWrap.value?(g(),H("p",Qn,B(e.$t("swapToggle.wrapEth")),1)):e.swapping.isUnwrap.value?(g(),H("p",qn,B(e.$t("swapToggle.unwrapEth")),1)):(g(),H("p",jn,B(e.$t("swapToggle.fromEth")),1))]),_:1})])])):(g(),H("div",Jn,[i("div",Zn,[I(c,{width:"64",disabled:!e.swapping.isGaslessSwappingDisabled.value},{activator:G(()=>[I(y,{name:"swapGasless",checked:e.swapping.swapGasless.value,disabled:e.swapping.isGaslessSwappingDisabled.value,onToggle:e.swapping.toggleSwapGasless},null,8,["checked","disabled","onToggle"])]),default:G(()=>[i("div",{textContent:B(e.swapping.isWrapUnwrapSwap.value?e.$t("swapGaslessToggle.disabledTooltip.wrapUnwrap"):e.$t("swapGaslessToggle.disabledTooltip.eth"))},null,8,Kn)]),_:1},8,["disabled"]),I(ya,{name:"fade",mode:"out-in"},{default:G(()=>[e.swapping.swapGasless.value?(g(),H("span",Xn,B(e.$t("swapToggle.swapGasless")),1)):(g(),H("span",Yn,B(e.$t("swapToggle.swapWithGas")),1))]),_:1}),I(c,{width:"64"},{activator:G(()=>[I(S,{name:"info",size:"xs",class:"flex ml-1 text-gray-400"})]),default:G(()=>[i("div",{innerHTML:e.$t("swapGaslessToggle.tooltip")},null,8,eo)]),_:1})])]))]),_:1})])):ue("",!0)])]),_:1},8,["shadow"]),I(x,{to:"#route-card"},{default:G(()=>[e.alwaysShowRoutes?(g(),q(_,{key:0,addressIn:e.swapping.tokenIn.value.address,amountIn:e.swapping.tokenInAmountInput.value,addressOut:e.swapping.tokenOut.value.address,amountOut:e.swapping.tokenOutAmountInput.value,pools:e.pools,sorReturn:e.swapping.sor.sorReturn.value,class:"mt-4",hideContainer:""},null,8,["addressIn","amountIn","addressOut","amountOut","pools","sorReturn"])):ue("",!0)]),_:1}),(g(),q(Lt,{to:"#modal"},[e.modalSwapPreviewIsOpen?(g(),q(E,{key:0,swapping:e.swapping,error:e.error,warning:e.warning,onClose:e.handlePreviewModalClose},null,8,["swapping","error","warning","onClose"])):ue("",!0)]))],64)}const to=Ke(Rn,[["render",ao],["__scopeId","data-v-507298be"]]),so=["src","alt"],Xa=Ve({__name:"BridgeLink",setup(e){const{networkId:t,networkSlug:a}=Ta(),n=d(()=>`Bridge assets to ${ke.network.chainName}`);return(s,l)=>{const o=ga,u=He("router-link");return g(),q(u,{to:{name:"bridge",params:{networkSlug:r(a)}},class:"flex items-center p-4 text-sm dark:bg-gray-850 rounded-lg border dark:border-0"},{default:G(()=>[i("img",{src:r(as)(r(t)),alt:r(n),class:"mr-4 w-6 h-6"},null,8,so),na(" "+B(r(n))+" ",1),I(o,{name:"repeat",size:"sm",class:"ml-2 text-gray-500 hover:text-blue-500 dark:hover:text-blue-400 transition-colors"})]),_:1},8,["to"])}}}),no=Ve({__name:"Col2SwapLayout",props:{cols:{default:"12"},gap:{default:"8"},leftSpan:{default:"5"},rightSpan:{default:"7"},maxWidth:{default:"7xl"}},setup(e){const t=d(()=>({12:"lg:grid-cols-12"})),a=d(()=>({4:"lg:gap-x-4 gap-y-4",8:"lg:gap-x-8 gap-y-8"})),n=d(()=>({"3xl":"max-w-3xl","7xl":"max-w-7xl","1920px":"max-w-[1920px]","2560px":"max-w-[2560px]"})),s=d(()=>({3:"col-span-3",4:"col-span-4",5:"col-span-5",6:"col-span-6",7:"col-span-7",8:"col-span-8",9:"col-span-9"})),l=d(()=>({"2xl":"mx-10","3xl":"mx-20"})),{bp:o}=La();return(u,v)=>(g(),H("div",{class:Ne(`px-4 mx-auto ${r(n)[r(o)==="3xl"?"1920px":e.maxWidth]}`)},[i("div",{class:Ne(`grid grid-cols-1 ${r(t)[e.cols]} gap-x-0 ${r(a)[e.gap]}} ${r(l)[r(o)]}`)},[i("div",{class:Ne(r(s)[r(o)==="3xl"?"4":e.leftSpan])},[ka(u.$slots,"left")],2),i("div",{class:Ne(r(s)[r(o)==="3xl"?"8":e.rightSpan])},[ka(u.$slots,"right")],2),ka(u.$slots,"default")],2)],2))}}),oo={class:"flex flex-col justify-between"},ro={class:"mt-5 xl:mt-0 font-light text-center xl:text-left"},lo={class:"font-medium"},io={class:"p-4 sm:p-0 lg:p-0 mt-8"},uo=Ve({__name:"swap",setup(e){ts();const{setSelectedTokens:t}=es(),{networkConfig:a}=Ta(),{initialized:n}=_a(),{upToLargeBreakpoint:s}=La(),l=P(!1),o=d(()=>{const u=[{title:"Swap Route",id:"swap-route"},{title:"My wallet",id:"my-wallet"},{title:"Price chart",id:"price-chart"}];return ba.value&&u.push({title:"Bridge assets",id:"bridge"}),u});return Ge(_a,u=>{l.value=!!(n.value&&u.tokenInAddress.value&&u.tokenOutAddress.value&&u.tokenInAmount.value&&u.tokenInAmount.value!=="NaN"&&u.tokenOutAmount.value)}),ua(()=>{t([])}),(u,v)=>{const w=He("TeleportTarget"),y=Et,c=fa;return g(),H("div",null,[i("div",oo,[i("h1",ro,[na(B(u.$t("swapOn"))+" ",1),i("span",lo,B(r(a).chainName),1)])]),I(no,{class:"mt-8"},Va({left:G(()=>[I(to)]),default:G(()=>[i("div",io,[r(s)?(g(),q(y,{key:0,class:"w-full",isOpenedByDefault:!0,sections:r(o)},Va({"my-wallet":G(()=>[I(Da)]),"price-chart":G(()=>[I(Na)]),_:2},[r(l)?{name:"swap-route",fn:G(()=>[I(w,{id:"route-card"})]),key:"0"}:void 0,r(ba)?{name:"bridge",fn:G(()=>[I(Xa)]),key:"1"}:void 0]),1032,["sections"])):ue("",!0)])]),_:2},[r(s)?void 0:{name:"right",fn:G(()=>[I(Na,{height:"150",class:"pb-5"}),r(l)?(g(),q(w,{key:0,id:"route-card",class:"mb-4"})):(g(),q(c,{key:1,class:"mb-4 text-center"},{default:G(()=>[na(B(u.$t("swapRouteOnInput")),1)]),_:1})),I(Da),r(ba)?(g(),q(Xa,{key:2,class:"mt-4"})):ue("",!0)]),key:"0"}]),1024)])}}});const hr=Ke(uo,[["__scopeId","data-v-c91f7f06"]]);export{hr as default};
//# sourceMappingURL=swap-f492b0a6.js.map
